(self.webpackChunk=self.webpackChunk||[]).push([["OrganizationStats"],{"./app/components/charts/errorPanel.tsx":(t,e,r)=>{"use strict";r.d(e,{Z:()=>n});const n=(0,r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js").Z)("div",{target:"esa86kh0",label:"ErrorPanel"})("display:flex;justify-content:center;align-items:center;flex:1;flex-shrink:0;overflow:hidden;height:",(function(t){return t.height||"200px"}),";position:relative;border-color:transparent;margin-bottom:0;color:",(function(t){return t.theme.gray300}),";font-size:",(function(t){return t.theme.fontSizeExtraLarge}),";")},"./app/components/charts/optionSelector.tsx":(t,e,r)=>{"use strict";r.d(e,{Z:()=>R});var n=r("../../../../node_modules/@babel/runtime/helpers/esm/extends.js"),a=r("../../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../../../../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../../../../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),i=r("../../../../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../../../../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../../../../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),d=r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),p=r("../../../../node_modules/react/index.js"),h=r("../../../../node_modules/lodash/isEqual.js"),f=r.n(h),m=r("./app/components/charts/styles.tsx"),g=r("./app/components/dropdownBubble.tsx"),v=r("./app/components/dropdownButton.tsx"),y=r("./app/components/dropdownControl.tsx"),Z=r("./app/components/dropdownMenu.tsx"),b=r("./app/components/tooltip.tsx"),x=r("./app/styles/space.tsx"),j=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");var C=function(t){(0,i.Z)(h,t);var e,r,d=(e=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,c.Z)(e);if(r){var a=(0,c.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,l.Z)(this,t)});function h(){var t;(0,a.Z)(this,h);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=d.call.apply(d,[this].concat(r)),(0,u.Z)((0,s.Z)(t),"state",{}),(0,u.Z)((0,s.Z)(t),"menuContainerRef",p.createRef()),t}return(0,o.Z)(h,[{key:"componentDidMount",value:function(){this.setMenuContainerWidth()}},{key:"shouldComponentUpdate",value:function(t,e){return!f()(t,this.props)||!f()(e,this.state)}},{key:"componentDidUpdate",value:function(t){t.selected!==this.props.selected&&this.setMenuContainerWidth()}},{key:"setMenuContainerWidth",value:function(){var t,e,r=null===(t=this.menuContainerRef)||void 0===t||null===(e=t.current)||void 0===e?void 0:e.offsetWidth;r&&this.setState({menuContainerWidth:r})}},{key:"render",value:function(){var t=this.state.menuContainerWidth,e=this.props,r=e.options,a=e.onChange,o=e.selected,s=e.title,i=e.menuWidth,l=r.find((function(t){return o===t.value}))||r[0];return(0,j.tZ)(m.m2,null,(0,j.tZ)(m.OT,null,s),(0,j.tZ)(D,{ref:this.menuContainerRef},(0,j.tZ)(Z.Z,{alwaysRenderMenu:!1},(function(e){var s=e.isOpen,c=e.getMenuProps,u=e.getActorProps;return(0,j.tZ)(p.Fragment,null,(0,j.tZ)(S,(0,n.Z)({},u(),{size:"zero",isOpen:s}),l.label),(0,j.tZ)(P,(0,n.Z)({},c(),{alignMenu:"right",width:i,minWidth:t,isOpen:s,blendWithActor:!1,blendCorner:!0}),r.map((function(t){return(0,j.tZ)(E,{key:t.value,onSelect:a,eventKey:t.value,disabled:t.disabled,isActive:o===t.value,"data-test-id":"option-".concat(t.value)},(0,j.tZ)(b.Z,{title:t.tooltip,containerDisplayMode:"inline"},t.label))}))))}))))}}]),h}(p.Component);C.displayName="OptionSelector",(0,u.Z)(C,"defaultProps",{menuWidth:"auto"});var D=(0,d.Z)("div",{target:"evcxx5l0",label:"MenuContainer"})({name:"b3pn3b",styles:"display:inline-block;position:relative;"}),S=(0,d.Z)(v.Z,{target:"evcxx5l1",label:"StyledDropdownButton"})("padding:",(0,x.Z)(1)," ",(0,x.Z)(2),";font-weight:normal;z-index:",(function(t){return t.isOpen?t.theme.zIndex.dropdownAutocomplete.actor:"auto"}),";"),P=(0,d.Z)(g.Z,{target:"evcxx5l2",label:"StyledDropdownBubble"})("display:",(function(t){return t.isOpen?"block":"none"}),";",(function(t){return t.minWidth&&"auto"===t.width&&"min-width: calc(".concat(t.minWidth,"px + ").concat((0,x.Z)(3),")")}),";"),E=(0,d.Z)(y.hP,{target:"evcxx5l3",label:"StyledDropdownItem"})("line-height:",(function(t){return t.theme.text.lineHeightBody}),";white-space:nowrap;");const R=C},"./app/views/organizationStats/index.tsx":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>Kt});var n,a=r("../../../../node_modules/react/index.js"),o=r("./app/utils/withOrganization.tsx"),s=r("../../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../../../../node_modules/@babel/runtime/helpers/esm/createClass.js"),l=r("../../../../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),c=r("../../../../node_modules/@babel/runtime/helpers/esm/inherits.js"),u=r("../../../../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=r("../../../../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),p=r("../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),h=r("../../../../node_modules/moment/moment.js"),f=r.n(h),m=r("./app/components/pageHeading.tsx"),g=r("./app/locale.tsx"),v=r("./app/styles/organization.tsx"),y=r("./app/types/index.tsx"),Z=r("../../../../node_modules/@babel/runtime/helpers/esm/get.js"),b=r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),x=r("../../../../node_modules/@sentry/minimal/esm/index.js"),j=r("./app/components/asyncComponent.tsx"),C=r("./app/components/card.tsx"),D=r("./app/components/charts/errorPanel.tsx"),S=r("./app/components/charts/optionSelector.tsx"),P=r("./app/components/charts/styles.tsx"),E=r("./app/components/loadingIndicator.tsx"),R=r("./app/components/panels/index.tsx"),T=r("./app/components/questionTooltip.tsx"),O=r("./app/components/textOverflow.tsx"),w=r("./app/icons/index.tsx"),k=r("./app/styles/space.tsx");!function(t){t.ACCEPTED="accepted",t.FILTERED="filtered",t.INVALID="invalid",t.DROPPED="dropped"}(n||(n={}));var A=r("../../../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),M=r("../../../../node_modules/color/index.js"),L=r.n(M),N=r("../../../../node_modules/emotion-theming/dist/emotion-theming.browser.esm.js"),_=r("./app/components/charts/baseChart.tsx"),z=r("./app/components/charts/components/legend.tsx"),q=r("./app/components/charts/components/tooltip.tsx"),I=r("./app/components/charts/components/xAxis.tsx"),B=r("./app/components/charts/series/barSeries.tsx"),F=r("./app/components/panels/panel.tsx"),U=r("./app/constants/chartPalette.tsx"),H=r("./app/utils/formatters.tsx"),W=r("./app/utils/theme.tsx"),Y=r("./app/utils.tsx"),V=Math.pow(10,6),G=Math.pow(10,9),J=Math.pow(10,9);function Q(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAbbreviated:!1,useUnitScaling:!1};if(e!==y.cn.ATTACHMENTS)return r.isAbbreviated?K(t):t.toLocaleString();if(r.useUnitScaling)return(0,Y.E9)(t);var n=t/J;return r.isAbbreviated?"".concat(K(n)," GB"):"".concat(n.toLocaleString(void 0,{maximumFractionDigits:2})," GB")}function K(t){return t>=G?(t/G).toLocaleString(void 0,{maximumFractionDigits:2})+"B":t>=V?(t/V).toLocaleString(void 0,{maximumFractionDigits:1})+"M":t>=1e3?(t/1e3).toFixed().toLocaleString()+"K":t.toFixed().toLocaleString()}function $(t){return t===y.cn.ATTACHMENTS?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Q(t,y.cn.ATTACHMENTS,{useUnitScaling:!0})}:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.toLocaleString()}}var X=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function tt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function et(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(r),!0).forEach((function(e){(0,p.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var rt,nt=U.Z[4][3],at=L()(nt).lighten(.25).string(),ot=U.Z[4][2],st=L()(ot).lighten(.25).string(),it=U.Z[4][1],lt=L()(it).lighten(.5).string(),ct=W.ZP.gray200,ut=[{label:y.mL[y.cn.ERRORS],value:y.cn.ERRORS,disabled:!1},{label:y.mL[y.cn.TRANSACTIONS],value:y.cn.TRANSACTIONS,disabled:!1},{label:y.mL[y.cn.ATTACHMENTS],value:y.cn.ATTACHMENTS,disabled:!1}];!function(t){t.CUMULATIVE="cumulative",t.DAILY="daily"}(rt||(rt={}));var dt,pt=[{label:(0,g.t)("Cumulative"),value:rt.CUMULATIVE,disabled:!1},{label:(0,g.t)("Day-to-Day"),value:rt.DAILY,disabled:!1}];!function(t){t.ACCEPTED="Accepted",t.DROPPED="Dropped",t.PROJECTED="Projected"}(dt||(dt={}));var ht=function(t){(0,c.Z)(a,t);var e,r,n=(e=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,d.Z)(e);if(r){var a=(0,d.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;(0,s.Z)(this,a);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t=n.call.apply(n,[this].concat(r)),(0,p.Z)((0,l.Z)(t),"state",{xAxisDates:[]}),t}return(0,i.Z)(a,[{key:"chartColors",get:function(){var t=this.props.dataCategory;return t===y.cn.ERRORS?[nt,at,ct]:t===y.cn.ATTACHMENTS?[it,lt,ct]:[ot,st,ct]}},{key:"chartMetadata",get:function(){var t=this.props,e=t.usageStats,r=t.dataCategory,n=t.dataTransform,a=t.handleDataTransformation,o=this.state.xAxisDates,s=ut.find((function(t){return t.value===r}));if(!s)throw new Error("Selected item is not supported");var i=et({},a(e,n));Object.keys(i).forEach((function(t){var e=t===dt.PROJECTED;i[t]=i[t].map((function(t){return et(et({},t),{},{tooltip:{show:!1},itemStyle:{opacity:e?.6:1}})}))}));var l=s.label,c=s.value;return c===y.cn.ERRORS||c===y.cn.TRANSACTIONS?{chartLabel:l,chartData:i,xAxisData:o,yAxisMinInterval:1e3,yAxisFormatter:H.Du,tooltipValueFormatter:$(r)}:{chartLabel:l,chartData:i,xAxisData:o,yAxisMinInterval:1*J,yAxisFormatter:function(t){return Q(t,y.cn.ATTACHMENTS,{isAbbreviated:!0,useUnitScaling:!0})},tooltipValueFormatter:$(r)}}},{key:"chartSeries",get:function(){var t=this.props.chartSeries,e=this.chartMetadata.chartData,r=[(0,B.Z)({name:dt.ACCEPTED,data:e.accepted,barMinHeight:1,stack:"usage",legendHoverLink:!1}),(0,B.Z)({name:dt.DROPPED,data:e.dropped,stack:"usage",legendHoverLink:!1}),(0,B.Z)({name:dt.PROJECTED,data:e.projected,barMinHeight:1,stack:"usage",legendHoverLink:!1})];return t&&r.concat(t),r}},{key:"chartLegend",get:function(){var t=this.chartMetadata.chartData,e=[{name:dt.ACCEPTED}];return t.dropped.length>0&&e.push({name:dt.DROPPED}),t.projected.length>0&&e.push({name:dt.PROJECTED}),e}},{key:"chartTooltip",get:function(){var t=this.props.chartTooltip;if(t)return t;var e=this.chartMetadata.tooltipValueFormatter;return(0,q.Z)({trigger:"axis",valueFormatter:e})}},{key:"render",value:function(){var t=this.props,e=t.theme,r=t.title,n=t.footer,a=this.chartMetadata,o=a.xAxisData,s=a.yAxisMinInterval,i=a.yAxisFormatter;return(0,X.tZ)(F.Z,{id:"usage-chart"},(0,X.tZ)(P.BO,null,(0,X.tZ)(P.ws,null,r||(0,g.t)("Current Usage Period")),(0,X.tZ)(_.Z,{colors:this.chartColors,grid:{bottom:"3px",left:"0px",right:"10px",top:"40px"},xAxis:(0,I.Z)({show:!0,type:"category",name:"Date",boundaryGap:!0,data:o,truncate:6,axisTick:{interval:6,alignWithLabel:!0},axisLabel:{interval:6},theme:e}),yAxis:{min:0,minInterval:s,axisLabel:{formatter:i,color:e.chartLabel}},series:this.chartSeries,tooltip:this.chartTooltip,onLegendSelectChanged:function(){},legend:(0,z.Z)({right:10,top:5,data:this.chartLegend,theme:e})})),n)}}],[{key:"getDerivedStateFromProps",value:function(t,e){var r=function(t,e){for(var r=[],n=f()(t),a=f()(e);!n.isAfter(a,"d");)r.push(n.format("MMM D")),n.add(1,"d");return r}(t.usageDateStart,t.usageDateEnd);return et(et({},e),{},{xAxisDates:r})}}]),a}(a.Component);ht.displayName="UsageChart",(0,p.Z)(ht,"defaultProps",{handleDataTransformation:function(t,e){var r={accepted:[],dropped:[],projected:[]},n=e===rt.CUMULATIVE;return Object.keys(t).forEach((function(e){var a=0;r[e]=t[e].map((function(t){var e=(0,A.Z)(t.value,2),r=e[0],o=e[1];return a=n?a+o:o,et(et({},t),{},{value:[r,a]})}))})),r}});const ft=(0,N.Zz)(ht);function mt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function gt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(r),!0).forEach((function(e){(0,p.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}const vt=function(t){(0,c.Z)(h,t);var e,r,o=(e=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,d.Z)(e);if(r){var a=(0,d.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,u.Z)(this,t)});function h(){var t;(0,s.Z)(this,h);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),(0,p.Z)((0,l.Z)(t),"renderChartFooter",(function(){var e=t.props,r=e.dataCategory,n=e.onChangeDataCategory,a=t.state.chartDataTransform;return(0,X.tZ)(P.xx,null,(0,X.tZ)(P.m2,null,(0,X.tZ)(P.uN,null,(0,X.tZ)(w.jt,null)),(0,X.tZ)(P.uN,null)),(0,X.tZ)(P.m2,null,(0,X.tZ)(S.Z,{title:(0,g.t)("Display"),menuWidth:"135px",selected:r,options:ut,onChange:function(t){return n(t)}}),(0,X.tZ)(S.Z,{title:(0,g.t)("Type"),selected:a,options:pt,onChange:function(e){return t.handleSelectDataTransform(e)}})))})),t}return(0,i.Z)(h,[{key:"getDefaultState",value:function(){return gt(gt({},(0,Z.Z)((0,d.Z)(h.prototype),"getDefaultState",this).call(this)),{},{chartDataTransform:rt.CUMULATIVE})}},{key:"getEndpoints",value:function(){return[["orgStats",this.endpointPath,{query:this.endpointQuery}]]}},{key:"endpointPath",get:function(){var t=this.props.organization;return"/organizations/".concat(t.slug,"/stats_v2/")}},{key:"endpointQuery",get:function(){var t=this.props,e=t.dateStart,r=t.dateEnd;return{statsPeriod:"".concat(r.diff(e,"d"),"d"),interval:"1d",groupBy:["category","outcome"],field:["sum(quantity)"]}}},{key:"chartMetadata",get:function(){var t=this.state.orgStats;return gt({},this.mapSeriesToChart(t))}},{key:"handleSelectDataTransform",value:function(t){this.setState({chartDataTransform:t})}},{key:"mapSeriesToChart",value:function(t){var e=this,r={total:"-",accepted:"-",dropped:"-",filtered:"-"},a={accepted:[],dropped:[],projected:[]};if(!t)return{cardData:r,chartData:a};try{var o=this.props.dataCategory,s=t.intervals.map((function(t){return{date:f()(t).format("MMM D"),total:0,accepted:0,filtered:0,dropped:{total:0}}})),i={total:0,accepted:0,dropped:0,invalid:0,filtered:0};t.groups.forEach((function(t){var e=t.by,r=e.outcome,a=e.category;o.includes("".concat(a))&&(i.total+=t.totals["sum(quantity)"],i[r]+=t.totals["sum(quantity)"],t.series["sum(quantity)"].forEach((function(t,e){r!==n.DROPPED&&r!==n.INVALID||(s[e].dropped.total+=t),s[e][r]+=t})))})),i.dropped+=i.invalid,delete i.invalid,s.forEach((function(t){t.total=t.accepted+t.filtered+t.dropped.total,a.accepted.push({value:[t.date,t.accepted]}),a.dropped.push({value:[t.date,t.dropped.total]})}));var l={isAbbreviated:o!==y.cn.ATTACHMENTS,useUnitScaling:o===y.cn.ATTACHMENTS};return{cardData:{total:Q(i.total,o,l),accepted:Q(i.accepted,o,l),dropped:Q(i.dropped,o,l),filtered:Q(i.filtered,o,l)},chartData:a}}catch(n){return x.$e((function(r){r.setContext("query",e.endpointQuery),r.setContext("body",t),x.Tb(n)})),{cardData:r,chartData:a,error:n}}}},{key:"renderCards",value:function(){var t=this.props,e=t.dataCategory,r=t.dataCategoryName,n=this.chartMetadata.cardData,a=n.total,o=n.accepted,s=n.dropped,i=n.filtered,l=[{title:(0,g._N)("Total [dataCategory]",{dataCategory:r}),value:a},{title:(0,g.t)("Accepted"),value:o},{title:(0,g.t)("Filtered"),description:(0,g._N)("Filtered [dataCategory] were blocked due to your inbound data filter rules",{dataCategory:e}),value:i},{title:(0,g.t)("Dropped"),description:(0,g._N)("Dropped [dataCategory] were discarded due to rate-limits, quota limits, or spike protection",{dataCategory:e}),value:s}];return(0,X.tZ)(yt,null,l.map((function(t,e){return(0,X.tZ)(Zt,{key:e},(0,X.tZ)(P.Gh,null,(0,X.tZ)(O.Z,null,t.title),t.description&&(0,X.tZ)(T.Z,{size:"sm",position:"top",title:t.description})),(0,X.tZ)(bt,null,(0,X.tZ)(O.Z,null,t.value)))})))}},{key:"renderChart",value:function(){var t=this.props,e=t.dateStart,r=t.dateEnd,n=t.dataCategory,a=this.state,o=a.chartDataTransform,s=a.error,i=a.loading,l=a.orgStats;if(i)return(0,X.tZ)(R.s_,null,(0,X.tZ)(R.N,null,(0,X.tZ)(E.Z,null)));var c=this.chartMetadata,u=c.chartData,d=c.error;if(s||d||!l)return(0,X.tZ)(R.s_,null,(0,X.tZ)(R.N,null,(0,X.tZ)(D.Z,{height:"256px"},(0,X.tZ)(w.FC,{color:"gray300",size:"lg"}))));var p=e.format("YYYY-MM-DD"),h=r.format("YYYY-MM-DD");return(0,X.tZ)(ft,{footer:this.renderChartFooter(),dataCategory:n,dataTransform:o,usageDateStart:p,usageDateEnd:h,usageStats:u})}},{key:"renderComponent",value:function(){return(0,X.tZ)(a.Fragment,null,this.renderCards(),this.renderChart())}}]),h}(j.Z);var yt=(0,b.Z)("div",{target:"e1uglcux0",label:"CardWrapper"})("display:grid;grid-auto-flow:column;grid-auto-columns:1fr;grid-auto-rows:1fr;grid-gap:",(0,k.Z)(2),";margin-bottom:",(0,k.Z)(3),";@media (max-width:",(function(t){return t.theme.breakpoints[0]}),"){grid-auto-flow:row;}"),Zt=(0,b.Z)(C.Z,{target:"e1uglcux1",label:"StyledCard"})("align-items:flex-start;min-height:95px;padding:",(0,k.Z)(2)," ",(0,k.Z)(3),";color:",(function(t){return t.theme.textColor}),";"),bt=(0,b.Z)("div",{target:"e1uglcux2",label:"CardContent"})("margin-top:",(0,k.Z)(1),";font-size:32px;");const xt=function(t){(0,c.Z)(a,t);var e,r,n=(e=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,d.Z)(e);if(r){var a=(0,d.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,s.Z)(this,a),n.apply(this,arguments)}return(0,i.Z)(a,[{key:"getEndpoints",value:function(){var t=this.props.organization;return[["orgStats","/organizations/".concat(t.slug,"/stats_v2/projects/"),{query:{interval:"1d"}}]]}},{key:"renderError",value:function(t){return(0,X.tZ)(R.s_,null,(0,X.tZ)(R.N,null,"UsageStatsProjects has an error: ",t.message))}},{key:"renderLoading",value:function(){return(0,X.tZ)(R.s_,null,(0,X.tZ)(R.N,null,(0,X.tZ)(E.Z,null)))}},{key:"renderBody",value:function(){return(0,X.tZ)(R.s_,null,(0,X.tZ)(R.N,null,"UsageStatsProjects is okay"))}}]),a}(j.Z);var jt=function(t){(0,c.Z)(a,t);var e,r,n=(e=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,d.Z)(e);if(r){var a=(0,d.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;(0,s.Z)(this,a);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t=n.call.apply(n,[this].concat(r)),(0,p.Z)((0,l.Z)(t),"state",{dataCategory:y.cn.ERRORS,dateStart:f()().subtract(14,"days"),dateEnd:f()()}),(0,p.Z)((0,l.Z)(t),"setDataCategory",(function(e){t.setState({dataCategory:e})})),(0,p.Z)((0,l.Z)(t),"setDateRange",(function(e,r){t.setState({dateStart:e,dateEnd:r})})),t}return(0,i.Z)(a,[{key:"dataCategoryName",get:function(){var t,e=this.state.dataCategory;return null!==(t=y.mL[e])&&void 0!==t?t:(0,g.t)("Unknown Data Category")}},{key:"render",value:function(){var t=this.props.organization,e=this.state,r=e.dataCategory,n=e.dateStart,a=e.dateEnd;return(0,X.tZ)(v.JH,null,(0,X.tZ)(v.mr,null,(0,X.tZ)(m.Z,null,(0,g._N)("Organization Usage Stats for [dataCategory]",{dataCategory:this.dataCategoryName}))),(0,X.tZ)(vt,{organization:t,dataCategory:r,dataCategoryName:this.dataCategoryName,dateStart:n,dateEnd:a,onChangeDataCategory:this.setDataCategory,onChangeDateRange:this.setDateRange}),(0,X.tZ)(xt,{organization:t,dataCategory:r,dataCategoryName:this.dataCategoryName,dateStart:n,dateEnd:a}))}}]),a}(a.Component);jt.displayName="OrganizationStats";const Ct=jt;var Dt=r("../../../../node_modules/@babel/runtime/helpers/esm/extends.js"),St=r("../../../../node_modules/react-document-title/index.js"),Pt=r.n(St),Et=r("./app/utils/withApi.tsx"),Rt=r("./app/components/charts/miniBarChart.tsx"),Tt=r("./app/components/loadingError.tsx"),Ot=r("./app/components/pagination.tsx"),wt=r("./app/components/acl/feature.tsx"),kt=r("./app/components/alert.tsx"),At=function(t){var e=t.message;return(0,X.tZ)(wt.Z,{features:["performance-view"]},(0,X.tZ)(kt.Z,{type:"info",icon:(0,X.tZ)(w.aU,null),"data-test-id":"performance-usage"},e||(0,g.t)("Transactions, sessions, and attachments are not yet included in the chart.")))};At.displayName="PerformanceAlert";const Mt=At;var Lt=r("../../../../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),Nt=r("../../../../node_modules/react-router/es/index.js"),_t=r("./app/components/count.tsx"),zt=r("./app/styles/overflowEllipsis.tsx"),qt=(0,b.Z)("div",{target:"ezq28wl0",label:"ProjectTableLayout"})({name:"1bpd1bq",styles:"display:grid;grid-template-columns:auto 110px 120px 100px 100px;width:100%;"}),It=(0,b.Z)("div",{target:"ezq28wl1",label:"ProjectTableDataElement"})("text-align:right;padding:0 ",(0,k.Z)(.5),";",zt.Z,";"),Bt=function(t){var e=t.projectMap,r=t.projectTotals,n=t.orgTotal,o=t.organization,s=function(t,e){return 0===e?"":(0,H.rl)(t/e,0)};if(!r)return null;var i=r.sort((function(t,e){return e.received-t.received})).map((function(t,r){var a=e[t.id];if(!a)return null;var i=o.features.includes("project-detail")?"/organizations/".concat(o.slug,"/projects/").concat(a.slug,"/?project=").concat(a.id):"/organizations/".concat(o.slug,"/issues/?project=").concat(a.id);return(0,X.tZ)(Ut,{key:r},(0,X.tZ)(Ft,null,(0,X.tZ)(Nt.Link,{to:i},a.slug)),(0,X.tZ)(It,null,(0,X.tZ)(_t.Z,{value:t.accepted}),(0,X.tZ)(Ht,null,s(t.accepted,n.accepted))),(0,X.tZ)(It,null,(0,X.tZ)(_t.Z,{value:t.rejected}),(0,X.tZ)(Ht,null,s(t.rejected,n.rejected))),(0,X.tZ)(It,null,(0,X.tZ)(_t.Z,{value:t.blacklisted}),(0,X.tZ)(Ht,null,s(t.blacklisted,n.blacklisted))),(0,X.tZ)(It,null,(0,X.tZ)(_t.Z,{value:t.received}),(0,X.tZ)(Ht,null,s(t.received,n.received))))}));return(0,X.tZ)(a.Fragment,null,i)};Bt.displayName="ProjectTable";var Ft=(0,b.Z)(It,{target:"e138erfd0",label:"StyledProjectTitle"})({name:"vpdd6b",styles:"display:flex;align-items:center;text-align:left;"}),Ut=(0,b.Z)(qt,{target:"e138erfd1",label:"StyledProjectTableLayout"})("padding:",(0,k.Z)(2),";&:not(:last-child){border-bottom:1px solid ",(function(t){return t.theme.innerBorder}),";}"),Ht=(0,b.Z)((function(t){var e=t.children,r=(0,Lt.Z)(t,["children"]);return""===e?null:(0,X.tZ)("div",r,e)}),{target:"e138erfd2",label:"Percentage"})("margin-top:",(0,k.Z)(.25),";color:",(function(t){return t.theme.gray300}),";font-size:12px;line-height:1.2;");const Wt=Bt;var Yt=r("./app/views/settings/components/text/textBlock.tsx");var Vt=function(t){(0,c.Z)(a,t);var e,r,n=(e=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,d.Z)(e);if(r){var a=(0,d.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,s.Z)(this,a),n.apply(this,arguments)}return(0,i.Z)(a,[{key:"renderContent",value:function(){var t=this.props,e=t.statsLoading,r=t.orgTotal,n=t.statsError,a=t.orgSeries,o=t.projectsLoading,s=t.projectTotals,i=t.projectMap,l=t.projectsError,c=t.organization,u=null==a?void 0:a.map((function(t){return t.color||""}));return(0,X.tZ)("div",null,(0,X.tZ)(m.Z,{withMargins:!0},(0,g.t)("Organization Stats")),(0,X.tZ)("div",{className:"row"},(0,X.tZ)("div",{className:"col-md-9"},(0,X.tZ)(Yt.Z,null,(0,g.t)("The chart below reflects events the system has received\n                across your entire organization. Events are broken down into\n                three categories: Accepted, Rate Limited, and Filtered. Rate\n                Limited events are entries that the system threw away due to quotas\n                being hit, and Filtered events are events that were blocked\n                due to your inbound data filter rules."))),r&&(0,X.tZ)("div",{className:"col-md-3 stats-column"},(0,X.tZ)("h6",{className:"nav-header"},(0,g.t)("Events per minute")),(0,X.tZ)("p",{className:"count"},r.avgRate))),(0,X.tZ)("div",null,(0,X.tZ)(Mt,null),e?(0,X.tZ)(E.Z,null):n?(0,X.tZ)(Tt.Z,null):(0,X.tZ)(R.s_,null,(0,X.tZ)(R.N,{withPadding:!0},(0,X.tZ)(Rt.Z,{isGroupedByDate:!0,showTimeInTooltip:!0,labelYAxisExtents:!0,stacked:!0,height:150,colors:u,series:null!=a?a:void 0})))),(0,X.tZ)(R.s_,null,(0,X.tZ)(R.V9,null,(0,X.tZ)(qt,null,(0,X.tZ)("div",null,(0,g.t)("Project")),(0,X.tZ)(It,null,(0,g.t)("Accepted")),(0,X.tZ)(It,null,(0,g.t)("Rate Limited")),(0,X.tZ)(It,null,(0,g.t)("Filtered")),(0,X.tZ)(It,null,(0,g.t)("Total")))),(0,X.tZ)(R.N,null,!r||!s||e||o?(0,X.tZ)(E.Z,null):l?(0,X.tZ)(Tt.Z,null):(0,X.tZ)(Wt,{projectTotals:s,orgTotal:r,organization:c,projectMap:i}))),this.props.pageLinks&&(0,X.tZ)(Ot.Z,this.props))}},{key:"render",value:function(){return(0,X.tZ)(v.JH,null,this.renderContent())}}]),a}(a.Component);Vt.displayName="OrganizationStats";const Gt=Vt;var Jt=function(t){(0,c.Z)(a,t);var e,r,n=(e=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,d.Z)(e);if(r){var a=(0,d.Z)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;(0,s.Z)(this,a),e=n.call(this,t);var r=Math.floor((new Date).getTime()/1e3),o=r-604800;return e.state={projectsError:!1,projectsLoading:!1,projectsRequestsPending:0,statsError:!1,statsLoading:!1,statsRequestsPending:0,projectMap:{},rawProjectData:{received:{},rejected:{},blacklisted:{}},rawOrgData:{received:[],rejected:[],blacklisted:[]},orgSeries:null,orgTotal:null,projectTotals:null,querySince:o,queryUntil:r,pageLinks:null},e}return(0,i.Z)(a,[{key:"UNSAFE_componentWillMount",value:function(){this.fetchData()}},{key:"UNSAFE_componentWillReceiveProps",value:function(t){t.location.search!==this.props.location.search&&this.setState({projectsError:!1,projectsRequestsPending:1,projectsLoading:!0})}},{key:"componentDidUpdate",value:function(t){var e=t.params,r=this.props.params;e.orgId!==r.orgId&&this.fetchData(),t.location.search!==this.props.location.search&&(window.scrollTo&&window.scrollTo(0,0),this.fetchProjectData());var n=this.state;n.statsLoading&&!n.statsRequestsPending&&this.processOrgData(),n.projectsLoading&&!n.projectsRequestsPending&&this.processProjectData()}},{key:"fetchProjectData",value:function(){var t=this;this.props.api.request(this.getOrganizationProjectsEndpoint(),{query:this.props.location.query,success:function(e,r,n){var a={};e.forEach((function(t){a[t.id]=t})),t.setState((function(t){return{pageLinks:n?n.getResponseHeader("Link"):null,projectMap:a,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})}},{key:"fetchData",value:function(){var t=this;this.setState({statsError:!1,statsLoading:!0,statsRequestsPending:3,projectsError:!1,projectsLoading:!0,projectsRequestsPending:4});var e=this.getOrganizationStatsEndpoint();Object.keys(this.state.rawOrgData).forEach((function(r){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,resolution:"1h",stat:r},success:function(e){t.setState((function(t){var n=t.rawOrgData;return n[r]=e,{rawOrgData:n,statsRequestsPending:t.statsRequestsPending-1}}))},error:function(){t.setState({statsError:!0})}})})),Object.keys(this.state.rawProjectData).forEach((function(r){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,stat:r,group:"project"},success:function(e){t.setState((function(t){var n=t.rawProjectData;return n[r]=e,{rawProjectData:n,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})})),this.fetchProjectData()}},{key:"getOrganizationStatsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/stats/"}},{key:"getOrganizationProjectsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/projects/"}},{key:"processOrgData",value:function(){var t=0,e=0,r=0,n=[0,0],a=this.state.rawOrgData,o={seriesName:(0,g.t)("Accepted"),color:W.ZP.gray200,data:[]},s={seriesName:(0,g.t)("Rate limited"),color:W.ZP.red300,data:[]},i={seriesName:(0,g.t)("Filtered"),color:W.ZP.orange400,data:[]};a.received.forEach((function(l,c){var u=l[1],d=a.rejected[c][1],p=a.blacklisted[c][1],h=Math.max(0,u-d-p),f=1e3*l[0];o.data.push({name:f,value:h}),s.data.push({name:f,value:d}),i.data.push({name:f,value:p}),t+=u,e+=d,r+=p,u>0&&(n[0]+=u,n[1]+=1)})),this.setState({orgSeries:[o,s,i],orgTotal:{id:"",received:t,rejected:e,blacklisted:r,accepted:Math.max(0,t-e-r),avgRate:n[1]?Math.round(n[0]/n[1]/60):0},statsLoading:!1})}},{key:"processProjectData",value:function(){var t=this.state.rawProjectData,e=[];Object.keys(t.received).forEach((function(r){var n=t.received[r],a=0,o=0,s=0;n.forEach((function(e,n){a+=e[1],o+=t.rejected[r][n][1],s+=t.blacklisted[r][n][1]})),e.push({id:r,received:a,rejected:o,blacklisted:s,accepted:Math.max(0,a-o-s)})})),this.setState({projectTotals:e,projectsLoading:!1})}},{key:"render",value:function(){var t=this.props.organization;return(0,X.tZ)(Pt(),{title:"Stats - ".concat(t.slug," - Sentry")},(0,X.tZ)(Gt,(0,Dt.Z)({organization:t},this.state)))}}]),a}(a.Component);Jt.displayName="OrganizationStatsContainer";const Qt=(0,Et.Z)(Jt),Kt=(0,o.Z)((function(t){return t.organization.features.includes("usage-stats-graph")||window.localStorage.getItem("ORG_STATS_REDESIGN")?(0,X.tZ)(Ct,t):(0,X.tZ)(Qt,t)}))}}]);
//# sourceMappingURL=OrganizationStats.js.map