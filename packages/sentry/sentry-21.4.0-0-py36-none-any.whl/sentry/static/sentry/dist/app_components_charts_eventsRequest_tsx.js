(self.webpackChunk=self.webpackChunk||[]).push([["app_components_charts_eventsRequest_tsx"],{"./app/actionCreators/events.tsx":(e,t,r)=>{"use strict";r.d(t,{lI:()=>h,eV:()=>v,JE:()=>g});var n=r("../../../../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),s=r("../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../../../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../../../../node_modules/@babel/runtime/regenerator/index.js"),i=r.n(a),u=r("../../../../node_modules/lodash/pick.js"),l=r.n(u),c=r("./app/components/charts/utils.tsx"),d=r("./app/constants/globalSelectionHeader.tsx"),p=r("./app/utils/getPeriod.tsx");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(e,t){var r=t.organization,n=t.project,s=t.environment,a=t.period,i=t.start,u=t.end,l=t.interval,d=t.includePrevious,m=t.query,h=t.yAxis,v=t.field,b=t.topEvents,g=t.orderby,y=t.partial,j=(0,c.Sw)(d,a),P=Object.fromEntries(Object.entries({interval:l,project:n,environment:s,query:m,yAxis:h,field:v,topEvents:b,orderby:g,partial:y?"1":void 0}).filter((function(e){return void 0!==(0,o.Z)(e,2)[1]}))),D=(0,p.X)({period:a,start:i,end:u},{shouldDoublePeriod:j});return e.requestPromise("/organizations/".concat(r.slug,"/events-stats/"),{query:f(f({},P),D)})};function v(e,t,r){return b.apply(this,arguments)}function b(){return(b=(0,n.Z)(i().mark((function e(t,r,n){var s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l()(n,Object.values(d.nF)),o=f(f({},s),{},{query:n.query}),e.abrupt("return",t.requestPromise("/organizations/".concat(r,"/events-facets/"),{query:o}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r){return y.apply(this,arguments)}function y(){return(y=(0,n.Z)(i().mark((function e(t,r,n){var s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l()(n,Object.values(d.nF)),o=f(f({},s),{},{query:n.query}),e.abrupt("return",t.requestPromise("/organizations/".concat(r,"/events-meta/"),{query:o}).then((function(e){return e.count})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},"./app/components/charts/eventsRequest.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>S});var n=r("../../../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),s=r("../../../../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),o=r("../../../../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),a=r("../../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../../../../node_modules/@babel/runtime/helpers/esm/createClass.js"),u=r("../../../../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),l=r("../../../../node_modules/@babel/runtime/helpers/esm/inherits.js"),c=r("../../../../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=r("../../../../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),p=r("../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),m=r("../../../../node_modules/@babel/runtime/regenerator/index.js"),f=r.n(m),h=r("../../../../node_modules/react/index.js"),v=r("../../../../node_modules/lodash/isEqual.js"),b=r.n(v),g=r("../../../../node_modules/lodash/omitBy.js"),y=r.n(g),j=r("./app/actionCreators/events.tsx"),P=r("./app/actionCreators/indicator.tsx"),D=r("./app/components/charts/loadingPanel.tsx"),O=r("./app/components/charts/utils.tsx"),x=r("./app/locale.tsx"),w=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){(0,p.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k=["api","children","organization","loading"],T=function(e){return y()(e,(function(e,t){return k.includes(t)}))},q=function(e){(0,l.Z)(h,e);var t,r,m=(t=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,d.Z)(t);if(r){var s=(0,d.Z)(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return(0,c.Z)(this,e)});function h(){var e;(0,a.Z)(this,h);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e=m.call.apply(m,[this].concat(r)),(0,p.Z)((0,u.Z)(e),"state",{reloading:!!e.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,p.Z)((0,u.Z)(e),"unmounting",!1),(0,p.Z)((0,u.Z)(e),"fetchData",(0,o.Z)(f().mark((function t(){var r,n,o,a,i,u,l,c;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.props,n=r.api,o=r.confirmedQuery,a=r.expired,i=r.name,u=r.hideError,l=(0,s.Z)(r,["api","confirmedQuery","expired","name","hideError"]),c=null,!1!==o){t.next=4;break}return t.abrupt("return");case 4:if(e.setState((function(e){return{reloading:null!==e.timeseriesData,errored:!1}})),!a){t.next=10;break}(0,P.Iw)((0,x.t)("%s has an invalid date range. Please try a more recent date range.",i),{append:!0}),e.setState({errored:!0}),t.next=21;break;case 10:return t.prev=10,n.clear(),t.next=14,(0,j.lI)(n,l);case 14:c=t.sent,t.next=21;break;case 17:t.prev=17,t.t0=t.catch(10),u||(t.t0&&t.t0.responseJSON&&t.t0.responseJSON.detail?(0,P.Iw)(t.t0.responseJSON.detail):(0,P.Iw)((0,x.t)("Error loading chart data"))),e.setState({errored:!0});case 21:if(!e.unmounting){t.next=23;break}return t.abrupt("return");case 23:e.setState({reloading:!1,timeseriesData:c,fetchedWithPrevious:l.includePrevious});case 24:case"end":return t.stop()}}),t,null,[[10,17]])})))),(0,p.Z)((0,u.Z)(e),"getData",(function(t){var r=e.state.fetchedWithPrevious,n=e.props,s=n.period,o=n.includePrevious,a=r||(0,O.Sw)(o,s),i=Math.floor(t.length/2);return{current:a?t.slice(i):t,previous:a?t.slice(0,i):null}})),e}return(0,i.Z)(h,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentDidUpdate",value:function(e){b()(T(e),T(this.props))||this.fetchData()}},{key:"componentWillUnmount",value:function(){this.unmounting=!0}},{key:"calculateTotalsPerTimestamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 1e3*e};return e.map((function(e,r){var s=(0,n.Z)(e,2),o=s[0],a=s[1];return{name:t(o,a,r),value:a.reduce((function(e,t){return e+t.count}),0)}}))}},{key:"transformPreviousPeriodData",value:function(e,t){var r;return t?{seriesName:null!==(r=this.props.previousSeriesName)&&void 0!==r?r:"Previous",data:this.calculateTotalsPerTimestamp(t,(function(t,r,n){return 1e3*e[n][0]}))}:null}},{key:"transformAggregatedTimeseries",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{seriesName:t,data:this.calculateTotalsPerTimestamp(e)}}},{key:"transformTimeseriesData",value:function(e,t){return[{seriesName:t||"Current",data:e.map((function(e){var t=(0,n.Z)(e,2);return{name:1e3*t[0],value:t[1].reduce((function(e,t){return e+t.count}),0)}}))}]}},{key:"processData",value:function(e){if(!e)return{};var t=e.data,r=e.totals,n=this.props,s=n.includeTransformedData,o=n.includeTimeAggregation,a=n.timeAggregationSeriesName,i=this.getData(t),u=i.current,l=i.previous;return{data:s?this.transformTimeseriesData(u,this.props.currentSeriesName):[],allData:t,originalData:u,totals:r,originalPreviousData:l,previousData:s?this.transformPreviousPeriodData(u,l):null,timeAggregatedData:o?this.transformAggregatedTimeseries(u,a||""):{}}}},{key:"render",value:function(){var e=this,t=this.props,r=t.children,n=t.showLoading,o=(0,s.Z)(t,["children","showLoading"]),a=this.state,i=a.timeseriesData,u=a.reloading,l=a.errored,c=this.props.loading||null===i;if(n&&c)return(0,w.tZ)(D.Z,{"data-test-id":"events-request-loading"});if((0,O.Xe)(i))return r(_({loading:c,reloading:u,errored:l,results:Object.keys(i).map((function(t){var r=i[t],n=e.transformTimeseriesData(r.data,t)[0];return[r.order||0,n]})).sort((function(e,t){return e[0]-t[0]})).map((function(e){return e[1]}))},o));var d=this.processData(i);return r(_({loading:c,reloading:u,errored:l,timeseriesData:d.data,allTimeseriesData:d.allData,originalTimeseriesData:d.originalData,timeseriesTotals:d.totals,originalPreviousTimeseriesData:d.originalPreviousData,previousTimeseriesData:d.previousData,timeAggregatedData:d.timeAggregatedData},o))}}]),h}(h.PureComponent);q.displayName="EventsRequest",(0,p.Z)(q,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const S=q},"./app/components/charts/loadingPanel.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var n=r("../../../../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),s=r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),o=(r("../../../../node_modules/react/index.js"),r("./app/components/loadingMask.tsx")),a=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js"),i=(0,s.Z)((function(e){e.height;var t=(0,n.Z)(e,["height"]);return(0,a.tZ)("div",t,(0,a.tZ)(o.Z,null))}),{target:"e1ply9d40",label:"LoadingPanel"})("flex:1;flex-shrink:0;overflow:hidden;height:",(function(e){return e.height}),";position:relative;border-color:transparent;margin-bottom:0;");i.defaultProps={height:"200px"};const u=i},"./app/components/loadingMask.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n=(0,r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js").Z)("div",{target:"e4k24ed0",label:"LoadingMask"})("background-color:",(function(e){return e.theme.backgroundSecondary}),";border-radius:",(function(e){return e.theme.borderRadius}),";position:absolute;top:0;bottom:0;left:0;right:0;")},"./app/utils/getPeriod.tsx":(e,t,r)=>{"use strict";r.d(t,{X:()=>u});var n=r("../../../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),s=r("../../../../node_modules/moment/moment.js"),o=r.n(s),a=r("./app/constants/index.tsx"),i=r("./app/utils/dates.tsx"),u=function(e){var t=e.period,r=e.start,s=e.end,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=u.shouldDoublePeriod;if(t||r||s||(t=a.GY),t){if(!l)return{statsPeriod:t};var c=t.match(/([0-9]+)([mhdw])/),d=(0,n.Z)(c,3),p=d[1],m=d[2];return{statsPeriod:"".concat(2*parseInt(p,10)).concat(m)}}if(!r||!s)throw new Error("start and end required");var f=(0,i.v5)(r),h=(0,i.v5)(s);if(l){var v=o()(s).diff(o()(r)),b=o()(r).subtract(v);return{start:(0,i.v5)(b),end:h}}return{start:f,end:h}}},"../../../../node_modules/lodash/negate.js":e=>{e.exports=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},"../../../../node_modules/lodash/omitBy.js":(e,t,r)=>{var n=r("../../../../node_modules/lodash/_baseIteratee.js"),s=r("../../../../node_modules/lodash/negate.js"),o=r("../../../../node_modules/lodash/pickBy.js");e.exports=function(e,t){return o(e,s(n(t)))}}}]);
//# sourceMappingURL=app_components_charts_eventsRequest_tsx.js.map