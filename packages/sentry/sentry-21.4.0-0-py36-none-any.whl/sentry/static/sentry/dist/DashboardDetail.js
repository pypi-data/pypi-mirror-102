(self.webpackChunk=self.webpackChunk||[]).push([["DashboardDetail"],{"./app/actionCreators/dashboards.tsx":(e,t,n)=>{"use strict";n.d(t,{JR:()=>o,Y:()=>s,iM:()=>i,QL:()=>d});var r=n("./app/actionCreators/indicator.tsx"),a=n("./app/locale.tsx");function o(e,t,n){var o=n.title,s=n.widgets,i=e.requestPromise("/organizations/".concat(t,"/dashboards/"),{method:"POST",data:{title:o,widgets:s}});return i.catch((function(e){var t,n=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;n?(0,r.Iw)(n):(0,r.Iw)((0,a.t)("Unable to create dashboard"))})),i}function s(e,t,n){var o={title:n.title,widgets:n.widgets},s=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(n.id,"/"),{method:"PUT",data:o});return s.catch((function(e){var t,n=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;n?(0,r.Iw)(n):(0,r.Iw)((0,a.t)("Unable to update dashboard"))})),s}function i(e,t,n){var o=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(n,"/"),{method:"DELETE"});return o.catch((function(e){var t,n=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;n?(0,r.Iw)(n):(0,r.Iw)((0,a.t)("Unable to delete dashboard"))})),o}function d(e,t,n){return e.requestPromise("/organizations/".concat(t,"/dashboards/widgets/"),{method:"POST",data:n})}},"./app/components/inputInline.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n("../../../../node_modules/@babel/runtime/helpers/esm/extends.js"),a=n("../../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=n("../../../../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../../../../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),i=n("../../../../node_modules/@babel/runtime/helpers/esm/inherits.js"),d=n("../../../../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=n("../../../../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=n("../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),u=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),p=n("../../../../node_modules/react/index.js"),h=n("./app/icons/index.tsx"),f=n("./app/styles/space.tsx"),b=n("./app/utils/callIfFunction.tsx"),m=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");var g=function(e){(0,i.Z)(h,e);var t,n,u=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.Z)(t);if(n){var a=(0,l.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,d.Z)(this,e)});function h(){var e;(0,a.Z)(this,h);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=u.call.apply(u,[this].concat(n)),(0,c.Z)((0,s.Z)(e),"state",{isFocused:!1,isHovering:!1}),(0,c.Z)((0,s.Z)(e),"refInput",p.createRef()),(0,c.Z)((0,s.Z)(e),"blur",(function(){e.refInput.current&&e.refInput.current.blur()})),(0,c.Z)((0,s.Z)(e),"focus",(function(){e.refInput.current&&(e.refInput.current.focus(),document.execCommand("selectAll",!1,void 0))})),(0,c.Z)((0,s.Z)(e),"onBlur",(function(t){e.setState({isFocused:!1,isHovering:!1}),(0,b.g)(e.props.onBlur,h.setValueOnEvent(t))})),(0,c.Z)((0,s.Z)(e),"onFocus",(function(t){e.setState({isFocused:!0}),(0,b.g)(e.props.onFocus,h.setValueOnEvent(t)),window.setTimeout((function(){return document.execCommand("selectAll",!1,void 0)}),1)})),(0,c.Z)((0,s.Z)(e),"onChangeUsingOnInput",(function(t){(0,b.g)(e.props.onChange,h.setValueOnEvent(t))})),(0,c.Z)((0,s.Z)(e),"onKeyDown",(function(t){"Enter"===t.key&&(t.preventDefault(),e.refInput.current&&e.refInput.current.blur()),(0,b.g)(e.props.onKeyUp,h.setValueOnEvent(t))})),(0,c.Z)((0,s.Z)(e),"onKeyUp",(function(t){"Escape"===t.key&&e.refInput.current&&e.refInput.current.blur(),(0,b.g)(e.props.onKeyUp,h.setValueOnEvent(t))})),(0,c.Z)((0,s.Z)(e),"onMouseEnter",(function(){e.setState({isHovering:!e.props.disabled})})),(0,c.Z)((0,s.Z)(e),"onMouseMove",(function(){e.setState({isHovering:!e.props.disabled})})),(0,c.Z)((0,s.Z)(e),"onMouseLeave",(function(){e.setState({isHovering:!1})})),(0,c.Z)((0,s.Z)(e),"onClickIcon",(function(t){e.props.disabled||(e.refInput.current&&(e.refInput.current.focus(),document.execCommand("selectAll",!1,void 0)),(0,b.g)(e.props.onClick,h.setValueOnEvent(t)))})),e}return(0,o.Z)(h,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.placeholder,a=e.disabled,o=this.state.isFocused,s=t||n||"";return(0,m.tZ)(v,{style:this.props.style,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},(0,m.tZ)(y,(0,r.Z)({},this.props,{ref:this.refInput,suppressContentEditableWarning:!0,contentEditable:!this.props.disabled,isHovering:this.state.isHovering,isDisabled:this.props.disabled,onBlur:this.onBlur,onFocus:this.onFocus,onInput:this.onChangeUsingOnInput,onChange:this.onChangeUsingOnInput,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp}),s),!o&&!a&&(0,m.tZ)("div",{onClick:this.onClickIcon},(0,m.tZ)(Z,null)))}}],[{key:"setValueOnEvent",value:function(e){var t=e.target.innerText||e.currentTarget.innerText;return e.target.value=t,e.currentTarget.value=t,e}}]),h}(p.Component);g.displayName="InputInline";var v=(0,u.Z)("div",{target:"e9oz5gz0",label:"Wrapper"})({name:"1684o59",styles:"display:inline-flex;align-items:center;vertical-align:text-bottom;"}),y=(0,u.Z)("div",{target:"e9oz5gz1",label:"Input"})("min-width:40px;margin:0;border:1px solid ",(function(e){return e.isHovering?e.theme.border:"transparent"}),";outline:none;line-height:inherit;border-radius:",(0,f.Z)(.5),";background:transparent;padding:1px;&:focus,&:active{border:1px solid ",(function(e){return e.isDisabled?"transparent":e.theme.border}),";background-color:",(function(e){return e.isDisabled?"transparent":e.theme.gray200}),";}"),Z=(0,u.Z)(h.yl,{target:"e9oz5gz2",label:"StyledIconEdit"})("color:",(function(e){return e.theme.gray300}),";margin-left:",(0,f.Z)(.5),";&:hover{cursor:pointer;}");const w=g},"./app/components/sentryDocumentTitle.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>i}),n("../../../../node_modules/react/index.js");var r=n("../../../../node_modules/react-document-title/index.js"),a=n.n(r),o=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function s(e){var t=e.title,n=e.orgSlug,r=e.projectSlug,s=e.children,i=n||r?n&&r?"".concat(t," - ").concat(n," - ").concat(r):n?"".concat(t," - ").concat(n):"".concat(t," - ").concat(r):t;return(0,o.tZ)(a(),{title:"".concat(i," - Sentry")},s)}s.displayName="SentryDocumentTitle";const i=s},"./app/views/dashboardsV2/detail.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Pe});var r=n("../../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=n("../../../../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=n("../../../../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),s=n("../../../../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=n("../../../../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=n("../../../../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=n("../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),c=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),u=n("../../../../node_modules/react/index.js"),p=n("../../../../node_modules/react-router/es/index.js"),h=n("../../../../node_modules/lodash/isEqual.js"),f=n.n(h),b=n("./app/actionCreators/dashboards.tsx"),m=n("./app/actionCreators/indicator.tsx"),g=n("./app/components/errors/notFound.tsx"),v=n("./app/components/loadingIndicator.tsx"),y=n("./app/components/organizations/globalSelectionHeader/index.tsx"),Z=n("./app/locale.tsx"),w=n("./app/styles/space.tsx"),D=n("./app/utils/analytics.tsx"),x=n("./app/utils/withApi.tsx"),C=n("./app/utils/withOrganization.tsx"),S=n("./app/components/acl/feature.tsx"),O=n("./app/components/acl/featureDisabled.tsx"),k=n("./app/components/button.tsx"),j=n("./app/components/buttonBar.tsx"),z=n("./app/components/confirm.tsx"),I=n("./app/components/forms/selectControl.tsx"),E=n("./app/components/hovercard.tsx"),P=n("./app/icons/index.tsx"),R=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");var _=function(e){(0,s.Z)(l,e);var t,n,o=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(t);if(n){var a=(0,d.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,i.Z)(this,e)});function l(){return(0,r.Z)(this,l),o.apply(this,arguments)}return(0,a.Z)(l,[{key:"render",value:function(){var e=this,t=this.props,n=t.dashboardState,r=t.dashboards,a=t.dashboard,o=t.onEdit,s=t.onCreate,i=t.onCancel,d=t.onCommit,l=t.onDelete,c=(0,R.tZ)(k.ZP,{"data-test-id":"dashboard-cancel",onClick:function(e){e.preventDefault(),i()}},(0,Z.t)("Cancel"));if(["edit","pending_delete"].includes(n))return(0,R.tZ)(j.Z,{gap:1,key:"edit-controls"},c,(0,R.tZ)(z.Z,{priority:"danger",message:(0,Z.t)("Are you sure you want to delete this dashboard?"),onConfirm:l},(0,R.tZ)(k.ZP,{"data-test-id":"dashboard-delete",priority:"danger"},(0,Z.t)("Delete"))),(0,R.tZ)(k.ZP,{"data-test-id":"dashboard-commit",onClick:function(e){e.preventDefault(),d()},priority:"primary"},(0,Z.t)("Save and Finish")));if("create"===n)return(0,R.tZ)(j.Z,{gap:1,key:"create-controls"},c,(0,R.tZ)(k.ZP,{"data-test-id":"dashboard-commit",onClick:function(e){e.preventDefault(),d()},priority:"primary"},(0,Z.t)("Save and Finish")));var u=r.map((function(e){return{label:e.title,value:e}})),h=void 0;return a?h={label:a.title,value:a}:u.length&&(h=u[0]),(0,R.tZ)(N,{gap:1,key:"controls"},(0,R.tZ)(B,null,(0,R.tZ)(I.Z,{key:"select",name:"parameter",placeholder:(0,Z.t)("Select Dashboard"),options:u,value:h,onChange:function(t){var n=t.value,r=e.props.organization;p.browserHistory.push({pathname:"/organizations/".concat(r.slug,"/dashboards/").concat(n.id,"/"),query:{}})}})),(0,R.tZ)(U,null,(function(e){return(0,R.tZ)(k.ZP,{"data-test-id":"dashboard-create",onClick:function(e){e.preventDefault(),s()},icon:(0,R.tZ)(P.N_,{size:"xs",isCircled:!0}),disabled:!e},(0,Z.t)("Create Dashboard"))})),(0,R.tZ)(U,null,(function(e){return(0,R.tZ)(k.ZP,{"data-test-id":"dashboard-edit",onClick:function(e){e.preventDefault(),o()},priority:"primary",icon:(0,R.tZ)(P.yl,{size:"xs"}),disabled:!e},(0,Z.t)("Edit Dashboard"))})))}}]),l}(u.Component);_.displayName="Controls";var U=function(e){var t=e.children,n=(0,Z.t)("Requires dashboard editing.");return(0,R.tZ)(S.Z,{hookName:"feature-disabled:dashboards-edit",features:["organizations:dashboards-edit"],renderDisabled:function(e){return(0,R.tZ)(E.ZP,{body:(0,R.tZ)(O.Z,{features:e.features,hideHelpToggle:!0,message:n,featureName:n})},e.children(e))}},(function(e){var n=e.hasFeature;return t(n)}))};U.displayName="DashboardEditFeature";var B=(0,c.Z)("div",{target:"e104d2ty0",label:"DashboardSelect"})("min-width:200px;font-size:",(function(e){return e.theme.fontSizeMedium}),";"),N=(0,c.Z)(j.Z,{target:"e104d2ty1",label:"StyledButtonBar"})("flex-shrink:0;@media (max-width:",(function(e){return e.theme.breakpoints[0]}),"){grid-auto-flow:row;grid-row-gap:",(0,w.Z)(1),";width:100%;}");const A=_;var W=n("../../../../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),T=n("../../../../node_modules/@dnd-kit/core/dist/core.esm.js"),M=n("../../../../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),q=n("./app/actionCreators/modal.tsx"),F=n("./app/actionCreators/tags.tsx"),H=n("./app/utils/withGlobalSelection.tsx"),K=n("./app/views/dashboardsV2/types.tsx"),Y=n("../../../../node_modules/framer-motion/dist/es/render/dom/motion.js");const V=(0,c.Z)(Y.E.div,{target:"e9u4e0g0",label:"WidgetWrapper"})("position:relative;touch-action:manipulation;",(function(e){switch(e.displayType){case"big_number":return"\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ".concat(e.theme.breakpoints[0],") {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ").concat(e.theme.breakpoints[3],") {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        ");default:return"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "}}),";");var L="add-widget-button",X={x:0,y:0,scaleX:1,scaleY:1};function J(e){var t=e.onClick,n=e.orgFeatures,r=e.orgSlug,a=(0,M.nB)({disabled:!0,id:L,transition:null}),o=a.setNodeRef,s=a.transform;return(0,R.tZ)(V,{key:"add",ref:o,displayType:K.F.BIG_NUMBER,layoutId:L,style:{originX:0,originY:0},animate:s?{x:s.x,y:s.y,scaleX:null!=s&&s.scaleX&&s.scaleX<=1?s.scaleX:1,scaleY:null!=s&&s.scaleY&&s.scaleY<=1?s.scaleY:1}:X,transition:{duration:.25}},n.includes("metrics")?(0,R.tZ)($,null,(0,R.tZ)(j.Z,{gap:1},(0,R.tZ)(k.ZP,{to:"/organizations/".concat(r,"/dashboards/widget/new/?dataSet=metrics")},(0,Z.t)("Add metrics widget")),(0,R.tZ)(k.ZP,{onClick:t},(0,Z.t)("Add events widget")))):(0,R.tZ)($,{onClick:t},(0,R.tZ)(Q,{"data-test-id":"widget-add",onClick:t,icon:(0,R.tZ)(P.N_,{size:"lg",isCircled:!0,color:"inactive"})})))}J.displayName="AddWidget";const G=J;var Q=(0,c.Z)(k.ZP,{target:"e1wks03l0",label:"AddButton"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),$=(0,c.Z)("div",{target:"e1wks03l1",label:"InnerWrapper"})("width:100%;height:110px;border:2px dashed ",(function(e){return e.theme.border}),";border-radius:",(function(e){return e.theme.borderRadius}),";display:flex;align-items:center;justify-content:center;cursor:",(function(e){return e.onClick?"pointer":""}),";"),ee=n("./app/utils/theme.tsx"),te=n("./app/views/dashboardsV2/widgetCard.tsx"),ne={x:0,y:0,scaleX:1,scaleY:1,zIndex:"auto"};function re(e){var t=e.widget,n=e.dragId,r=e.isEditing,a=e.onDelete,o=e.onEdit,s=(0,M.nB)({id:n,transition:null}),i=s.attributes,d=s.listeners,l=s.setNodeRef,c=s.transform,p=s.isDragging,h=s.isSorting;return(0,u.useEffect)((function(){if(p)return document.body.style.cursor="grabbing",function(){document.body.style.cursor=""}}),[p]),(0,R.tZ)(V,{ref:l,displayType:t.displayType,layoutId:n,style:{originX:p?1:0,originY:0,boxShadow:p?ee.ZP.dropShadowHeavy:"none",borderRadius:p?ee.ZP.borderRadius:void 0},animate:c?{x:c.x,y:c.y,scaleX:null!=c&&c.scaleX&&c.scaleX<=1?c.scaleX:1,scaleY:null!=c&&c.scaleY&&c.scaleY<=1?c.scaleY:1,zIndex:p?ee.ZP.zIndex.modal:"auto"}:ne,transition:{duration:p?0:.25,easings:{type:"spring"}}},(0,R.tZ)(te.Z,{widget:t,isEditing:r,onDelete:a,onEdit:o,isSorting:h,hideToolbar:h,currentWidgetDragging:p,draggableProps:{attributes:i,listeners:d},showContextMenu:!0}))}re.displayName="SortableWidget";const ae=re;var oe=function(e){(0,s.Z)(u,e);var t,n,c=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(t);if(n){var a=(0,d.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,i.Z)(this,e)});function u(){var e;(0,r.Z)(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=c.call.apply(c,[this].concat(n)),(0,l.Z)((0,o.Z)(e),"handleStartAdd",(function(){var t=e.props,n=t.organization,r=t.dashboard,a=t.selection;(0,q.openAddDashboardWidgetModal)({organization:n,dashboard:r,selection:a,onAddWidget:e.handleAddComplete})})),(0,l.Z)((0,o.Z)(e),"handleAddComplete",(function(t){e.props.onUpdate([].concat((0,W.Z)(e.props.dashboard.widgets),[t]))})),(0,l.Z)((0,o.Z)(e),"handleUpdateComplete",(function(t){return function(n){var r=(0,W.Z)(e.props.dashboard.widgets);r[t]=n,e.props.onUpdate(r)}})),(0,l.Z)((0,o.Z)(e),"handleDeleteWidget",(function(t){return function(){var n=(0,W.Z)(e.props.dashboard.widgets);n.splice(t,1),e.props.onUpdate(n)}})),(0,l.Z)((0,o.Z)(e),"handleEditWidget",(function(t,n){return function(){var r=e.props,a=r.organization,o=r.dashboard,s=r.selection;(0,q.openAddDashboardWidgetModal)({organization:a,dashboard:o,widget:t,selection:s,onAddWidget:e.handleAddComplete,onUpdateWidget:e.handleUpdateComplete(n)})}})),e}return(0,a.Z)(u,[{key:"componentDidMount",value:function(){this.props.isEditing&&this.fetchTags()}},{key:"componentDidUpdate",value:function(e){var t=this.props.isEditing;e.isEditing!==t&&t&&this.fetchTags()}},{key:"fetchTags",value:function(){var e=this.props,t=e.api,n=e.organization,r=e.selection;(0,F.QK)(t,n.slug,r)}},{key:"getWidgetIds",value:function(){return[].concat((0,W.Z)(this.props.dashboard.widgets.map((function(e,t){return de(e,t)}))),[L])}},{key:"renderWidget",value:function(e,t){var n=this.props.isEditing,r=de(e,t),a=r;return(0,R.tZ)(ae,{key:r,widget:e,dragId:a,isEditing:n,onDelete:this.handleDeleteWidget(t),onEdit:this.handleEditWidget(e,t)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.isEditing,r=t.onUpdate,a=t.dashboard.widgets,o=t.organization,s=this.getWidgetIds();return(0,R.tZ)(T.LB,{collisionDetection:T.pE,onDragEnd:function(e){var t=e.over,n=e.active.id,o=s.indexOf.bind(s),i=n?o(n):-1;if(t&&t.id!==L){var d=o(t.id);i!==d&&r((0,M.Rp)(a,i,d))}}},(0,R.tZ)(ie,null,(0,R.tZ)(M.Fo,{items:s,strategy:M.U2},a.map((function(t,n){return e.renderWidget(t,n)})),n&&(0,R.tZ)(G,{orgSlug:o.slug,orgFeatures:o.features,onClick:this.handleStartAdd}))))}}]),u}(u.Component);oe.displayName="Dashboard";const se=(0,x.Z)((0,H.Z)(oe));var ie=(0,c.Z)("div",{target:"e1nz851n0",label:"WidgetContainer"})("display:grid;grid-template-columns:repeat(2,minmax(0,1fr));grid-auto-flow:row dense;grid-gap:",(0,w.Z)(2),";@media (min-width:",(function(e){return e.theme.breakpoints[1]}),"){grid-template-columns:repeat(4,minmax(0,1fr));}@media (min-width:",(function(e){return e.theme.breakpoints[3]}),"){grid-template-columns:repeat(6,minmax(0,1fr));}@media (min-width:",(function(e){return e.theme.breakpoints[4]}),"){grid-template-columns:repeat(8,minmax(0,1fr));}");function de(e,t){return e.id?"".concat(e.id,"-index-").concat(t):"index-".concat(t)}var le=n("./app/views/dashboardsV2/data.tsx"),ce=n("../../../../node_modules/@babel/runtime/helpers/esm/get.js"),ue=n("./app/components/asyncComponent.tsx"),pe=n("./app/components/lightWeightNoProjectMessage.tsx"),he=n("./app/components/sentryDocumentTitle.tsx"),fe=n("./app/styles/organization.tsx");function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const ge=function(e){(0,s.Z)(u,e);var t,n,c=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(t);if(n){var a=(0,d.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,i.Z)(this,e)});function u(){var e;(0,r.Z)(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=c.call.apply(c,[this].concat(n)),(0,l.Z)((0,o.Z)(e),"state",{loading:!0,reloading:!1,error:!1,errors:{},dashboards:[],selectedDashboard:null}),e}return(0,a.Z)(u,[{key:"componentDidUpdate",value:function(e){f()(e.params,this.props.params)||this.remountComponent()}},{key:"getEndpoints",value:function(){var e=this.props,t=e.organization,n=e.params,r="/organizations/".concat(t.slug,"/dashboards/"),a=[["dashboards",r]];return n.dashboardId&&(a.push(["selectedDashboard","".concat(r).concat(n.dashboardId,"/")]),(0,D.ec)({eventKey:"dashboards2.view",eventName:"Dashboards2: View dashboard",organization_id:parseInt(this.props.organization.id,10),dashboard_id:n.dashboardId})),a}},{key:"getDashboards",value:function(){var e=this.state.dashboards;return Array.isArray(e)?e:[]}},{key:"onRequestSuccess",value:function(e){var t=e.stateKey,n=e.data,r=this.props,a=r.params,o=r.organization,s=r.location;if(!a.dashboardId&&"selectedDashboard"!==t){var i=n.length?n[0].id:"default-overview",d="/organizations/".concat(o.slug,"/dashboards/").concat(i,"/");p.browserHistory.replace({pathname:d,query:me({},s.query)})}}},{key:"renderBody",value:function(){var e=this.props,t=e.organization,n=e.children,r=this.state,a=r.selectedDashboard,o=r.error;return(0,R.tZ)(fe.JH,null,(0,R.tZ)(pe.Z,{organization:t},n({error:o,dashboard:a,dashboards:this.getDashboards(),reloadData:this.reloadData.bind(this)})))}},{key:"renderError",value:function(e){return Object.values(this.state.errors).find((function(e){return e&&404===e.status}))?(0,R.tZ)(g.Z,null):(0,ce.Z)((0,d.Z)(u.prototype),"renderError",this).call(this,e,!0,!0)}},{key:"renderComponent",value:function(){var e=this.props,t=e.organization,n=e.location;return t.features.includes("dashboards-basic")?(0,R.tZ)(he.Z,{title:(0,Z.t)("Dashboards"),orgSlug:t.slug},(0,ce.Z)((0,d.Z)(u.prototype),"renderComponent",this).call(this)):(p.browserHistory.replace({pathname:"/organizations/".concat(t.slug,"/dashboards/"),query:me({},n.query)}),null)}}]),u}(ue.Z);var ve=n("../../../../node_modules/@babel/runtime/helpers/esm/extends.js"),ye=n("./app/components/inputInline.tsx");function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var De=function(e){(0,s.Z)(p,e);var t,n,c=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(t);if(n){var a=(0,d.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,i.Z)(this,e)});function p(){var e;(0,r.Z)(this,p);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=c.call.apply(c,[this].concat(n)),(0,l.Z)((0,o.Z)(e),"refInput",u.createRef()),(0,l.Z)((0,o.Z)(e),"onBlur",(function(t){var n=(t.target.value||"").trim().slice(0,255).trim();if(!n)return(0,m.Iw)((0,Z.t)("Please set the title for this dashboard")),void(e.refInput.current&&e.refInput.current.focus());var r=e.props,a=r.dashboard,o=r.onUpdate;a&&(t.target.innerText=n,o(we(we({},a),{},{title:n})))})),e}return(0,a.Z)(p,[{key:"render",value:function(){var e=this.props,t=e.dashboard,n=e.isEditing;return t?n?(0,R.tZ)(xe,null,(0,R.tZ)(Ce,{name:"dashboard-title",ref:this.refInput,value:t.title,onBlur:this.onBlur})):(0,R.tZ)(xe,null,t.title):(0,R.tZ)(xe,null,(0,Z.t)("Dashboards"))}}]),p}(u.Component);De.displayName="DashboardTitle";var xe=(0,c.Z)("div",{target:"e14jh2hu0",label:"Container"})("margin-right:",(0,w.Z)(1),";@media (max-width:",(function(e){return e.theme.breakpoints[2]}),"){margin-bottom:",(0,w.Z)(2),";}"),Ce=(0,c.Z)(u.forwardRef((function(e,t){return(0,R.tZ)(ye.Z,(0,ve.Z)({},e,{ref:t}))})),{target:"e14jh2hu1",label:"StyledInlineInput"})({name:"1370mw6",styles:"overflow-wrap:anywhere;white-space:normal;"});const Se=De;var Oe=n("./app/views/dashboardsV2/utils.tsx");function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ze=(0,Z.t)("You have unsaved changes, are you sure you want to leave?"),Ie=function(e){(0,s.Z)(h,e);var t,n,c=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(t);if(n){var a=(0,d.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,i.Z)(this,e)});function h(){var e;(0,r.Z)(this,h);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=c.call.apply(c,[this].concat(n)),(0,l.Z)((0,o.Z)(e),"state",{dashboardState:"view",modifiedDashboard:null}),(0,l.Z)((0,o.Z)(e),"onEdit",(function(t){return function(){t&&((0,D.ec)({eventKey:"dashboards2.edit.start",eventName:"Dashboards2: Edit start",organization_id:parseInt(e.props.organization.id,10)}),e.setState({dashboardState:"edit",modifiedDashboard:(0,Oe.q)(t)}))}})),(0,l.Z)((0,o.Z)(e),"onRouteLeave",(function(t){var n=e.props.organization;if((null==t?void 0:t.pathname)!=="/organizations/".concat(n.slug,"/dashboards/widget/new/"))return["view","pending_delete"].includes(e.state.dashboardState)?void 0:ze})),(0,l.Z)((0,o.Z)(e),"onUnload",(function(t){["view","pending_delete"].includes(e.state.dashboardState)||(t.preventDefault(),t.returnValue=ze)})),(0,l.Z)((0,o.Z)(e),"onCreate",(function(){(0,D.ec)({eventKey:"dashboards2.create.start",eventName:"Dashboards2: Create start",organization_id:parseInt(e.props.organization.id,10)}),e.setState({dashboardState:"create",modifiedDashboard:(0,Oe.q)(le.R7)})})),(0,l.Z)((0,o.Z)(e),"onCancel",(function(){"create"===e.state.dashboardState?(0,D.ec)({eventKey:"dashboards2.create.cancel",eventName:"Dashboards2: Create cancel",organization_id:parseInt(e.props.organization.id,10)}):"edit"===e.state.dashboardState&&(0,D.ec)({eventKey:"dashboards2.edit.cancel",eventName:"Dashboards2: Edit cancel",organization_id:parseInt(e.props.organization.id,10)}),e.setState({dashboardState:"view",modifiedDashboard:null})})),(0,l.Z)((0,o.Z)(e),"onDelete",(function(t){return function(){var n=e.props,r=n.api,a=n.organization,o=n.location;if(null!=t&&t.id){var s=e.state.dashboardState;e.setState({dashboardState:"pending_delete"},(function(){(0,D.ec)({eventKey:"dashboards2.delete",eventName:"Dashboards2: Delete",organization_id:parseInt(e.props.organization.id,10)}),(0,b.iM)(r,a.slug,t.id).then((function(){(0,m.S9)((0,Z.t)("Dashboard deleted")),p.browserHistory.replace({pathname:"/organizations/".concat(a.slug,"/dashboards/"),query:je({},o.query)})})).catch((function(){e.setState({dashboardState:s})}))}))}}})),(0,l.Z)((0,o.Z)(e),"onCommit",(function(t){var n=t.dashboard,r=t.reloadData;return function(){var t=e.props,a=t.api,o=t.organization,s=t.location,i=e.state,d=i.dashboardState,l=i.modifiedDashboard;switch(d){case"create":l&&(0,b.JR)(a,o.slug,l).then((function(t){(0,m.S9)((0,Z.t)("Dashboard created")),(0,D.ec)({eventKey:"dashboards2.create.complete",eventName:"Dashboards2: Create complete",organization_id:parseInt(o.id,10)}),e.setState({dashboardState:"view",modifiedDashboard:null}),p.browserHistory.replace({pathname:"/organizations/".concat(o.slug,"/dashboards/").concat(t.id,"/"),query:je({},s.query)})}));break;case"edit":if(l)return f()(n,l)?void e.setState({dashboardState:"view",modifiedDashboard:null}):void(0,b.Y)(a,o.slug,l).then((function(t){(0,m.S9)((0,Z.t)("Dashboard updated")),(0,D.ec)({eventKey:"dashboards2.edit.complete",eventName:"Dashboards2: Edit complete",organization_id:parseInt(o.id,10)}),e.setState({dashboardState:"view",modifiedDashboard:null}),n&&t.id!==n.id?p.browserHistory.replace({pathname:"/organizations/".concat(o.slug,"/dashboards/").concat(t.id,"/"),query:je({},s.query)}):r()}));e.setState({dashboardState:"view",modifiedDashboard:null});break;case"view":default:e.setState({dashboardState:"view",modifiedDashboard:null})}}})),(0,l.Z)((0,o.Z)(e),"onWidgetChange",(function(t){null!==e.state.modifiedDashboard&&e.setState((function(e){return je(je({},e),{},{modifiedDashboard:je(je({},e.modifiedDashboard),{},{widgets:t})})}))})),(0,l.Z)((0,o.Z)(e),"setModifiedDashboard",(function(t){e.setState({modifiedDashboard:t})})),e}return(0,a.Z)(h,[{key:"componentDidMount",value:function(){var e=this.props,t=e.route;e.router.setRouteLeaveHook(t,this.onRouteLeave),window.addEventListener("beforeunload",this.onUnload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onUnload)}},{key:"render",value:function(){var e=this,t=this.props,n=t.api,r=t.location,a=t.params,o=t.organization,s=this.state,i=s.modifiedDashboard,d=s.dashboardState,l=["edit","create","pending_delete"].includes(d);return(0,R.tZ)(y.Z,{skipLoadLastUsed:o.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:le.GY}}},(0,R.tZ)(ge,{api:n,location:r,params:a,organization:o},(function(t){var n=t.dashboard,r=t.dashboards,a=t.error,s=t.reloadData;return(0,R.tZ)(u.Fragment,null,(0,R.tZ)(Ee,null,(0,R.tZ)(Se,{dashboard:i||n,onUpdate:e.setModifiedDashboard,isEditing:l}),(0,R.tZ)(A,{organization:o,dashboards:r,dashboard:n,onEdit:e.onEdit(n),onCreate:e.onCreate,onCancel:e.onCancel,onCommit:e.onCommit({dashboard:n,reloadData:s}),onDelete:e.onDelete(n),dashboardState:d})),a?(0,R.tZ)(g.Z,null):n?(0,R.tZ)(se,{dashboard:i||n,organization:o,isEditing:l,onUpdate:e.onWidgetChange}):(0,R.tZ)(v.Z,null))})))}}]),h}(u.Component);Ie.displayName="DashboardDetail";var Ee=(0,c.Z)("div",{target:"e39ap620",label:"StyledPageHeader"})("display:flex;align-items:center;justify-content:space-between;font-size:",(function(e){return e.theme.headerFontSize}),";color:",(function(e){return e.theme.textColor}),";height:40px;margin-bottom:",(0,w.Z)(2),";@media (max-width:",(function(e){return e.theme.breakpoints[2]}),"){flex-direction:column;align-items:flex-start;height:auto;}");const Pe=(0,x.Z)((0,C.Z)(Ie))}}]);
//# sourceMappingURL=DashboardDetail.js.map