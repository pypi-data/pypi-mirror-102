#!/usr/bin/env python3 
# This file is placed in the Public Domain.

__version__ = 7

from op.tbl import tbl
from op.clt import CLI
from op.trm import exec
from op.zzz import os, time

from gcd.tbl import tbl

def main():
    if "INVOCATION_ID" not in os.environ:
        print("run this program under systemd.")
        return
    k = CLI()
    k.tbl(tbl)
    k.cfg.mods = "rss,irc"
    k.cfg.name = "genocide"
    k.cfg.version = __version__
    k.cfg.wd = "/var/lib/genocide/"
    k.parse()
    if k.cfg.txt:
        k.run(k.cfg.old.txt)
        return
    k.scan("/var/lib/genocide/mod/")
    k.run()
    k.start()
    k.init(k.cfg.mods)
    k.wait()

exec(main)
