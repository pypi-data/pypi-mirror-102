

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fleur tools/utility &mdash; AiiDA-FLEUR 1.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within AiiDA-FLEUR 1.1.0 documentation"
          href="../_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Fleur input generator plug-in" href="code.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA-FLEUR
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/ug_index.html">User’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devel_guide/dg_index.html">Developer’s guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mg_index.html">Source code Documentation (API reference)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="code.html">Fleur input generator plug-in</a></li>
<li class="toctree-l2"><a class="reference internal" href="code.html#fleur-code-plugin">Fleur-code plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="code.html#fleur-input-data-structure">Fleur input Data structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="code.html#workflows-workchains">Workflows/Workchains</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fleur tools/utility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.fleur_schema.schemafile_index">Dealing with XML Schema files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.StructureData_util">Structure Data util</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.xml_util">XML utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-utility">Parameter utility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-aiida_fleur.tools.dict_util">General Parameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-aiida_fleur.tools.merge_parameter">Merge Parameter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.create_corehole">Corehole/level utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.common_aiida">Common aiida utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.read_cif_folder">Reading in Cif files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.io_routines">IO routines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-aiida_fleur.tools.common_fleur_wf">Common utitlity for fleur workchains</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA-FLEUR</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="mg_index.html">Source code Documentation (API reference)</a> &raquo;</li>
        
      <li>Fleur tools/utility</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fleur-tools-utility">
<h1>Fleur tools/utility<a class="headerlink" href="#fleur-tools-utility" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-aiida_fleur.fleur_schema.schemafile_index">
<span id="dealing-with-xml-schema-files"></span><h2>Dealing with XML Schema files<a class="headerlink" href="#module-aiida_fleur.fleur_schema.schemafile_index" title="Permalink to this headline">¶</a></h2>
<p>This file is just were to hardcode some schema file paths</p>
</div>
<div class="section" id="module-aiida_fleur.tools.StructureData_util">
<span id="structure-data-util"></span><h2>Structure Data util<a class="headerlink" href="#module-aiida_fleur.tools.StructureData_util" title="Permalink to this headline">¶</a></h2>
<p>Collection of utility routines dealing with StructureData objects</p>
<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.abs_to_rel">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">abs_to_rel</code><span class="sig-paren">(</span><em class="sig-param">vector</em>, <em class="sig-param">cell</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#abs_to_rel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.abs_to_rel" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a position vector in absolute coordinates to relative coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vector</strong> – list or np.array of length 3, vector to be converted</p></li>
<li><p><strong>cell</strong> – Bravais matrix of a crystal 3x3 Array, List of list or np.array</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of legth 3 of scaled vector, or False if vector was not length 3</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.abs_to_rel_f">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">abs_to_rel_f</code><span class="sig-paren">(</span><em class="sig-param">vector</em>, <em class="sig-param">cell</em>, <em class="sig-param">pbc</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#abs_to_rel_f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.abs_to_rel_f" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a position vector in absolute coordinates to relative coordinates
for a film system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vector</strong> – list or np.array of length 3, vector to be converted</p></li>
<li><p><strong>cell</strong> – Bravais matrix of a crystal 3x3 Array, List of list or np.array</p></li>
<li><p><strong>pb</strong> – Boundary conditions, List or Tuple of 3 Boolean</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of legth 3 of scaled vector, or False if vector was not length 3</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.adjust_film_relaxation">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">adjust_film_relaxation</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">suggestion</em>, <em class="sig-param">scale_as=None</em>, <em class="sig-param">bond_length=None</em>, <em class="sig-param">hold_layers=3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#adjust_film_relaxation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.adjust_film_relaxation" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to optimize interlayer distances. Can be used before RelaxWC to improve its behaviour.
This function only works if USER_API_KEY was set.</p>
<p>For now only binary structures are analysed to ensure the closest contact between two
elements of the interest. In case of trinary systems (like ABC) I can not not guarantee that
A and C will be the nearest neighbours.</p>
<p>The same is true for interlayer distances of the same element. To ensure the nearest-neighbour
condition I use unary compounds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – ase film structure which will be adjusted</p></li>
<li><p><strong>suggestion</strong> – dictionary containing average bond length between different elements,
is is basically the result of
<a class="reference internal" href="#aiida_fleur.tools.StructureData_util.request_average_bond_length" title="aiida_fleur.tools.StructureData_util.request_average_bond_length"><code class="xref py py-func docutils literal notranslate"><span class="pre">request_average_bond_length()</span></code></a></p></li>
<li><p><strong>scale_as</strong> – an element name, for which the El-El bond length will be enforced. It is
can be helpful to enforce the same interlayer distance in the substrate,
i.e. adjust deposited film interlayer distances only.</p></li>
<li><p><strong>bond_length</strong> – a float that sets the bond length for scale_as element</p></li>
<li><p><strong>hold_layers</strong> – this parameters sets the number of layers that will be marked via the
certain label. The label is reserved for future use in the relaxation WC:
all the atoms marked with the label will not be relaxed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.break_symmetry">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">break_symmetry</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">atoms=None</em>, <em class="sig-param">site=None</em>, <em class="sig-param">pos=None</em>, <em class="sig-param">new_kinds_names=None</em>, <em class="sig-param">parameterdata=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#break_symmetry"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.break_symmetry" title="Permalink to this definition">¶</a></dt>
<dd><p>This routine introduces different ‘kind objects’ in a structure
and names them that inpgen will make different species/atomgroups out of them.
If nothing specified breaks ALL symmetry (i.e. every atom gets their own kind)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – StructureData</p></li>
<li><p><strong>atoms</strong> – python list of symbols, exp: [‘W’, ‘Be’]. This would make for
all Be and W atoms their own kinds.</p></li>
<li><p><strong>site</strong> – python list of integers, exp: [1, 4, 8]. This would create for
atom 1, 4 and 8 their own kinds.</p></li>
<li><p><strong>pos</strong> – python list of tuples of 3, exp [(0.0, 0.0, -1.837927), …].
This will create a new kind for the atom at that position.
Be carefull the number given has to match EXACTLY the position
in the structure.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>StructureData, a AiiDA crystal structure with new kind specification.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.break_symmetry_wf">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">break_symmetry_wf</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">wf_para</em>, <em class="sig-param">parameterdata=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#break_symmetry_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.break_symmetry_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the calcfunction of the routine break_symmetry, which
introduces different ‘kind objects’ in a structure
and names them that inpgen will make different species/atomgroups out of them.
If nothing specified breaks ALL symmetry (i.e. every atom gets their own kind)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – StructureData</p></li>
<li><p><strong>wf_para</strong> – <p>ParameterData which contains the keys atoms, sites, pos (see below)</p>
<dl class="simple">
<dt>’atoms’:</dt><dd><p>python list of symbols, exp: [‘W’, ‘Be’]. This would make for
all Be and W atoms their own kinds.</p>
</dd>
<dt>’site’:</dt><dd><p>python list of integers, exp: [1, 4, 8]. This would create for
atom 1, 4 and 8 their own kinds.</p>
</dd>
<dt>’pos’:</dt><dd><p>python list of tuples of 3, exp [(0.0, 0.0, -1.837927), …].
This will create a new kind for the atom at that position.
Be carefull the number given has to match EXACTLY the position
in the structure.</p>
</dd>
</dl>
</p></li>
<li><p><strong>parameterdata</strong> – AiiDa ParameterData</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>StructureData, a AiiDA crystal structure with new kind specification.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.center_film">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">center_film</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#center_film"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.center_film" title="Permalink to this definition">¶</a></dt>
<dd><p>Centers a film at z=0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>structure</strong> – AiiDA structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>AiiDA structure</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.center_film_wf">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">center_film_wf</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#center_film_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.center_film_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Centers a film at z=0, keeps the provenance in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>structure</strong> – AiiDA structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>AiiDA structure</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.common_mt">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">common_mt</code><span class="sig-paren">(</span><em class="sig-param">max_muffin_tins</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#common_mt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.common_mt" title="Permalink to this definition">¶</a></dt>
<dd><p># TODO implement
From a list of dictionary given return smallest common set.
Could be read from the econfig file within AiiDA fleur.</p>
<p>[[{Be: 1.7, W:2.4}, {Be:1.8, W:2.3}], [{Be : 1.75}], [{W:2.5}]
should return [{Be:1.7, W:2.4}]</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.create_all_slabs">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">create_all_slabs</code><span class="sig-paren">(</span><em class="sig-param">initial_structure</em>, <em class="sig-param">miller_index</em>, <em class="sig-param">min_slab_size_ang</em>, <em class="sig-param">min_vacuum_size=0</em>, <em class="sig-param">bonds=None</em>, <em class="sig-param">tol=0.001</em>, <em class="sig-param">max_broken_bonds=0</em>, <em class="sig-param">lll_reduce=False</em>, <em class="sig-param">center_slab=False</em>, <em class="sig-param">primitive=False</em>, <em class="sig-param">max_normal_search=1</em>, <em class="sig-param">symmetrize=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#create_all_slabs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.create_all_slabs" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a dictionary of structures</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.create_all_slabs_buggy">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">create_all_slabs_buggy</code><span class="sig-paren">(</span><em class="sig-param">initial_structure</em>, <em class="sig-param">miller_index</em>, <em class="sig-param">min_slab_size_ang</em>, <em class="sig-param">min_vacuum_size=0</em>, <em class="sig-param">bonds=None</em>, <em class="sig-param">tol=0.001</em>, <em class="sig-param">max_broken_bonds=0</em>, <em class="sig-param">lll_reduce=False</em>, <em class="sig-param">center_slab=False</em>, <em class="sig-param">primitive=False</em>, <em class="sig-param">max_normal_search=None</em>, <em class="sig-param">symmetrize=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#create_all_slabs_buggy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.create_all_slabs_buggy" title="Permalink to this definition">¶</a></dt>
<dd><p>wraps the pymatgen function generate_all_slabs with some useful extras
:return: a dictionary of structures</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.create_manual_slab_ase">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">create_manual_slab_ase</code><span class="sig-paren">(</span><em class="sig-param">lattice='fcc'</em>, <em class="sig-param">miller=None</em>, <em class="sig-param">host_symbol='Fe'</em>, <em class="sig-param">latticeconstant=4.0</em>, <em class="sig-param">size=(1</em>, <em class="sig-param">1</em>, <em class="sig-param">5)</em>, <em class="sig-param">replacements=None</em>, <em class="sig-param">decimals=10</em>, <em class="sig-param">pop_last_layers=0</em>, <em class="sig-param">inverse=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#create_manual_slab_ase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.create_manual_slab_ase" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps ase.lattice lattices generators to create a slab having given lattice vectors directions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lattice</strong> – ‘fcc’ and ‘bcc’ are supported. Set the host lattice of a slab.</p></li>
<li><p><strong>miller</strong> – a list of directions of lattice vectors</p></li>
<li><p><strong>symbol</strong> – a string specifying the atom type</p></li>
<li><p><strong>latticeconstant</strong> – the lattice constant of a structure</p></li>
<li><p><strong>size</strong> – a 3-element tuple that sets supercell size. For instance, use (1,1,5) to set
5 layers of a slab.</p></li>
<li><p><strong>decimals</strong> – sets the rounding of atom positions. See numpy.around.</p></li>
<li><p><strong>pop_last_layers</strong> – specifies how many bottom layers to remove. Sometimes one does not want
to use the integer number of unit cells along z, extra layers can be
removed.</p></li>
</ul>
</dd>
<dt class="field-even">Return structure</dt>
<dd class="field-even"><p>an ase-lattice representing a slab with replaced atoms</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.create_slap">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">create_slap</code><span class="sig-paren">(</span><em class="sig-param">initial_structure</em>, <em class="sig-param">miller_index</em>, <em class="sig-param">min_slab_size</em>, <em class="sig-param">min_vacuum_size=0</em>, <em class="sig-param">lll_reduce=False</em>, <em class="sig-param">center_slab=False</em>, <em class="sig-param">primitive=False</em>, <em class="sig-param">max_normal_search=1</em>, <em class="sig-param">reorient_lattice=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#create_slap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.create_slap" title="Permalink to this definition">¶</a></dt>
<dd><p>wraps the pymatgen slab generator</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.estimate_mt_radii">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">estimate_mt_radii</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">stepsize=0.05</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#estimate_mt_radii"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.estimate_mt_radii" title="Permalink to this definition">¶</a></dt>
<dd><p># TODO implement
This method returns for every atom type (group/kind) in the structure a range of
possible muffin tin radii (min, max).
Or maybe just the maximal muffin tin radii (or sets of maximal muffin tin radii)</p>
<p>example return for some Be-W compound
[[{Be: 1.6, W:2.4}, {Be:1.8, W:2.2}]</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.find_common_mt">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">find_common_mt</code><span class="sig-paren">(</span><em class="sig-param">structures</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#find_common_mt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.find_common_mt" title="Permalink to this definition">¶</a></dt>
<dd><p># TODO implement (in some phd notebook of Broeder this is implement)
From a given list of structures, estimate the muffin tin radii and return
the smallest common set. (therefore a choice for rmt that would work for every structure given)</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.find_equi_atoms">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">find_equi_atoms</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#find_equi_atoms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.find_equi_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>This routine uses spglib and ASE to provide informations of all equivivalent
atoms in the cell.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>structure</strong> – AiiDA StructureData</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>equi_info_symbol, list of lists [‘element’: site_indexlist, …]
len(equi_info_symbol) = number of symmetryatomtypes
and n_equi_info_symbol, dict {‘element’: numberequiatomstypes}</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.find_primitive_cell">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">find_primitive_cell</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#find_primitive_cell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.find_primitive_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>uses spglib find_primitive to find the primitive cell</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sructure</strong> – AiiDA structure data</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of new AiiDA structure data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.find_primitive_cell_wf">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">find_primitive_cell_wf</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#find_primitive_cell_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.find_primitive_cell_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>uses spglib find_primitive to find the primitive cell
:param structure: AiiDa structure data</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of new AiiDa structure data</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.find_primitive_cells">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">find_primitive_cells</code><span class="sig-paren">(</span><em class="sig-param">uuid_list</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#find_primitive_cells"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.find_primitive_cells" title="Permalink to this definition">¶</a></dt>
<dd><p>uses spglib find_primitive to find the primitive cell
:param uuid_list: list of structureData uuids, or pks</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of new AiiDa structure datas</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.get_all_miller_indices">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">get_all_miller_indices</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">highestindex</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#get_all_miller_indices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.get_all_miller_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>wraps the pymatgen function get_symmetrically_distinct_miller_indices for an AiiDa structure</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.get_layers">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">get_layers</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">decimals=10</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#get_layers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.get_layers" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts atom positions and their types belonging to the same layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – ase lattice or StructureData which represents a slab</p></li>
<li><p><strong>number</strong> – the layer number. Note, that layers will be sorted according to z-position</p></li>
<li><p><strong>decimals</strong> – sets the tolerance of atom positions determination. See more in numpy.around.</p></li>
</ul>
</dd>
<dt class="field-even">Return layer, layer_z_positions</dt>
<dd class="field-even"><p>layer is a list of tuples, the first element of which is
atom positions and the second one is atom type.
layer_z_position is a sorted list of all layer positions</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.get_spacegroup">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">get_spacegroup</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#get_spacegroup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.get_spacegroup" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>structure</strong> – AiiDA StructureData</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the spacegroup (spglib class) of a given AiiDA structure</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.is_primitive">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">is_primitive</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#is_primitive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.is_primitive" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if a structure is primitive or not,
:param structure: AiiDA StructureData
:return: True if the structure can not be anymore refined.
prints False if the structure can be futher refined.</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.is_structure">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">is_structure</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#is_structure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.is_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Test if the given input is a StructureData node, by object, id, or pk
:param structure: AiiDA StructureData
:return: if yes returns a StructureData node in all cases, if no returns None</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.magnetic_slab_from_relaxed">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">magnetic_slab_from_relaxed</code><span class="sig-paren">(</span><em class="sig-param">relaxed_structure</em>, <em class="sig-param">orig_structure</em>, <em class="sig-param">total_number_layers</em>, <em class="sig-param">num_relaxed_layers</em>, <em class="sig-param">tolerance_decimals=10</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#magnetic_slab_from_relaxed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.magnetic_slab_from_relaxed" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms a structure that was used for interlayer distance relaxation to
a structure that can be further used for magnetic calculations.</p>
<p>Usually one uses a slab having z-reflection symmetry e.g. A-B1-B2-B3-B2-B1-A where A is
a magnetic element (Fe, Ni, Co, Cr) and B is a substrate. However, further magnetic
calculations are done using assymetric slab A-B1-B2-B3-B4-B5-B6-B7-B8. The function uses
A-B1, B1-B2 etc. iterlayer distances for constraction of assymetric relaxed film.</p>
<p>The function works as follows: it constructs a new StructureData object taking x and y positions
from the orig_structure and z positions from relax_structure for first num_relaxed_interlayers.
Then it appends orig_structure slab to the bottom it a way the total number of layers is
total_number_layers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>relaxed_structure</strong> – Structure which is the output of Relax WorkChain. In thin function
it is assumed to have inversion or at least z-reflection symmetry.</p></li>
<li><p><strong>orig_structure</strong> – The host structure slab having the lattice perioud corresponding to
the bulk structure of the substrate.</p></li>
<li><p><strong>total_number_layers</strong> – the total number of layers to produce</p></li>
<li><p><strong>num_relaxed_layers</strong> – the number of top layers to adjust according to <strong>relaxed_struct</strong></p></li>
<li><p><strong>tolerance_decimals</strong> – sets the rounding of atom positions. See numpy.around.</p></li>
</ul>
</dd>
<dt class="field-even">Return magn_structure</dt>
<dd class="field-even"><p>Resulting assymetric structure with adjusted interlayer distances for
several top layers.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.move_atoms_incell">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">move_atoms_incell</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">vector</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#move_atoms_incell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.move_atoms_incell" title="Permalink to this definition">¶</a></dt>
<dd><p>moves all atoms in a unit cell by a given vector</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – AiiDA structure</p></li>
<li><p><strong>vector</strong> – tuple of 3, or array</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>AiiDA structure</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.move_atoms_incell_wf">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">move_atoms_incell_wf</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">wf_para</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#move_atoms_incell_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.move_atoms_incell_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>moves all atoms in a unit cell by a given vector</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – AiiDA structure</p></li>
<li><p><strong>wf_para</strong> – AiiDA Dict node with vector: tuple of 3, or array
(currently 3 AiiDA Floats to make it a wf,
In the future maybe a list or vector if AiiDa basetype exists)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>AiiDA stucture</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.rel_to_abs">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">rel_to_abs</code><span class="sig-paren">(</span><em class="sig-param">vector</em>, <em class="sig-param">cell</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#rel_to_abs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.rel_to_abs" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a position vector in internal coordinates to absolute coordinates
in Angstrom.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vector</strong> – list or np.array of length 3, vector to be converted</p></li>
<li><p><strong>cell</strong> – Bravais matrix of a crystal 3x3 Array, List of list or np.array</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of legth 3 of scaled vector, or False if vector was not lenth 3</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.rel_to_abs_f">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">rel_to_abs_f</code><span class="sig-paren">(</span><em class="sig-param">vector</em>, <em class="sig-param">cell</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#rel_to_abs_f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.rel_to_abs_f" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a position vector in internal coordinates to absolute coordinates
in Angstrom for a film structure (2D).</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.request_average_bond_length">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">request_average_bond_length</code><span class="sig-paren">(</span><em class="sig-param">main_elements</em>, <em class="sig-param">sub_elements</em>, <em class="sig-param">user_api_key</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#request_average_bond_length"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.request_average_bond_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Requests MaterialsProject to estimate thermal average bond length between given elements.
Also requests information about lattice constants of fcc and bcc structures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>main_elements</strong> – element list to calculate the average bond length
only combinations of AB, AA and BB are calculated, where
A belongs to main_elements, B belongs to sub_elements.</p></li>
<li><p><strong>sub_elements</strong> – element list, see main_elements</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>bond_data, a dict containing obtained lattice constants.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.request_average_bond_length_store">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">request_average_bond_length_store</code><span class="sig-paren">(</span><em class="sig-param">main_elements</em>, <em class="sig-param">sub_elements</em>, <em class="sig-param">user_api_key</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#request_average_bond_length_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.request_average_bond_length_store" title="Permalink to this definition">¶</a></dt>
<dd><p>Requests MaterialsProject to estimate thermal average bond length between given elements.
Also requests information about lattice constants of fcc and bcc structures.
Stores the result in the Database. Notice that this is not a calcfunction!
Therefore, the inputs are not stored and the result node is unconnected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>main_elements</strong> – element list to calculate the average bond length
only combinations of AB, AA and BB are calculated, where
A belongs to main_elements, B belongs to sub_elements.</p></li>
<li><p><strong>sub_elements</strong> – element list, see main_elements</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>bond_data, a dict containing obtained lattice constants.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.rescale">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">rescale</code><span class="sig-paren">(</span><em class="sig-param">inp_structure</em>, <em class="sig-param">scale</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#rescale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.rescale" title="Permalink to this definition">¶</a></dt>
<dd><p>Rescales a crystal structures Volume, atoms stay at their same relative postions,
therefore the absolute postions change.
Keeps the provenance in the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inp_structure</strong> – a StructureData node (pk, or uuid)</p></li>
<li><p><strong>scale</strong> – float scaling factor for the cell</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New StructureData node with rescalled structure, which is linked to input Structure
and None if inp_structure was not a StructureData</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.rescale_nowf">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">rescale_nowf</code><span class="sig-paren">(</span><em class="sig-param">inp_structure</em>, <em class="sig-param">scale</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#rescale_nowf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.rescale_nowf" title="Permalink to this definition">¶</a></dt>
<dd><p>Rescales a crystal structures Volume, atoms stay at their same relative postions,
therefore the absolute postions change.
DOES NOT keep the provenance in the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inp_structure</strong> – a StructureData node (pk, or uuid)</p></li>
<li><p><strong>scale</strong> – float scaling factor for the cell</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New StructureData node with rescalled structure, which is linked to input Structure
and None if inp_structure was not a StructureData</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.sort_atoms_z_value">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">sort_atoms_z_value</code><span class="sig-paren">(</span><em class="sig-param">structure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#sort_atoms_z_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.sort_atoms_z_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Resorts the atoms in a structure by there Z-value</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>structure</strong> – AiiDA structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>AiiDA structure</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.supercell">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">supercell</code><span class="sig-paren">(</span><em class="sig-param">inp_structure</em>, <em class="sig-param">n_a1</em>, <em class="sig-param">n_a2</em>, <em class="sig-param">n_a3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#supercell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.supercell" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a super cell from a StructureData node.
Keeps the provenance in the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>StructureData</strong> – a StructureData node (pk, or uuid)</p></li>
<li><p><strong>scale</strong> – tuple of 3 AiiDA integers, number of cells in a1, a2, a3,
or if cart =True in x,y,z</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>StructureData Node with supercell</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.StructureData_util.supercell_ncf">
<code class="sig-prename descclassname">aiida_fleur.tools.StructureData_util.</code><code class="sig-name descname">supercell_ncf</code><span class="sig-paren">(</span><em class="sig-param">inp_structure</em>, <em class="sig-param">n_a1</em>, <em class="sig-param">n_a2</em>, <em class="sig-param">n_a3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/StructureData_util.html#supercell_ncf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.StructureData_util.supercell_ncf" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a super cell from a StructureData node.
Does NOT keeps the provenance in the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>StructureData</strong> – a StructureData node (pk, or uuid)</p></li>
<li><p><strong>scale</strong> – tuple of 3 AiiDA integers, number of cells in a1, a2, a3, or if cart=True in x,y,z</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>StructureData Node with supercell</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-aiida_fleur.tools.xml_util">
<span id="xml-utility"></span><h2>XML utility<a class="headerlink" href="#module-aiida_fleur.tools.xml_util" title="Permalink to this headline">¶</a></h2>
<p>In this module contains useful methods for handling xml trees and files which are used
by the Fleur code and the fleur plugin.</p>
<dl class="function">
<dt id="aiida_fleur.tools.xml_util.add_num_to_att">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">add_num_to_att</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">attributename</em>, <em class="sig-param">set_val</em>, <em class="sig-param">mode='abs'</em>, <em class="sig-param">occ=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#add_num_to_att"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.add_num_to_att" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine adds something to the value of an attribute in the xml file (should be a number here)
This is a lower-level version of <a class="reference internal" href="#aiida_fleur.tools.xml_util.shift_value" title="aiida_fleur.tools.xml_util.shift_value"><code class="xref py py-func docutils literal notranslate"><span class="pre">shift_value()</span></code></a> which
allows one to specife an arbitrary xml path.</p>
<dl class="field-list simple">
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>an etree a xpath from root to the attribute and the attribute value</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>xpathn</strong> – an xml path to the attribute to change</p></li>
<li><p><strong>attributename</strong> – a name of the attribute to change</p></li>
<li><p><strong>set_val</strong> – a value to be added/multiplied to the previous value</p></li>
<li><p><strong>mode</strong> – ‘abs’ if to add set_val, ‘rel’ if multiply</p></li>
<li><p><strong>occ</strong> – a list of integers specifying number of occurrence to be set</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Comment: Element.set will add the attribute if it does not exist,</dt><dd><p>xpath expression has to exist</p>
</dd>
<dt>example: add_num_to_add(tree, ‘/fleurInput/bzIntegration’, ‘valenceElectrons’, ‘1’)</dt><dd><p>add_num_to_add(tree, ‘/fleurInput/bzIntegration’, ‘valenceElectrons’, ‘1.1’, mode=’rel’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.change_atomgr_att">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">change_atomgr_att</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">attributedict</em>, <em class="sig-param">position=None</em>, <em class="sig-param">species=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#change_atomgr_att"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.change_atomgr_att" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to set parameters of an atom group of the fleur inp.xml file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – xml etree of the inp.xml</p></li>
<li><p><strong>attributedict</strong> – a python dict specifying what you want to change.</p></li>
<li><p><strong>position</strong> – position of an atom group to be changed. If equals to ‘all’, all species will be changed</p></li>
<li><p><strong>species</strong> – atom groups, corresponding to the given specie will be changed</p></li>
<li><p><strong>create</strong> – bool, if species does not exist create it and all subtags?</p></li>
</ul>
</dd>
<dt class="field-even">Return fleurinp_tree_copy</dt>
<dd class="field-even"><p>xml etree of the new inp.xml</p>
</dd>
</dl>
<p><strong>attributedict</strong> is a python dictionary containing dictionaries that specify attributes
to be set inside the certain specie. For example, if one wants to set a beta noco parameter it
can be done via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;attributedict&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nocoParams&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">force</span></code> and <code class="docutils literal notranslate"><span class="pre">nocoParams</span></code> keys are supported.
To find possible keys of the inner dictionary please refer to the FLEUR documentation flapw.de</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.change_atomgr_att_label">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">change_atomgr_att_label</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">attributedict</em>, <em class="sig-param">at_label</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#change_atomgr_att_label"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.change_atomgr_att_label" title="Permalink to this definition">¶</a></dt>
<dd><p>This method calls <a class="reference internal" href="#aiida_fleur.tools.xml_util.change_atomgr_att" title="aiida_fleur.tools.xml_util.change_atomgr_att"><code class="xref py py-func docutils literal notranslate"><span class="pre">change_atomgr_att()</span></code></a>
method for a certain atom specie that corresponds to an atom with a given label.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – xml etree of the inp.xml</p></li>
<li><p><strong>at_label</strong> – string, a label of the atom which specie will be changed. ‘all’ to change all the species</p></li>
<li><p><strong>attributedict</strong> – a python dict specifying what you want to change.</p></li>
</ul>
</dd>
<dt class="field-even">Return fleurinp_tree_copy</dt>
<dd class="field-even"><p>xml etree of the new inp.xml</p>
</dd>
</dl>
<p><strong>attributedict</strong> is a python dictionary containing dictionaries that specify attributes
to be set inside the certain specie. For example, if one wants to set a beta noco parameter it
can be done via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;attributedict&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nocoParams&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">force</span></code> and <code class="docutils literal notranslate"><span class="pre">nocoParams</span></code> keys are supported.
To find possible keys of the inner dictionary please refer to the FLEUR documentation flapw.de</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.clear_xml">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">clear_xml</code><span class="sig-paren">(</span><em class="sig-param">tree</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#clear_xml"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.clear_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes comments and executes xinclude tags of an
xml tree.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tree</strong> – an xml-tree which will be processes</p>
</dd>
<dt class="field-even">Return cleared_tree</dt>
<dd class="field-even"><p>an xml-tree without comments and with replaced xinclude tags</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_ev_to_htr">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_ev_to_htr</code><span class="sig-paren">(</span><em class="sig-param">value</em>, <em class="sig-param">parser_info_out=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_ev_to_htr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_ev_to_htr" title="Permalink to this definition">¶</a></dt>
<dd><p>Divides the value given with the Hartree factor (converts htr to eV)</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_fleur_lo">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_fleur_lo</code><span class="sig-paren">(</span><em class="sig-param">loelements</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_fleur_lo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_fleur_lo" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts lo xml elements from the inp.xml file into a lo string for the inpgen</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_from_fortran_bool">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_from_fortran_bool</code><span class="sig-paren">(</span><em class="sig-param">stringbool</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_from_fortran_bool"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_from_fortran_bool" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a string in this case (‘T’, ‘F’, or ‘t’, ‘f’) to True or False</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>stringbool</strong> – a string (‘t’, ‘f’, ‘F’, ‘T’)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean  (either True or False)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_htr_to_ev">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_htr_to_ev</code><span class="sig-paren">(</span><em class="sig-param">value</em>, <em class="sig-param">parser_info_out=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_htr_to_ev"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_htr_to_ev" title="Permalink to this definition">¶</a></dt>
<dd><p>Multiplies the value given with the Hartree factor (converts htr to eV)</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_to_float">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_to_float</code><span class="sig-paren">(</span><em class="sig-param">value_string</em>, <em class="sig-param">parser_info_out=None</em>, <em class="sig-param">suc_return=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_to_float"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_to_float" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to make a float out of a string. If it can’t it logs a warning
and returns True or False if convertion worked or not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>value_string</strong> – a string</p>
</dd>
<dt class="field-even">Returns value</dt>
<dd class="field-even"><p>the new float or value_string: the string given</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True or False</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_to_fortran_bool">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_to_fortran_bool</code><span class="sig-paren">(</span><em class="sig-param">boolean</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_to_fortran_bool"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_to_fortran_bool" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a Boolean as string to the format defined in the input</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>boolean</strong> – either a boolean or a string (‘True’, ‘False’, ‘F’, ‘T’)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a string (either ‘t’ or ‘f’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_to_fortran_string">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_to_fortran_string</code><span class="sig-paren">(</span><em class="sig-param">string</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_to_fortran_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_to_fortran_string" title="Permalink to this definition">¶</a></dt>
<dd><p>converts some parameter strings to the format for the inpgen
:param string: some string
:returns: string in right format (extra “”)</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.convert_to_int">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">convert_to_int</code><span class="sig-paren">(</span><em class="sig-param">value_string</em>, <em class="sig-param">parser_info_out=None</em>, <em class="sig-param">suc_return=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#convert_to_int"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.convert_to_int" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to make a int out of a string. If it can’t it logs a warning
and returns True or False if convertion worked or not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>value_string</strong> – a string</p>
</dd>
<dt class="field-even">Returns value</dt>
<dd class="field-even"><p>the new int or value_string: the string given</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True or False, if suc_return=True</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.create_tag">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">create_tag</code><span class="sig-paren">(</span><em class="sig-param">xmlnode</em>, <em class="sig-param">xpath</em>, <em class="sig-param">newelement</em>, <em class="sig-param">create=False</em>, <em class="sig-param">place_index=None</em>, <em class="sig-param">tag_order=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#create_tag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.create_tag" title="Permalink to this definition">¶</a></dt>
<dd><p>This method evaluates an xpath expresion and creates tag in an xmltree under the
returned nodes. If the path does exist things will be overwritten, or created.
Per default the new element is appended to the elements, but it can also be
inserted in a certain position or after certain other tags.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmlnode</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path where to place a new tag</p></li>
<li><p><strong>newelement</strong> – a tag name to be created</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
<li><p><strong>place_index</strong> – defines the place where to put a created tag</p></li>
<li><p><strong>tag_order</strong> – defines a tag order</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.delete_att">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">delete_att</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpath</em>, <em class="sig-param">attrib</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#delete_att"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.delete_att" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes an xml tag in an xmletree.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute to be deleted</p></li>
<li><p><strong>attrib</strong> – the name of an attribute</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.delete_tag">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">delete_tag</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpath</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#delete_tag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.delete_tag" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes an xml tag in an xmletree.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the tag to be deleted</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.eval_xpath">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">eval_xpath</code><span class="sig-paren">(</span><em class="sig-param">node</em>, <em class="sig-param">xpath</em>, <em class="sig-param">parser_info=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#eval_xpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.eval_xpath" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to evalutate an xpath expression. If it fails it logs it.
If seferal paths are found, return a list. If only one - returns the value.</p>
<p>:param root node of an etree and an xpath expression (relative, or absolute)
:returns either nodes, or attributes, or text</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.eval_xpath2">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">eval_xpath2</code><span class="sig-paren">(</span><em class="sig-param">node</em>, <em class="sig-param">xpath</em>, <em class="sig-param">parser_info=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#eval_xpath2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.eval_xpath2" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to evalutate an xpath expression. If it fails it logs it.
Always return a list.</p>
<p>:param root node of an etree and an xpath expression (relative, or absolute)
:returns a node list</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.eval_xpath3">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">eval_xpath3</code><span class="sig-paren">(</span><em class="sig-param">node</em>, <em class="sig-param">xpath</em>, <em class="sig-param">create=False</em>, <em class="sig-param">place_index=None</em>, <em class="sig-param">tag_order=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#eval_xpath3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.eval_xpath3" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to evalutate an xpath expression. If it fails it logs it.
If create == True, creates a tag</p>
<p>:param root node of an etree and an xpath expression (relative, or absolute)
:returns always a node list</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.get_inpgen_para_from_xml">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">get_inpgen_para_from_xml</code><span class="sig-paren">(</span><em class="sig-param">inpxmlfile</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#get_inpgen_para_from_xml"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.get_inpgen_para_from_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>This routine returns an python dictionary produced from the inp.xml
file, which can be used as a calc_parameters node by inpgen.
Be aware that inpgen does not take all information that is contained in an inp.xml file</p>
<dl class="field-list simple">
<dt class="field-odd">Return new_parameters</dt>
<dd class="field-odd"><p>A Dict, which will lead to the same inp.xml (in case if other defaults,
which can not be controlled by input for inpgen, were changed)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.get_inpgen_paranode_from_xml">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">get_inpgen_paranode_from_xml</code><span class="sig-paren">(</span><em class="sig-param">inpxmlfile</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#get_inpgen_paranode_from_xml"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.get_inpgen_paranode_from_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>This routine returns an AiiDA Parameter Data type produced from the inp.xml
file, which can be used by inpgen.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>ParameterData node</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.get_inpxml_file_structure">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">get_inpxml_file_structure</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#get_inpxml_file_structure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.get_inpxml_file_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>This routine returns the structure/layout of the ‘inp.xml’ file.</p>
<p>Basicly the plug-in should know from this routine, what things are allowed
to be set and where, i.e all attributes and their xpaths.
As a developer make sure to use this routine always of you need information
about the inp.xml file structure.
Therefore, this plug-in should be easy to adjust to other codes with xml
files as input files. Just rewrite this routine.</p>
<p>For now the structure of the xmlinp file for fleur is hardcoded.
If big changes are in the ‘inp.xml’ file, maintain this routine.
TODO: Maybe this is better done, by reading the xml schema datei instead.
And maybe it should also work without the schema file, do we want this?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>Nothing</strong> – TODO xml schema</p>
</dd>
<dt class="field-even">Return all_switches_once</dt>
<dd class="field-even"><p>list of all switches (‘T’ or ‘F’) which are allowed to be set</p>
</dd>
<dt class="field-odd">Return all_switches_several</dt>
<dd class="field-odd"><p>list of all switches (‘T’ or ‘F’) which are allowed to be set</p>
</dd>
<dt class="field-even">Return other_attributes_once</dt>
<dd class="field-even"><p>list of all attributes, which occur just once (can be tested)</p>
</dd>
<dt class="field-odd">Return other_attributes_several</dt>
<dd class="field-odd"><p>list of all attributes, which can occur more then once</p>
</dd>
<dt class="field-even">Return all_text</dt>
<dd class="field-even"><p>list of all text of tags, which can be set</p>
</dd>
<dt class="field-odd">Return all_attrib_xpath</dt>
<dd class="field-odd"><p>dictonary (attrib, xpath), of all possible attributes
with their xpath expression for the xmp inp</p>
</dd>
<dt class="field-even">Return expertkey</dt>
<dd class="field-even"><p>keyname (should not be in any other list), which can be
used to set anything in the file, by hand,
(for experts, and that plug-in does not need to be directly maintained if
xmlinp gets a new switch)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.get_xml_attribute">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">get_xml_attribute</code><span class="sig-paren">(</span><em class="sig-param">node</em>, <em class="sig-param">attributename</em>, <em class="sig-param">parser_info_out=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#get_xml_attribute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.get_xml_attribute" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an attribute value from a node.</p>
<dl class="field-list simple">
<dt class="field-odd">Params node</dt>
<dd class="field-odd"><p>a node from etree</p>
</dd>
<dt class="field-even">Params attributename</dt>
<dd class="field-even"><p>a string with the attribute name.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>either attributevalue, or None</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.inpxml_todict">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">inpxml_todict</code><span class="sig-paren">(</span><em class="sig-param">parent</em>, <em class="sig-param">xmlstr</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#inpxml_todict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.inpxml_todict" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursive operation which transforms an xml etree to
python nested dictionaries and lists.
Decision to add a list is if the tag name is in the given list tag_several</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parent</strong> – some xmltree, or xml element</p></li>
<li><p><strong>xmlstr</strong> – structure/layout of the xml file in xmlstr is tags_several:
a list of the tags, which should be converted to a list, not
a dictionary(because they are known to occur more often, and
want to be accessed in a list later.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a python dictionary</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.is_sequence">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">is_sequence</code><span class="sig-paren">(</span><em class="sig-param">arg</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#is_sequence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.is_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if arg is a sequence</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.replace_tag">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">replace_tag</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpath</em>, <em class="sig-param">newelement</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#replace_tag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.replace_tag" title="Permalink to this definition">¶</a></dt>
<dd><p>replaces a xml tag by another tag on an xmletree in place</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the tag to be replaced</p></li>
<li><p><strong>newelement</strong> – a new tag</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.set_dict_or_not">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">set_dict_or_not</code><span class="sig-paren">(</span><em class="sig-param">para_dict</em>, <em class="sig-param">key</em>, <em class="sig-param">value</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#set_dict_or_not"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.set_dict_or_not" title="Permalink to this definition">¶</a></dt>
<dd><p>setter method for a dictionary that will not set the key, value pair.
if the key is [] or None.</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.set_inpchanges">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">set_inpchanges</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">change_dict</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#set_inpchanges"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.set_inpchanges" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes given changes directly in the inp.xml file. Afterwards
updates the inp.xml file representation and the current inp_userchanges
dictionary with the keys provided in the ‘change_dict’ dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – a lxml tree that represents inp.xml</p></li>
<li><p><strong>change_dict</strong> – a python dictionary with the keys to substitute.
It works like dict.update(), adding new keys and
overwriting existing keys.</p></li>
</ul>
</dd>
<dt class="field-even">Returns new_tree</dt>
<dd class="field-even"><p>a lxml tree with applied changes</p>
</dd>
</dl>
<p>An example of change_dict:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">change_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;itmax&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s1">&#39;l_noco&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s1">&#39;ctail&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;l_ss&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</pre></div>
</div>
<p>A full list of supported keys in the change_dict can be found in
<a class="reference internal" href="#aiida_fleur.tools.xml_util.get_inpxml_file_structure" title="aiida_fleur.tools.xml_util.get_inpxml_file_structure"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_inpxml_file_structure()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/comment&#39;</span><span class="p">,</span>
<span class="s1">&#39;relPos&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomGroups/atomGroup/relPos&#39;</span><span class="p">,</span>
<span class="s1">&#39;filmPos&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomGroups/atomGroup/filmPos&#39;</span><span class="p">,</span>
<span class="s1">&#39;absPos&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomGroups/atomGroup/absPos&#39;</span><span class="p">,</span>
<span class="s1">&#39;qss&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/nocoParams/qss&#39;</span><span class="p">,</span>
<span class="s1">&#39;l_ss&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/nocoParams&#39;</span><span class="p">,</span>
<span class="s1">&#39;row-1&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/bulkLattice/bravaisMatrix&#39;</span><span class="p">,</span>
<span class="s1">&#39;row-2&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/bulkLattice/bravaisMatrix&#39;</span><span class="p">,</span>
<span class="s1">&#39;row-3&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/bulkLattice/bravaisMatrix&#39;</span><span class="p">,</span>
<span class="s1">&#39;a1&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/filmLattice/a1&#39;</span><span class="p">,</span>  <span class="c1"># switches once</span>
<span class="s1">&#39;dos&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
<span class="s1">&#39;band&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
<span class="s1">&#39;secvar&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
<span class="s1">&#39;ctail&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
<span class="s1">&#39;frcor&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
<span class="s1">&#39;l_noco&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
<span class="s1">&#39;l_J&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
<span class="s1">&#39;swsp&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
<span class="s1">&#39;lflip&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
<span class="s1">&#39;off&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
<span class="s1">&#39;spav&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
<span class="s1">&#39;l_soc&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
<span class="s1">&#39;soc66&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
<span class="s1">&#39;pot8&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
<span class="s1">&#39;eig66&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
<span class="s1">&#39;l_f&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
<span class="s1">&#39;gauss&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;tria&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;invs&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;zrfs&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;vchk&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
<span class="s1">&#39;cdinf&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
<span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
<span class="s1">&#39;vacdos&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
<span class="s1">&#39;integ&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;star&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;iplot&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
<span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
<span class="s1">&#39;plplot&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
<span class="s1">&#39;slice&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
<span class="s1">&#39;pallst&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
<span class="s1">&#39;form66&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/specialOutput&#39;</span><span class="p">,</span>
<span class="s1">&#39;eonly&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/specialOutput&#39;</span><span class="p">,</span>
<span class="s1">&#39;bmt&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/specialOutput&#39;</span><span class="p">,</span>
<span class="s1">&#39;relativisticCorrections&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/xcFunctional&#39;</span><span class="p">,</span>
<span class="s1">&#39;calculate&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomGroups/atomGroup/force&#39;</span><span class="p">,</span>
<span class="s1">&#39;flipSpin&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
<span class="s1">&#39;Kmax&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
<span class="s1">&#39;Gmax&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
<span class="s1">&#39;GmaxXC&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
<span class="s1">&#39;numbands&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
<span class="s1">&#39;itmax&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
<span class="s1">&#39;minDistance&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
<span class="s1">&#39;maxIterBroyd&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
<span class="s1">&#39;imix&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
<span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
<span class="s1">&#39;spinf&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
<span class="s1">&#39;kcrel&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
<span class="s1">&#39;jspins&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
<span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
<span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
<span class="s1">&#39;gw&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
<span class="s1">&#39;lpr&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
<span class="s1">&#39;isec1&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
<span class="s1">&#39;forcemix&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;forcealpha&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;force_converged&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;qfix&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;epsdisp&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;epsforce&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
<span class="s1">&#39;valenceElectrons&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
<span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
<span class="s1">&#39;fermiSmearingEnergy&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
<span class="s1">&#39;nx&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
<span class="s1">&#39;ny&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
<span class="s1">&#39;nz&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
<span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/kPointCount&#39;</span><span class="p">,</span>
<span class="s1">&#39;ellow&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup/energyParameterLimits&#39;</span><span class="p">,</span>
<span class="s1">&#39;elup&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/calculationSetup&#39;</span><span class="p">,</span>
<span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/symmetryFile&#39;</span><span class="p">,</span>
<span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/bulkLattice&#39;</span><span class="p">,</span>
<span class="s1">&#39;ndir&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
<span class="s1">&#39;minEnergy&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
<span class="s1">&#39;maxEnergy&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
<span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="s1">&#39; /fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
<span class="s1">&#39;layers&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;nstars&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;locx1&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;locy1&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;locx2&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;locy2&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;nstm&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;tworkf&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
<span class="s1">&#39;numkpt&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
<span class="s1">&#39;minEigenval&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
<span class="s1">&#39;maxEigenval&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
<span class="s1">&#39;nnne&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
<span class="s1">&#39;dVac&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/filmLattice&#39;</span><span class="p">,</span>
<span class="s1">&#39;dTilda&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/cell/filmLattice&#39;</span><span class="p">,</span>
<span class="s1">&#39;xcFunctional&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/xcFunctional/name&#39;</span><span class="p">,</span>  <span class="c1"># other_attributes_more</span>
<span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;/fleurInput/constantDefinitions&#39;</span><span class="p">,</span> <span class="s1">&#39;/fleurInput/xcFunctional&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">},</span>
<span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/constantDefinitions&#39;</span><span class="p">,</span>
<span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
<span class="s1">&#39;atomicNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
<span class="s1">&#39;coreStates&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
<span class="s1">&#39;magMom&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
<span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
<span class="s1">&#39;gridPoints&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
<span class="s1">&#39;logIncrement&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
<span class="s1">&#39;lmax&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/atomicCutoffs&#39;</span><span class="p">,</span>
<span class="s1">&#39;lnonsphr&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/atomicCutoffs&#39;</span><span class="p">,</span>
<span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
<span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
<span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
<span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
<span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
<span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
<span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
<span class="s1">&#39;eDeriv&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
<span class="s1">&#39;species&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomGroups/atomGroup&#39;</span><span class="p">,</span>
<span class="s1">&#39;relaxXYZ&#39;</span><span class="p">:</span> <span class="s1">&#39;/fleurInput/atomGroups/atomGroup/force&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.set_kpath">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">set_kpath</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">kpath</em>, <em class="sig-param">count</em>, <em class="sig-param">gamma</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#set_kpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.set_kpath" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets a k-path directly into inp.xml</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – a lxml tree that represents inp.xml</p></li>
<li><p><strong>kpath</strong> – a dictionary with kpoint name as key and k point coordinate as value</p></li>
<li><p><strong>count</strong> – number of k-points</p></li>
<li><p><strong>gamma</strong> – a fortran-type boolean that controls if the gamma-point should be included
in the k-point mesh</p></li>
</ul>
</dd>
<dt class="field-even">Returns new_tree</dt>
<dd class="field-even"><p>a lxml tree with applied changes</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.set_nkpts">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">set_nkpts</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">count</em>, <em class="sig-param">gamma</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#set_nkpts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.set_nkpts" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets a k-point mesh directly into inp.xml</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – a lxml tree that represents inp.xml</p></li>
<li><p><strong>count</strong> – number of k-points</p></li>
<li><p><strong>gamma</strong> – a fortran-type boolean that controls if the gamma-point should be included
in the k-point mesh</p></li>
</ul>
</dd>
<dt class="field-even">Returns new_tree</dt>
<dd class="field-even"><p>a lxml tree with applied changes</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.set_species">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">set_species</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">species_name</em>, <em class="sig-param">attributedict</em>, <em class="sig-param">create=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#set_species"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.set_species" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to set parameters of a species tag of the fleur inp.xml file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – xml etree of the inp.xml</p></li>
<li><p><strong>species_name</strong> – string, name of the specie you want to change</p></li>
<li><p><strong>attributedict</strong> – a python dict specifying what you want to change.</p></li>
<li><p><strong>create</strong> – bool, if species does not exist create it and all subtags?</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – if species name is non existent in inp.xml and should not be created.
also if other given tags are garbage. (errors from eval_xpath() methods)</p>
</dd>
<dt class="field-odd">Return fleurinp_tree_copy</dt>
<dd class="field-odd"><p>xml etree of the new inp.xml</p>
</dd>
</dl>
<p><strong>attributedict</strong> is a python dictionary containing dictionaries that specify attributes
to be set inside the certain specie. For example, if one wants to set a MT radius it
can be done via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributedict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mtSphere&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radius&#39;</span> <span class="p">:</span> <span class="mf">2.2</span><span class="p">}}</span>
</pre></div>
</div>
<p>Another example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;attributedict&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;socscale&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}}</span>
</pre></div>
</div>
<p>that switches SOC terms on a sertain specie. <code class="docutils literal notranslate"><span class="pre">mtSphere</span></code>, <code class="docutils literal notranslate"><span class="pre">atomicCutoffs</span></code>,
<code class="docutils literal notranslate"><span class="pre">energyParameters</span></code>, <code class="docutils literal notranslate"><span class="pre">lo</span></code>, <code class="docutils literal notranslate"><span class="pre">electronConfig</span></code>, <code class="docutils literal notranslate"><span class="pre">nocoParams</span></code>, <code class="docutils literal notranslate"><span class="pre">ldaU</span></code> and
<code class="docutils literal notranslate"><span class="pre">special</span></code> keys are supported. To find possible
keys of the inner dictionary please refer to the FLEUR documentation flapw.de</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.set_species_label">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">set_species_label</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">at_label</em>, <em class="sig-param">attributedict</em>, <em class="sig-param">create=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#set_species_label"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.set_species_label" title="Permalink to this definition">¶</a></dt>
<dd><p>This method calls <a class="reference internal" href="#aiida_fleur.tools.xml_util.set_species" title="aiida_fleur.tools.xml_util.set_species"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_species()</span></code></a>
method for a certain atom specie that corresponds to an atom with a given label</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – xml etree of the inp.xml</p></li>
<li><p><strong>at_label</strong> – string, a label of the atom which specie will be changed. ‘all’ to change all the species</p></li>
<li><p><strong>attributedict</strong> – a python dict specifying what you want to change.</p></li>
<li><p><strong>create</strong> – bool, if species does not exist create it and all subtags?</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.shift_value">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">shift_value</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">change_dict</em>, <em class="sig-param">mode='abs'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#shift_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.shift_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Shifts numertical values of some tags directly in the inp.xml file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – a lxml tree that represents inp.xml</p></li>
<li><p><strong>change_dict</strong> – a python dictionary with the keys to shift.</p></li>
<li><p><strong>mode</strong> – ‘abs’ if change given is absolute, ‘rel’ if relative</p></li>
</ul>
</dd>
<dt class="field-even">Returns new_tree</dt>
<dd class="field-even"><p>a lxml tree with shifted values</p>
</dd>
</dl>
<p>An example of change_dict:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">change_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;itmax&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dVac&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.123</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.shift_value_species_label">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">shift_value_species_label</code><span class="sig-paren">(</span><em class="sig-param">fleurinp_tree_copy</em>, <em class="sig-param">at_label</em>, <em class="sig-param">attr_name</em>, <em class="sig-param">value_given</em>, <em class="sig-param">mode='abs'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#shift_value_species_label"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.shift_value_species_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Shifts value of a specie by label
if at_label contains ‘all’ then applies to all species</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fleurinp_tree_copy</strong> – xml etree of the inp.xml</p></li>
<li><p><strong>at_label</strong> – string, a label of the atom which specie will be changed. ‘all’ if set up all species</p></li>
<li><p><strong>attr_name</strong> – name of the attribute to change</p></li>
<li><p><strong>value_given</strong> – value to add or to multiply by</p></li>
<li><p><strong>mode</strong> – ‘rel’ for multiplication or ‘abs’ for addition</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.write_new_fleur_xmlinp_file">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">write_new_fleur_xmlinp_file</code><span class="sig-paren">(</span><em class="sig-param">inp_file_xmltree</em>, <em class="sig-param">fleur_change_dic</em>, <em class="sig-param">xmlinpstructure</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#write_new_fleur_xmlinp_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.write_new_fleur_xmlinp_file" title="Permalink to this definition">¶</a></dt>
<dd><p>This modifies the xml-inp file. Makes all the changes wanted by
the user or sets some default values for certain modes</p>
<dl class="field-list simple">
<dt class="field-odd">Params inp_file_xmltree</dt>
<dd class="field-odd"><p>xml-tree of the xml-inp file</p>
</dd>
<dt class="field-even">Params fleur_change_dic</dt>
<dd class="field-even"><p>dictionary {attrib_name : value} with all the wanted changes.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>an etree of the xml-inp file with changes.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.xml_set_all_attribv">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">xml_set_all_attribv</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">attributename</em>, <em class="sig-param">attribv</em>, <em class="sig-param">create=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#xml_set_all_attribv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.xml_set_all_attribv" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine sets the value of an attribute in the xml file on all places it occurs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute</p></li>
<li><p><strong>attributename</strong> – an attribute name</p></li>
<li><p><strong>attribv</strong> – an attribute value which will be set</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None, or an etree</p>
</dd>
</dl>
<dl class="simple">
<dt>Comment: Element.set will add the attribute if it does not exist,</dt><dd><p>xpath expression has to exist</p>
</dd>
<dt>example: xml_set_first_attribv(tree, ‘/fleurInput/atomGroups/atomGroup/force’, ‘relaxXYZ’, ‘TTF’)</dt><dd><p>xml_set_first_attribv(tree, ‘/fleurInput/atomGroups/atomGroup/force’, ‘calculate’, ‘F’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.xml_set_all_text">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">xml_set_all_text</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">text</em>, <em class="sig-param">create=False</em>, <em class="sig-param">tag_order=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#xml_set_all_text"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.xml_set_all_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine sets the text of a tag in the xml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute</p></li>
<li><p><strong>text</strong> – text to be set</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
<li><p><strong>place_index</strong> – if create=True, defines the place where to put a created tag</p></li>
<li><p><strong>tag_order</strong> – if create=True, defines a tag order</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.xml_set_attribv_occ">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">xml_set_attribv_occ</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">attributename</em>, <em class="sig-param">attribv</em>, <em class="sig-param">occ=None</em>, <em class="sig-param">create=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#xml_set_attribv_occ"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.xml_set_attribv_occ" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine sets the value of an attribute in the xml file on only the places
specified in occ</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute</p></li>
<li><p><strong>attributename</strong> – an attribute name</p></li>
<li><p><strong>attribv</strong> – an attribute value which will be set</p></li>
<li><p><strong>occ</strong> – a list of integers specifying number of occurrence to be set</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Comment: Element.set will add the attribute if it does not exist,</dt><dd><p>xpath expression has to exist</p>
</dd>
<dt>example: xml_set_first_attribv(tree, ‘/fleurInput/calculationSetup’, ‘band’, ‘T’)</dt><dd><p>xml_set_first_attribv(tree, ‘/fleurInput/calculationSetup’, ‘dos’, ‘F’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.xml_set_first_attribv">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">xml_set_first_attribv</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">attributename</em>, <em class="sig-param">attribv</em>, <em class="sig-param">create=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#xml_set_first_attribv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.xml_set_first_attribv" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine sets the value of the first found attribute in the xml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute</p></li>
<li><p><strong>attributename</strong> – an attribute name</p></li>
<li><p><strong>attribv</strong> – an attribute value which will be set</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None, or an etree</p>
</dd>
</dl>
<dl class="simple">
<dt>Comment: Element.set will add the attribute if it does not exist,</dt><dd><p>xpath expression has to exist</p>
</dd>
<dt>example: xml_set_first_attribv(tree, ‘/fleurInput/calculationSetup’, ‘band’, ‘T’)</dt><dd><p>xml_set_first_attribv(tree, ‘/fleurInput/calculationSetup’, ‘dos’, ‘F’)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.xml_set_text">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">xml_set_text</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">text</em>, <em class="sig-param">create=False</em>, <em class="sig-param">place_index=None</em>, <em class="sig-param">tag_order=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#xml_set_text"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.xml_set_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine sets the text of a tag in the xml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute</p></li>
<li><p><strong>text</strong> – text to be set</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
<li><p><strong>place_index</strong> – if create=True, defines the place where to put a created tag</p></li>
<li><p><strong>tag_order</strong> – if create=True, defines a tag order</p></li>
</ul>
</dd>
</dl>
<p>example:</p>
<blockquote>
<div><p>xml_set_text(tree, ‘/fleurInput/comment’, ‘Test Fleur calculation for AiiDA plug-in’)</p>
</div></blockquote>
<p>but also coordinates and Bravais Matrix!:</p>
<blockquote>
<div><p>xml_set_text(tree, ‘/fleurInput/atomGroups/atomGroup/relPos’,‘1.20000 PI/3 5.1-MYCrazyCostant’)</p>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.xml_util.xml_set_text_occ">
<code class="sig-prename descclassname">aiida_fleur.tools.xml_util.</code><code class="sig-name descname">xml_set_text_occ</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">xpathn</em>, <em class="sig-param">text</em>, <em class="sig-param">create=False</em>, <em class="sig-param">occ=0</em>, <em class="sig-param">place_index=None</em>, <em class="sig-param">tag_order=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/xml_util.html#xml_set_text_occ"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.xml_util.xml_set_text_occ" title="Permalink to this definition">¶</a></dt>
<dd><p>Routine sets the text of a tag in the xml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmltree</strong> – an xmltree that represents inp.xml</p></li>
<li><p><strong>xpathn</strong> – a path to the attribute</p></li>
<li><p><strong>text</strong> – text to be set</p></li>
<li><p><strong>create</strong> – if True and there is no given xpath in the FleurinpData, creates it</p></li>
<li><p><strong>occ</strong> – an integer that sets occurrence number to be set</p></li>
<li><p><strong>place_index</strong> – if create=True, defines the place where to put a created tag</p></li>
<li><p><strong>tag_order</strong> – if create=True, defines a tag order</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="parameter-utility">
<h2>Parameter utility<a class="headerlink" href="#parameter-utility" title="Permalink to this headline">¶</a></h2>
<div class="section" id="module-aiida_fleur.tools.dict_util">
<span id="general-parameter"></span><h3>General Parameter<a class="headerlink" href="#module-aiida_fleur.tools.dict_util" title="Permalink to this headline">¶</a></h3>
<p>This contains code snippets and utility useful for dealing with parameter data nodes
commonly used by the fleur plugin and workflows</p>
<dl class="function">
<dt id="aiida_fleur.tools.dict_util.dict_merger">
<code class="sig-prename descclassname">aiida_fleur.tools.dict_util.</code><code class="sig-name descname">dict_merger</code><span class="sig-paren">(</span><em class="sig-param">dict1</em>, <em class="sig-param">dict2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/dict_util.html#dict_merger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.dict_util.dict_merger" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge recursively two nested python dictionaries.</p>
<p>If key is in both digionaries tries to add the entries in both dicts.
(merges two subdicts, adds strings and numbers together)</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.dict_util.extract_elementpara">
<code class="sig-prename descclassname">aiida_fleur.tools.dict_util.</code><code class="sig-name descname">extract_elementpara</code><span class="sig-paren">(</span><em class="sig-param">parameter_dict</em>, <em class="sig-param">element</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/dict_util.html#extract_elementpara"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.dict_util.extract_elementpara" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parameter_dict</strong> – python dict, parameter node for inpgen</p></li>
<li><p><strong>element</strong> – string, i.e ‘W’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>python dictionary, parameter node which contains only
the atom parameters for the given element</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-aiida_fleur.tools.merge_parameter">
<span id="merge-parameter"></span><h3>Merge Parameter<a class="headerlink" href="#module-aiida_fleur.tools.merge_parameter" title="Permalink to this headline">¶</a></h3>
<p>This module, contains a method to merge Dict nodes used by the FLEUR inpgen.
This might also be of interest for other all-electron codes</p>
<dl class="function">
<dt id="aiida_fleur.tools.merge_parameter.merge_parameter">
<code class="sig-prename descclassname">aiida_fleur.tools.merge_parameter.</code><code class="sig-name descname">merge_parameter</code><span class="sig-paren">(</span><em class="sig-param">Dict1</em>, <em class="sig-param">Dict2</em>, <em class="sig-param">overwrite=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/merge_parameter.html#merge_parameter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.merge_parameter.merge_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Merges two Dict nodes.
Additive: uses all namelists of both.
If they have a namelist in common. Dict2 will overwrite the namelist
of Dict. If this is not wanted. set overwrite = False.
Then attributes of both will be added, but attributes from Dict1 won’t
be overwritten.</p>
<p>param: AiiDA Dict Node
param: AiiDA Dict Node</p>
<p>returns: AiiDA Dict Node</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.merge_parameter.merge_parameter_cf">
<code class="sig-prename descclassname">aiida_fleur.tools.merge_parameter.</code><code class="sig-name descname">merge_parameter_cf</code><span class="sig-paren">(</span><em class="sig-param">Dict1</em>, <em class="sig-param">Dict2</em>, <em class="sig-param">overwrite=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/merge_parameter.html#merge_parameter_cf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.merge_parameter.merge_parameter_cf" title="Permalink to this definition">¶</a></dt>
<dd><p>calcfunction of merge_parameters</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.merge_parameter.merge_parameters">
<code class="sig-prename descclassname">aiida_fleur.tools.merge_parameter.</code><code class="sig-name descname">merge_parameters</code><span class="sig-paren">(</span><em class="sig-param">DictList</em>, <em class="sig-param">overwrite=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/merge_parameter.html#merge_parameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.merge_parameter.merge_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge together all parameter nodes in the given list.</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-aiida_fleur.tools.create_corehole">
<span id="corehole-level-utility"></span><h2>Corehole/level utility<a class="headerlink" href="#module-aiida_fleur.tools.create_corehole" title="Permalink to this headline">¶</a></h2>
<p>Contains helper functions to create core-holes in
Fleur input files from AiiDA data nodes.</p>
<dl class="function">
<dt id="aiida_fleur.tools.create_corehole.create_corehole_fleurinp">
<code class="sig-prename descclassname">aiida_fleur.tools.create_corehole.</code><code class="sig-name descname">create_corehole_fleurinp</code><span class="sig-paren">(</span><em class="sig-param">fleurinp</em>, <em class="sig-param">species</em>, <em class="sig-param">stateocc</em>, <em class="sig-param">pos=None</em>, <em class="sig-param">coreconfig='same'</em>, <em class="sig-param">valenceconfig='same'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/create_corehole.html#create_corehole_fleurinp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.create_corehole.create_corehole_fleurinp" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes an electron from the core and adds it to the valence band of the kind
given econfig as in inp.xml:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Kr</span><span class="p">]</span> <span class="p">(</span><span class="mi">5</span><span class="n">s1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">4</span><span class="n">d3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">4</span><span class="n">d5</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">4</span><span class="n">f5</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">4</span><span class="n">f7</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>if position(pos) is given the electronConfig for the specified position will be set.
(or todo? econfig, either:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Kr</span><span class="p">]</span> <span class="mi">5</span><span class="n">s2</span> <span class="mi">4</span><span class="n">d10</span> <span class="mi">4</span><span class="n">f13</span> <span class="o">|</span> <span class="mi">5</span><span class="n">p6</span> <span class="mi">5</span><span class="n">d4</span> <span class="mi">6</span><span class="n">s2</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Kr</span><span class="p">]</span> <span class="mi">2</span><span class="p">(</span><span class="mi">5</span><span class="n">s1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">4</span><span class="p">(</span><span class="mi">4</span><span class="n">d3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">6</span><span class="p">(</span><span class="mi">4</span><span class="n">d5</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">6</span><span class="p">(</span><span class="mi">4</span><span class="n">f5</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">8</span><span class="p">(</span><span class="mi">4</span><span class="n">f7</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span><span class="mi">2</span><span class="p">(</span><span class="mi">5</span><span class="n">p1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">4</span><span class="p">(</span><span class="mi">5</span><span class="n">p3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">2</span><span class="p">(</span><span class="mi">6</span><span class="n">s1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">2</span><span class="p">(</span><span class="mi">5</span><span class="n">d3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="mi">2</span><span class="p">(</span><span class="mi">5</span><span class="n">d5</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>occ tags already there will be untouched, unless the state is the same as given.</p>
<dl class="field-list simple">
<dt class="field-odd">Params fleurinp</dt>
<dd class="field-odd"><p>an unstored! changes are done on this fleurinp fleurinpdata object # TODO alternatively stored?</p>
</dd>
<dt class="field-even">Params species</dt>
<dd class="field-even"><p>string with species name</p>
</dd>
<dt class="field-odd">Params stateocc</dt>
<dd class="field-odd"><p>dict state tuples (spinup, spindown), exp: {‘(5d3/2)’ : (2.5, 0.0), ‘(4f7/2)’ : (3.5 , 4.0)}</p>
</dd>
<dt class="field-even">Params pos</dt>
<dd class="field-even"><p>list of tuples of 3, pos=[(0.0, 0.0, 0.0), …]</p>
</dd>
<dt class="field-odd">Params coreconfig</dt>
<dd class="field-odd"><p>string, e.g: “[Kr] (5s1/2) (4d3/2) (4d5/2) (4f5/2) (4f7/2)”, default=’same’ (same as current in inp.xml)</p>
</dd>
<dt class="field-even">Params valenceconfig string, e.g.</dt>
<dd class="field-even"><p>(5p1/2) (5p3/2) (6s1/2) (5d3/2) (5d5/2)</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the changes fleurinpData object</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.create_corehole.create_corehole_para">
<code class="sig-prename descclassname">aiida_fleur.tools.create_corehole.</code><code class="sig-name descname">create_corehole_para</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">kind</em>, <em class="sig-param">econfig</em>, <em class="sig-param">species_name='corehole'</em>, <em class="sig-param">parameterdata=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/create_corehole.html#create_corehole_para"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.create_corehole.create_corehole_para" title="Permalink to this definition">¶</a></dt>
<dd><p>This methods sets of electron configurations for a kind
or position given, make sure to break the symmetry for this position/kind
beforehand, otherwise you will create several coreholes.</p>
<p>param: structure: StructureData
param: kind, a string with the kind_name (TODO: alternative the kind object)
param: econfig, string, e.g. econfig = “[Kr] 5s2 4d10 4f13 | 5p6 5d5 6s2”
! THis is the new econfig therefore</p>
<p>returns a Dict node</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.create_corehole.write_change">
<code class="sig-prename descclassname">aiida_fleur.tools.create_corehole.</code><code class="sig-name descname">write_change</code><span class="sig-paren">(</span><em class="sig-param">xmltree</em>, <em class="sig-param">changelist_xpath</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/create_corehole.html#write_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.create_corehole.write_change" title="Permalink to this definition">¶</a></dt>
<dd><p>applies the changes from the changelist to the xml tree</p>
</dd></dl>

<span class="target" id="module-aiida_fleur.tools.extract_corelevels"></span><p>In this module you find methods to parse/extract corelevel shifts from an
out.xml file of FLEUR.</p>
<dl class="function">
<dt id="aiida_fleur.tools.extract_corelevels.clshifts_to_be">
<code class="sig-prename descclassname">aiida_fleur.tools.extract_corelevels.</code><code class="sig-name descname">clshifts_to_be</code><span class="sig-paren">(</span><em class="sig-param">coreleveldict</em>, <em class="sig-param">reference_dict</em>, <em class="sig-param">warn=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/extract_corelevels.html#clshifts_to_be"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.extract_corelevels.clshifts_to_be" title="Permalink to this definition">¶</a></dt>
<dd><p>This methods converts corelevel shifts to binding energies, if a reference is given.
These can than be used for plotting.</p>
<dl class="field-list simple">
<dt class="field-odd">Params reference_dict</dt>
<dd class="field-odd"><p>An example:</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reference_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;W&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;4f7/2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">124</span><span class="p">],</span>
                         <span class="s1">&#39;4f5/2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">]},</span>
                  <span class="s1">&#39;Be&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;1s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">117</span><span class="p">]}}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Params coreleveldict</dt>
<dd class="field-odd"><p>An example:</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coreleveldict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;W&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;4f7/2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span> <span class="p">,</span><span class="mf">0.1</span><span class="p">],</span>
                        <span class="s1">&#39;4f5/2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]},</span>
                 <span class="s1">&#39;Be&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;1s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.extract_corelevels.convert_to_float">
<code class="sig-prename descclassname">aiida_fleur.tools.extract_corelevels.</code><code class="sig-name descname">convert_to_float</code><span class="sig-paren">(</span><em class="sig-param">value_string</em>, <em class="sig-param">parser_info=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/extract_corelevels.html#convert_to_float"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.extract_corelevels.convert_to_float" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to make a float out of a string. If it can’t it logs a warning
and returns True or False if convertion worked or not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>value_string</strong> – a string</p>
</dd>
<dt class="field-even">Returns value</dt>
<dd class="field-even"><p>the new float or value_string: the string given</p>
</dd>
<dt class="field-odd">Retruns</dt>
<dd class="field-odd"><p>True or False</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.extract_corelevels.extract_corelevels">
<code class="sig-prename descclassname">aiida_fleur.tools.extract_corelevels.</code><code class="sig-name descname">extract_corelevels</code><span class="sig-paren">(</span><em class="sig-param">outxmlfile</em>, <em class="sig-param">options=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/extract_corelevels.html#extract_corelevels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.extract_corelevels.extract_corelevels" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts corelevels out of out.xml files</p>
<dl class="field-list simple">
<dt class="field-odd">Params outxmlfile</dt>
<dd class="field-odd"><p>path to out.xml file</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p><strong>options</strong> – A dict: ‘iteration’ : X/’all’</p>
</dd>
<dt class="field-odd">Returns corelevels</dt>
<dd class="field-odd"><p>A list of the form:</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">atomtypes</span><span class="p">][</span><span class="n">spin</span><span class="p">][</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="n">atomtype</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">corestates</span> <span class="p">:</span> <span class="n">list_of_corestates</span><span class="p">}]</span>
<span class="p">[</span><span class="n">atomtypeNumber</span><span class="p">][</span><span class="n">spin</span><span class="p">][</span><span class="s1">&#39;corestates&#39;</span><span class="p">][</span><span class="n">corestate</span> <span class="n">number</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
<span class="n">get</span> <span class="n">corelevel</span> <span class="n">energy</span> <span class="n">of</span> <span class="n">first</span> <span class="n">atomtype</span><span class="p">,</span> <span class="n">spin1</span><span class="p">,</span> <span class="n">corelevels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;corestates&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example of output</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[[{</span><span class="s1">&#39;atomtype&#39;</span><span class="p">:</span> <span class="s1">&#39;     1&#39;</span><span class="p">,</span>
<span class="s1">&#39;corestates&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.6489930627</span><span class="p">,</span>
                <span class="s1">&#39;j&#39;</span><span class="p">:</span> <span class="s1">&#39; 0.5&#39;</span><span class="p">,</span>
                <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="s1">&#39; 0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="s1">&#39; 1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}],</span>
<span class="s1">&#39;eigenvalue_sum&#39;</span><span class="p">:</span> <span class="s1">&#39;     -7.2979861254&#39;</span><span class="p">,</span>
<span class="s1">&#39;kin_energy&#39;</span><span class="p">:</span> <span class="s1">&#39;     13.4757066163&#39;</span><span class="p">,</span>
<span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}],</span>
<span class="p">[{</span><span class="s1">&#39;atomtype&#39;</span><span class="p">:</span> <span class="s1">&#39;     2&#39;</span><span class="p">,</span>
<span class="s1">&#39;corestates&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.6489930627</span><span class="p">,</span>
                <span class="s1">&#39;j&#39;</span><span class="p">:</span> <span class="s1">&#39; 0.5&#39;</span><span class="p">,</span>
                <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="s1">&#39; 0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="s1">&#39; 1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}],</span>
<span class="s1">&#39;eigenvalue_sum&#39;</span><span class="p">:</span> <span class="s1">&#39;     -7.2979861254&#39;</span><span class="p">,</span>
<span class="s1">&#39;kin_energy&#39;</span><span class="p">:</span> <span class="s1">&#39;     13.4757066163&#39;</span><span class="p">,</span>
<span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.extract_corelevels.parse_state_card">
<code class="sig-prename descclassname">aiida_fleur.tools.extract_corelevels.</code><code class="sig-name descname">parse_state_card</code><span class="sig-paren">(</span><em class="sig-param">corestateNode</em>, <em class="sig-param">iteration_node</em>, <em class="sig-param">parser_info=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/extract_corelevels.html#parse_state_card"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.extract_corelevels.parse_state_card" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the ONE core state card</p>
<dl class="field-list simple">
<dt class="field-odd">Params corestateNode</dt>
<dd class="field-odd"><p>an etree element (node), of a fleur output corestate card</p>
</dd>
<dt class="field-even">Params iteration_node</dt>
<dd class="field-even"><p>an etree element, iteration node</p>
</dd>
<dt class="field-odd">Params jspin</dt>
<dd class="field-odd"><p>integer 1 or 2</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a pythondict of type:</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;eigenvalue_sum&#39;</span> <span class="p">:</span> <span class="n">eigenvalueSum</span><span class="p">,</span>
 <span class="s1">&#39;corestates&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
 <span class="s1">&#39;spin&#39;</span> <span class="p">:</span> <span class="n">spin</span><span class="p">,</span>
 <span class="s1">&#39;kin_energy&#39;</span> <span class="p">:</span> <span class="n">kinEnergy</span><span class="p">,</span>
 <span class="s1">&#39;atomtype&#39;</span> <span class="p">:</span> <span class="n">atomtype</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-aiida_fleur.tools.element_econfig_list"></span><p>You find the usual binding_energy for all elements in the periodic table.</p>
<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.convert_fleur_config_to_econfig">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">convert_fleur_config_to_econfig</code><span class="sig-paren">(</span><em class="sig-param">fleurconf_str</em>, <em class="sig-param">keep_spin=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#convert_fleur_config_to_econfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.convert_fleur_config_to_econfig" title="Permalink to this definition">¶</a></dt>
<dd><p>‘[Kr] (4d3/2) (4d5/2) (4f5/2) (4f7/2)’ -&gt; ‘[Kr] 4d10 4f14’, or ‘[Kr] 4d3/2 4d5/2 4f5/2 4f7/2’</p>
<p># for now only use for coreconfig, it will fill all orbitals, since it has no information on the filling.</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.econfigstr_hole">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">econfigstr_hole</code><span class="sig-paren">(</span><em class="sig-param">econfigstr</em>, <em class="sig-param">corelevel</em>, <em class="sig-param">highesunoccp</em>, <em class="sig-param">htype='valence'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#econfigstr_hole"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.econfigstr_hole" title="Permalink to this definition">¶</a></dt>
<dd><p># ‘1s2 | 2s2’ , ‘1s2’ , ‘2p0’ -&gt; ‘1s1 | 2s2 2p1’</p>
<dl class="field-list simple">
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>string</p>
</dd>
<dt class="field-even">Param</dt>
<dd class="field-even"><p>string</p>
</dd>
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.get_coreconfig">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">get_coreconfig</code><span class="sig-paren">(</span><em class="sig-param">element</em>, <em class="sig-param">full=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#get_coreconfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.get_coreconfig" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the econfiguration as a string of an element.</p>
<dl class="field-list simple">
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>element string</p>
</dd>
<dt class="field-even">Param</dt>
<dd class="field-even"><p>full, bool (econfig without [He]…)</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>string</p>
</dd>
<dt class="field-even">Note</dt>
<dd class="field-even"><p>Be careful with base strings…</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.get_econfig">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">get_econfig</code><span class="sig-paren">(</span><em class="sig-param">element</em>, <em class="sig-param">full=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#get_econfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.get_econfig" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the econfiguration as a string of an element.</p>
<dl class="field-list simple">
<dt class="field-odd">Params element</dt>
<dd class="field-odd"><p>element string</p>
</dd>
<dt class="field-even">Params full</dt>
<dd class="field-even"><p>a bool (econfig without [He]…)</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a econfig string</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.get_spin_econfig">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">get_spin_econfig</code><span class="sig-paren">(</span><em class="sig-param">fulleconfigstr</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#get_spin_econfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.get_spin_econfig" title="Permalink to this definition">¶</a></dt>
<dd><p>converts and econfig string to a full spin econfig
1s2 2s2 2p6’ - &gt; ‘1s1/2 2s1/2 2p1/2 2p3/2’</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.get_state_occ">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">get_state_occ</code><span class="sig-paren">(</span><em class="sig-param">econfigstr</em>, <em class="sig-param">corehole=''</em>, <em class="sig-param">valence=''</em>, <em class="sig-param">ch_occ=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#get_state_occ"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.get_state_occ" title="Permalink to this definition">¶</a></dt>
<dd><p>finds out all not full occupied states and returns a dictionary of them
return a dict
i.e corehole ‘4f 5/2’
ch_occ full or fractional corehole occupation?
valence: orbital sting ‘5d’, is to adjust the charges for fractional coreholes
To that orbital occupation ch_occ - 1 will be added.</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.highest_unocc_valence">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">highest_unocc_valence</code><span class="sig-paren">(</span><em class="sig-param">econfigstr</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#highest_unocc_valence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.highest_unocc_valence" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the highest not full valence orbital. If all are full, it returns ‘’
#maybe should be advanced to give back the next highest unocc</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.element_econfig_list.rek_econ">
<code class="sig-prename descclassname">aiida_fleur.tools.element_econfig_list.</code><code class="sig-name descname">rek_econ</code><span class="sig-paren">(</span><em class="sig-param">econfigstr</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/element_econfig_list.html#rek_econ"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.element_econfig_list.rek_econ" title="Permalink to this definition">¶</a></dt>
<dd><p>recursive routine to return a full econfig
‘[Xe] 4f14 | 5d10 6s2 6p4’ -&gt; ‘1s 2s … 4f14 | 5d10 6s2 6p4’</p>
</dd></dl>

</div>
<div class="section" id="module-aiida_fleur.tools.common_aiida">
<span id="common-aiida-utility"></span><h2>Common aiida utility<a class="headerlink" href="#module-aiida_fleur.tools.common_aiida" title="Permalink to this headline">¶</a></h2>
<p>In here we put all things util (methods, code snipets) that are often useful, but not yet in AiiDA
itself.
So far it contains:</p>
<p>export_extras
import_extras
delete_nodes (FIXME)
delete_trash (FIXME)
create_group</p>
<dl class="function">
<dt id="aiida_fleur.tools.common_aiida.create_group">
<code class="sig-prename descclassname">aiida_fleur.tools.common_aiida.</code><code class="sig-name descname">create_group</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">nodes</em>, <em class="sig-param">description=None</em>, <em class="sig-param">add_if_exist=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_aiida.html#create_group"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_aiida.create_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a group for a given node list.</p>
<p>So far this is only an AiiDA verdi command.</p>
<dl class="field-list simple">
<dt class="field-odd">Params name</dt>
<dd class="field-odd"><p>string name for the group</p>
</dd>
<dt class="field-even">Params nodes</dt>
<dd class="field-even"><p>list of AiiDA nodes, pks, or uuids</p>
</dd>
<dt class="field-odd">Params description</dt>
<dd class="field-odd"><p>optional string that will be stored as description for the group</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the group, AiiDa group</p>
</dd>
</dl>
<p>Usage example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">group_name</span> <span class="o">=</span> <span class="s1">&#39;delta_structures_gustav&#39;</span>
<span class="n">nodes_to_group_pks</span> <span class="o">=</span><span class="p">[</span><span class="mi">2142</span><span class="p">,</span> <span class="mi">2084</span><span class="p">]</span>
<span class="n">create_group</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">nodes_to_group_pks</span><span class="p">,</span>
             <span class="n">description</span><span class="o">=</span><span class="s1">&#39;delta structures added by hand. from Gustavs inpgen files&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_aiida.export_extras">
<code class="sig-prename descclassname">aiida_fleur.tools.common_aiida.</code><code class="sig-name descname">export_extras</code><span class="sig-paren">(</span><em class="sig-param">nodes</em>, <em class="sig-param">filename='node_extras.txt'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_aiida.html#export_extras"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_aiida.export_extras" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes uuids and extras of given nodes to a json-file.
This is useful for import/export because currently extras are lost.
Therefore this can be used to save and restore the extras via
<a class="reference internal" href="#aiida_fleur.tools.common_aiida.import_extras" title="aiida_fleur.tools.common_aiida.import_extras"><code class="xref py py-func docutils literal notranslate"><span class="pre">import_extras()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>nodes: list of AiiDA nodes, pks, or uuids</p>
</dd>
<dt class="field-even">Param</dt>
<dd class="field-even"><p>filename, string where to store the file and its name</p>
</dd>
</dl>
<p>example use:
.. code-block:: python</p>
<blockquote>
<div><p>node_list = [120,121,123,46]
export_extras(node_list)</p>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_aiida.get_nodes_from_group">
<code class="sig-prename descclassname">aiida_fleur.tools.common_aiida.</code><code class="sig-name descname">get_nodes_from_group</code><span class="sig-paren">(</span><em class="sig-param">group</em>, <em class="sig-param">return_format='uuid'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_aiida.html#get_nodes_from_group"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_aiida.get_nodes_from_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of pk or uuid of a nodes in a given group. Since 1.1.0, this function does
not load a group using the label or any other identification. Use Group.objects.get(filter=ID) to
pre-load this, available filters are: id, uuid, label, type_string, time, description, user_id.</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_aiida.import_extras">
<code class="sig-prename descclassname">aiida_fleur.tools.common_aiida.</code><code class="sig-name descname">import_extras</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_aiida.html#import_extras"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_aiida.import_extras" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads in node uuids and extras from a file (most probably generated by
<a class="reference internal" href="#aiida_fleur.tools.common_aiida.export_extras" title="aiida_fleur.tools.common_aiida.export_extras"><code class="xref py py-func docutils literal notranslate"><span class="pre">export_extras()</span></code></a>) and applies them to nodes in the DB.</p>
<p>This is useful for import/export because currently extras are lost.
Therefore this can be used to save and restore the extras on the nodes.</p>
<dl class="field-list simple">
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>filename, string what file to read from (has to be json format)</p>
</dd>
</dl>
<p>example use:
import_extras(‘node_extras.txt’)</p>
</dd></dl>

</div>
<div class="section" id="module-aiida_fleur.tools.read_cif_folder">
<span id="reading-in-cif-files"></span><h2>Reading in Cif files<a class="headerlink" href="#module-aiida_fleur.tools.read_cif_folder" title="Permalink to this headline">¶</a></h2>
<p>In this module you find a method (read_cif_folder) to read in all .cif files
from a folder and store the structures in the database.</p>
<dl class="function">
<dt id="aiida_fleur.tools.read_cif_folder.read_cif_folder">
<code class="sig-prename descclassname">aiida_fleur.tools.read_cif_folder.</code><code class="sig-name descname">read_cif_folder</code><span class="sig-paren">(</span><em class="sig-param">path='/Users/tsep/Documents/aiida/aiida-fleur/docs'</em>, <em class="sig-param">recursive=True</em>, <em class="sig-param">store=False</em>, <em class="sig-param">log=False</em>, <em class="sig-param">comments=''</em>, <em class="sig-param">extras=''</em>, <em class="sig-param">logfile_name='read_cif_folder_logfile'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/read_cif_folder.html#read_cif_folder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.read_cif_folder.read_cif_folder" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to read in cif files from a folder and its subfolders.
It can convert them into AiiDA structures and store them.</p>
<p>defaults input parameter values are:
path=”.”, recursive=True, store=False, log=False, comments=’‘, extras=’‘</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><p>path: Path to the dictionary with the files (default, where this method is called)</p>
</dd>
<dt class="field-even">Params</dt>
<dd class="field-even"><p>recursive: bool, If True: looks aso in subfolders, if False: just given dir</p>
</dd>
<dt class="field-odd">Params</dt>
<dd class="field-odd"><p>store: bool, if True: stores structures in database</p>
</dd>
<dt class="field-even">Params</dt>
<dd class="field-even"><p>log: bool, if True, writes a logfile with information (pks, and co)</p>
</dd>
<dt class="field-odd">Params</dt>
<dd class="field-odd"><p>comments: string: comment to add to the structures</p>
</dd>
<dt class="field-even">Params</dt>
<dd class="field-even"><p>extras: dir/string/arb: extras added to the structures stored in the db</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-aiida_fleur.tools.io_routines">
<span id="io-routines"></span><h2>IO routines<a class="headerlink" href="#module-aiida_fleur.tools.io_routines" title="Permalink to this headline">¶</a></h2>
<p>Here we collect IO routines and their utility, for writting certain things to files, or post process files.
For example collection of data or database evaluations, for other people.</p>
</div>
<div class="section" id="module-aiida_fleur.tools.common_fleur_wf">
<span id="common-utitlity-for-fleur-workchains"></span><h2>Common utitlity for fleur workchains<a class="headerlink" href="#module-aiida_fleur.tools.common_fleur_wf" title="Permalink to this headline">¶</a></h2>
<p>In here we put all things (methods) that are common to workflows AND
depend on AiiDA classes, therefore can only be used if the dbenv is loaded.
Util that does not depend on AiiDA classes should go somewhere else.</p>
<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.determine_favorable_reaction">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">determine_favorable_reaction</code><span class="sig-paren">(</span><em class="sig-param">reaction_list</em>, <em class="sig-param">workchain_dict</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#determine_favorable_reaction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.determine_favorable_reaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds out with reaction is more favorable by simple energy standpoints</p>
<p># TODO check physics
reaction list: list of reaction strings
workchain_dict = {‘Be12W’ : uuid_wc or output, ‘Be2W’ : uuid, …}</p>
<p>return dictionary that ranks the reactions after their enthalpy</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.find_last_submitted_calcjob">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">find_last_submitted_calcjob</code><span class="sig-paren">(</span><em class="sig-param">restart_wc</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#find_last_submitted_calcjob"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.find_last_submitted_calcjob" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the last CalcJob submitted in a higher-level workchain
and returns it’s uuid</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.find_last_submitted_workchain">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">find_last_submitted_workchain</code><span class="sig-paren">(</span><em class="sig-param">restart_wc</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#find_last_submitted_workchain"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.find_last_submitted_workchain" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the last CalcJob submitted in a higher-level workchain
and returns it’s uuid</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.get_inputs_fleur">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">get_inputs_fleur</code><span class="sig-paren">(</span><em class="sig-param">code</em>, <em class="sig-param">remote</em>, <em class="sig-param">fleurinp</em>, <em class="sig-param">options</em>, <em class="sig-param">label=''</em>, <em class="sig-param">description=''</em>, <em class="sig-param">settings=None</em>, <em class="sig-param">serial=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#get_inputs_fleur"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.get_inputs_fleur" title="Permalink to this definition">¶</a></dt>
<dd><p>Assembles the input dictionary for Fleur Calculation. Does not check if a user gave
correct input types, it is the work of FleurCalculation to check it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> – FLEUR code of Code type</p></li>
<li><p><strong>remote</strong> – remote_folder from the previous calculation of RemoteData type</p></li>
<li><p><strong>fleurinp</strong> – FleurinpData object representing input files</p></li>
<li><p><strong>options</strong> – calculation options that will be stored in metadata</p></li>
<li><p><strong>label</strong> – a string setting a label of the CalcJob in the DB</p></li>
<li><p><strong>description</strong> – a string setting a description of the CalcJob in the DB</p></li>
<li><p><strong>settings</strong> – additional settings of Dict type</p></li>
<li><p><strong>serial</strong> – True if run a calculation in a serial mode</p></li>
</ul>
</dd>
</dl>
<p>Example of use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs_build</span> <span class="o">=</span> <span class="n">get_inputs_inpgen</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">inpgencode</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
                                 <span class="n">description</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">inputs_build</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.get_inputs_inpgen">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">get_inputs_inpgen</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">inpgencode</em>, <em class="sig-param">options</em>, <em class="sig-param">label=''</em>, <em class="sig-param">description=''</em>, <em class="sig-param">params=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#get_inputs_inpgen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.get_inputs_inpgen" title="Permalink to this definition">¶</a></dt>
<dd><p>Assembles the input dictionary for Fleur Calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>structure</strong> – input structure of StructureData type</p></li>
<li><p><strong>inpgencode</strong> – inpgen code of Code type</p></li>
<li><p><strong>options</strong> – calculation options that will be stored in metadata</p></li>
<li><p><strong>label</strong> – a string setting a label of the CalcJob in the DB</p></li>
<li><p><strong>description</strong> – a string setting a description of the CalcJob in the DB</p></li>
<li><p><strong>params</strong> – input parameters for inpgen code of Dict type</p></li>
</ul>
</dd>
</dl>
<p>Example of use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs_build</span> <span class="o">=</span> <span class="n">get_inputs_inpgen</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">inpgencode</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
                                 <span class="n">description</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">inputs_build</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.get_kpoints_mesh_from_kdensity">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">get_kpoints_mesh_from_kdensity</code><span class="sig-paren">(</span><em class="sig-param">structure</em>, <em class="sig-param">kpoint_density</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#get_kpoints_mesh_from_kdensity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.get_kpoints_mesh_from_kdensity" title="Permalink to this definition">¶</a></dt>
<dd><p>params: structuredata, Aiida structuredata
params: kpoint_density</p>
<p>returns: tuple (mesh, offset)
returns: kpointsdata node</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.get_scheduler_extras">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">get_scheduler_extras</code><span class="sig-paren">(</span><em class="sig-param">code</em>, <em class="sig-param">resources</em>, <em class="sig-param">extras=None</em>, <em class="sig-param">project='jara0172'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#get_scheduler_extras"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.get_scheduler_extras" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a utility function with the goal to make prepare the right resource
and scheduler extras for a given computer.
Since this is user dependend you might want to create your own.</p>
<p>return: dict, custom scheduler commands</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.is_code">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">is_code</code><span class="sig-paren">(</span><em class="sig-param">code</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#is_code"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.is_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Test if the given input is a Code node, by object, id, uuid, or pk
if yes returns a Code node in all cases
if no returns None</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.optimize_calc_options">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">optimize_calc_options</code><span class="sig-paren">(</span><em class="sig-param">nodes</em>, <em class="sig-param">mpi_per_node</em>, <em class="sig-param">omp_per_mpi</em>, <em class="sig-param">use_omp</em>, <em class="sig-param">mpi_omp_ratio</em>, <em class="sig-param">fleurinpData=None</em>, <em class="sig-param">kpts=None</em>, <em class="sig-param">sacrifice_level=0.9</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#optimize_calc_options"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.optimize_calc_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a suggestion on parallelisation setup for a particular fleurinpData.
Only the total number of k-points is analysed: the function suggests ideal k-point
parallelisation + OMP parallelisation (if required). Note: the total number of used CPUs
per node will not exceed mpi_per_node * omp_per_mpi.</p>
<p>Sometimes perfect parallelisation is terms of idle CPUs is not what
used wanted because it can harm MPI/OMP ratio. Thus the function first chooses first top
parallelisations in terms of total CPUs used
(bigger than sacrifice_level * maximal_number_CPUs_possible). Then a parallelisation which is
the closest to the MPI/OMP ratio is chosen among them and returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nodes</strong> – maximal number of nodes that can be used</p></li>
<li><p><strong>mpi_per_node</strong> – an input suggestion of MPI tasks per node</p></li>
<li><p><strong>omp_per_mpi</strong> – an input suggestion for OMP tasks per MPI process</p></li>
<li><p><strong>use_omp</strong> – False if OMP parallelisation is not needed</p></li>
<li><p><strong>mpi_omp_ratio</strong> – requested MPI/OMP ratio</p></li>
<li><p><strong>fleurinpData</strong> – FleurinpData to extract total number of kpts from</p></li>
<li><p><strong>kpts</strong> – the total number of kpts</p></li>
<li><p><strong>sacrifice_level</strong> – sets a level of performance sacrifice that a user can afford for better
MPI/OMP ratio.</p></li>
</ul>
</dd>
<dt class="field-even">Returns nodes, MPI_tasks, OMP_per_MPI, message</dt>
<dd class="field-even"><p>first three are parallelisation info and
the last one is an exit message.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.performance_extract_calcs">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">performance_extract_calcs</code><span class="sig-paren">(</span><em class="sig-param">calcs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#performance_extract_calcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.performance_extract_calcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts some runtime and system data from given fleur calculations</p>
<dl class="field-list simple">
<dt class="field-odd">Params calcs</dt>
<dd class="field-odd"><p>list of calculation nodes/pks/or uuids. Fleur calc specific</p>
</dd>
<dt class="field-even">Returns data_dict</dt>
<dd class="field-even"><p>dictionary, dictionary of arrays with the same length,
from with a panda frame can be created.</p>
</dd>
</dl>
<p>Note: Is not the fastest for many calculations &gt; 1000.</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf.test_and_get_codenode">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf.</code><code class="sig-name descname">test_and_get_codenode</code><span class="sig-paren">(</span><em class="sig-param">codenode</em>, <em class="sig-param">expected_code_type</em>, <em class="sig-param">use_exceptions=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf.html#test_and_get_codenode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf.test_and_get_codenode" title="Permalink to this definition">¶</a></dt>
<dd><p>Pass a code node and an expected code (plugin) type. Check that the
code exists, is unique, and return the Code object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>codenode</strong> – the name of the code to load (in the form <a class="reference external" href="mailto:label&#37;&#52;&#48;machine">label<span>&#64;</span>machine</a>)</p></li>
<li><p><strong>expected_code_type</strong> – a string with the plugin that is expected to
be loaded. In case no plugins exist with the given name, show all existing
plugins of that type</p></li>
<li><p><strong>use_exceptions</strong> – if True, raise a ValueError exception instead of
calling sys.exit(1)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a Code object</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-aiida_fleur.tools.common_fleur_wf_util"></span><p>In here we put all things (methods) that are common to workflows AND DO NOT
depend on AiiDA classes, therefore can be used without loading the dbenv.
Util that does depend on AiiDA classes should go somewhere else.</p>
<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.balance_equation">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">balance_equation</code><span class="sig-paren">(</span><em class="sig-param">equation_string</em>, <em class="sig-param">allow_negativ=False</em>, <em class="sig-param">allow_zero=False</em>, <em class="sig-param">eval_linear=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#balance_equation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.balance_equation" title="Permalink to this definition">¶</a></dt>
<dd><p>Method that balances a chemical equation.</p>
<p>param equation_string: string (with ‘-&gt;’)
param allow_negativ: bool, default False, allows for negative coefficients for the products.</p>
<p>return string: balanced equation</p>
<p>balance_equation(“C7H16+O2 -&gt; CO2+H2O”))
balance_equation(“Be12W-&gt;Be22W+Be12W”)
balance_equation(“Be12W-&gt;Be12W”)</p>
<p>have to be intergers everywhere in the equation, factors and formulas</p>
<p>1*C7H16+11*O2 -&gt;7* CO2+8*H2O
None
1*Be12W-&gt;1*Be12W
#TODO The solver better then what we need. Currently if system is over
#”Be12W-&gt;Be2W+W+Be” solves to {a: 24, b: -d/2 + 144, c: d/2 - 120}-&gt; FAIL-&gt; None
# The code fails in the later stage, but this solution should maybe be used.</p>
<p>code adapted from stack exchange (the messy part):
<a class="reference external" href="https://codegolf.stackexchange.com/questions/8728/balance-chemical-equations">https://codegolf.stackexchange.com/questions/8728/balance-chemical-equations</a></p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.calc_stoi">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">calc_stoi</code><span class="sig-paren">(</span><em class="sig-param">unitcellratios</em>, <em class="sig-param">formulas</em>, <em class="sig-param">error_ratio=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#calc_stoi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.calc_stoi" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Stoichiometry with errors from a given unit cell ratio, formulas.</p>
<p>Example:
calc_stoi([10, 1, 7], [‘Be12Ti’, ‘Be17Ti2’, ‘Be2’], [0.1, 0.01, 0.1])
({‘Be’: 12.583333333333334, ‘Ti’: 1.0}, {‘Be’: 0.12621369924887876, ‘Ti’: 0.0012256517540566825})
calc_stoi([10, 1, 7], [‘Be12Ti’, ‘Be17Ti2’, ‘Be2’])
({‘Be’: 12.583333333333334, ‘Ti’: 1.0}, {})</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.check_eos_energies">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">check_eos_energies</code><span class="sig-paren">(</span><em class="sig-param">energylist</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#check_eos_energies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.check_eos_energies" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if there is an abnormality in the total energies from the Equation of states.
i.e. if one point has a larger energy then its two neighbors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>energylist</strong> – list of floats</p>
</dd>
<dt class="field-even">Returns nnormalies</dt>
<dd class="field-even"><p>integer</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.convert_eq_to_dict">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">convert_eq_to_dict</code><span class="sig-paren">(</span><em class="sig-param">equationstring</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#convert_eq_to_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.convert_eq_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts an equation string to a dictionary
convert_eq_to_dict(‘1*Be12Ti-&gt;10*Be+1*Be2Ti+5*Be’) -&gt;
{‘products’: {‘Be’: 15, ‘Be2Ti’: 1}, ‘educts’: {‘Be12Ti’: 1}}</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.convert_formula_to_formula_unit">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">convert_formula_to_formula_unit</code><span class="sig-paren">(</span><em class="sig-param">formula</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#convert_formula_to_formula_unit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.convert_formula_to_formula_unit" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a formula to the smallest chemical formula unit
‘Be4W2’ -&gt; ‘Be2W’</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.convert_frac_formula">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">convert_frac_formula</code><span class="sig-paren">(</span><em class="sig-param">formula</em>, <em class="sig-param">max_digits=3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#convert_frac_formula"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.convert_frac_formula" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a formula with fractions to a formula with integer factors only</p>
<p>Be0.5W0.5 -&gt; BeW</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>formula</strong> – str, crystal formula i.e. Be2W, Be0.2W0.7</p></li>
<li><p><strong>max_digits</strong> – int default=3, number of digits after which fractions will be cut off</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.determine_convex_hull">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">determine_convex_hull</code><span class="sig-paren">(</span><em class="sig-param">formation_en_grid</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#determine_convex_hull"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.determine_convex_hull" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps the pyhull packge implementing the qhull algo for our purposes.
For now only for 2D phase diagrams
Adds the points [1.0, 0.0] and [0.0, 1.0], because in material science these
are always there.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><p>formation_en_grid: list of points in phase space [[x, formation_energy]]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a hul datatype</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.determine_formation_energy">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">determine_formation_energy</code><span class="sig-paren">(</span><em class="sig-param">struc_te_dict</em>, <em class="sig-param">ref_struc_te_dict</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#determine_formation_energy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.determine_formation_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>This method determines the formation energy.
E_form =  E(A_xB_y) - x*E(A) - y*E(B)</p>
<dl class="field-list simple">
<dt class="field-odd">Params struc_te_dict</dt>
<dd class="field-odd"><p>python dictionary in the form of {‘formula’ : total_energy} for the compound(s)</p>
</dd>
<dt class="field-even">Params ref_struc_te_dict</dt>
<dd class="field-even"><p>python dictionary in the form of {‘formula’ : total_energy per atom, or per unit cell} for the elements
(if the formula of the elements contains a number the total energy is divided by that number)</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of floats, dict {formula : eform, ..} units energy/per atom, energies have some unit as energies given</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.determine_reactions">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">determine_reactions</code><span class="sig-paren">(</span><em class="sig-param">formula</em>, <em class="sig-param">available_data</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#determine_reactions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.determine_reactions" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines and balances theoretical possible reaction.
Stoichiometry ‘Be12W’, [Be12W, Be2W, Be, W, Be22W] -&gt; [[Be22W+Be2W], [Be12W], [Be12+W],…]</p>
<dl class="field-list simple">
<dt class="field-odd">Params formula</dt>
<dd class="field-odd"><p>string, given educts (left side of equation)</p>
</dd>
<dt class="field-even">Params available_data</dt>
<dd class="field-even"><p>list of strings of compounds (products),
from which all possibilities will be constructed</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.get_atomprocent">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">get_atomprocent</code><span class="sig-paren">(</span><em class="sig-param">formula</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#get_atomprocent"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.get_atomprocent" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a formula to a dictionary with element : atomprocent
example converts ‘Be24W2’ to {‘Be’: 24/26, ‘W’ : 2/26}, also BeW to {‘Be’ : 0.5, ‘W’ : 0.5}
:params: formula: string
:returns: a dict, element : atomprocent</p>
<p># Todo alternative with structuredata</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.get_enhalpy_of_equation">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">get_enhalpy_of_equation</code><span class="sig-paren">(</span><em class="sig-param">reaction</em>, <em class="sig-param">formenergydict</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#get_enhalpy_of_equation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.get_enhalpy_of_equation" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the enthalpy per atom of a given reaction from the given data.</p>
<p>param reaction: string
param fromenergydict: dictionary that contains the {compound: formationenergy per atom}</p>
<p># TODO check if physics is right</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.get_natoms_element">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">get_natoms_element</code><span class="sig-paren">(</span><em class="sig-param">formula</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#get_natoms_element"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.get_natoms_element" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts ‘Be24W2’ to {‘Be’: 24, ‘W’ : 2}, also BeW to {‘Be’ : 1, ‘W’ : 1}</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.inpgen_dict_set_mesh">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">inpgen_dict_set_mesh</code><span class="sig-paren">(</span><em class="sig-param">inpgendict</em>, <em class="sig-param">mesh</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#inpgen_dict_set_mesh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.inpgen_dict_set_mesh" title="Permalink to this definition">¶</a></dt>
<dd><p>params: python dict, used for inpgen parameterdata node
params: mesh either as returned by kpointsdata or tuple of 3 integers</p>
<p>returns: python dict, used for inpgen parameterdata node</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.powerset">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">powerset</code><span class="sig-paren">(</span><em class="sig-param">L</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#powerset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.powerset" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs the power set, ‘potenz Menge’ of a given list.</p>
<p>return list: of all possible subsets</p>
</dd></dl>

<dl class="function">
<dt id="aiida_fleur.tools.common_fleur_wf_util.ucell_to_atompr">
<code class="sig-prename descclassname">aiida_fleur.tools.common_fleur_wf_util.</code><code class="sig-name descname">ucell_to_atompr</code><span class="sig-paren">(</span><em class="sig-param">ratio</em>, <em class="sig-param">formulas</em>, <em class="sig-param">element</em>, <em class="sig-param">error_ratio=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida_fleur/tools/common_fleur_wf_util.html#ucell_to_atompr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida_fleur.tools.common_fleur_wf_util.ucell_to_atompr" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts unit cell ratios into atom ratios.</p>
<p>len(ratio) == len(formulas) (== len(error_ratio))
ucell_to_atompr([10, 1, 7], [‘Be12Ti’, ‘Be17Ti2’, ‘Be2’], element=’Be’, [0.1, 0.1, 0.1])</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="code.html" class="btn btn-neutral float-left" title="Fleur input generator plug-in" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020, FZ Jülich GmbH, Germany. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>