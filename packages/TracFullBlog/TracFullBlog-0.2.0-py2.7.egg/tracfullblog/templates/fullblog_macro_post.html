
  ## Macro to render a post
  # macro render_blog_post(post, list_mode=False)
  <div class="blog-post">
    <h1 class="blog-title" id="${post.name}">
      # if list_mode:
      <a href="${req.href.blog(post.name)}">${post.title}</a>
      # else:
      ${post.title}
      #endif
    </h1>
    # with
    #   set do_shorten = blog_max_size and len(post.body) > blog_max_size
    <div class="blog-body" xml:space="preserve">
      ${wiki_to_html(context(post.resource), do_shorten and post.body[:blog_max_size] + ' ... ' or post.body)}
      # if do_shorten:
        <p><a href="${href.blog(post.name)}">(Read more)</a></p>
      # endif
    </div>
    # endwith
    # if show_meta is undefined or show_meta:
    <ul class="metainfo">
      <li class="metadates">Posted: ${pretty_dateinfo and pretty_dateinfo(post.publish_time) or format_datetime(post.publish_time)}
        # if len(post.versions) > 1:
        <span class="metaupdated">
          (Updated: ${pretty_dateinfo and pretty_dateinfo(post.version_time) or format_datetime(post.version_time)})
        </span>
        # endif
      </li>
      # if not blog_personal_blog:
      <li class="metaauthor">Author:
        <a href="${req.href.blog('author', post.author)}">${authorinfo(post.author)}</a>
      </li>
      # endif
      <li class="metacategories">Categories:
        # for cat in post.category_list:
          <a href="${req.href.blog('category', cat)}">${cat}</a>
        # endfor
        # if not post.category_list:
         (none)
        # endif
      </li>
      # if list_mode:
      <li>
        <a href="${req.href.blog(post.name)}">Comments</a> (${len(post.get_comments())})
      </li>
      # endif
    </ul>
    # endif
  </div>
  # endmacro

  {# Directly execute the macro on import if 'execute_blog_macro' is set.
     For this not to throw errors it presumes variables to be called
     already exists in the data dictionary.
  #}
  # if execute_blog_macro:
  ${render_blog_post(post, list_mode)}
  # endif

