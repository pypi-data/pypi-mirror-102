(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{110:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(19),c=n.n(i),o=n(77),s=n(150),l=n(152),u=n(15),d=n(5),f=n.n(d),p=n(8),v=n(1),b=n(4),j=n(2),m=n(3),g=n(22),h=n(117),O=n(80),x=n(153),y=n(73),C=n(75),S=n.n(C),E=n(11),I=function(e){var t=e.theme,n=r.a.useMemo((function(){if(null!=t){var e=S.a.scale([t.textColor,t.backgroundColor]).mode("lab");return Object(o.a)({palette:{primary:{main:t.primaryColor},background:{default:t.backgroundColor,paper:t.secondaryBackgroundColor},text:{primary:t.textColor,secondary:e(.1).hex(),disabled:e(.5).hex()}},typography:{fontFamily:t.font}})}}),[t]);return null==n?Object(E.jsx)(E.Fragment,{children:e.children}):Object(E.jsx)(s.a,{theme:n,children:e.children})},k={width:"100%"},w=function(e){Object(a.useEffect)((function(){g.a.setFrameHeight()}));var t=e.stream.getVideoTracks().length>0,n=Object(a.useCallback)((function(t){t&&(t.srcObject=e.stream)}),[e.stream]),r=Object(a.useCallback)((function(){return g.a.setFrameHeight()}),[]);return t?Object(E.jsx)("video",{style:k,ref:n,autoPlay:!0,controls:!0,onCanPlay:r}):Object(E.jsx)("audio",{ref:n,autoPlay:!0,controls:!0})},N=r.a.memo(w),D=n(111),R=n(114),T=n(151),V=n(76),L=n.n(V),M=Object(D.a)((function(e){return{paper:{padding:e.spacing(4),display:"flex",justifyContent:"center",alignItems:"center"}}})),B=function(e){Object(a.useEffect)((function(){g.a.setFrameHeight()}));var t=M();return Object(E.jsx)(R.a,{className:t.paper,elevation:0,children:e.loading?Object(E.jsx)(T.a,{}):Object(E.jsx)(L.a,{fontSize:"large"})})},F=r.a.memo(B),P=function(e){return"RECVONLY"===e||"SENDONLY"===e||"SENDRECV"===e},Y=function(e){return e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))},_=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).pc=void 0,a.videoRef=void 0,a.audioRef=void 0,a.processAnswerInner=function(){var e=Object(p.a)(f.a.mark((function e(t,n){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),console.log("Receive answer sdpOffer",a),e.next=4,t.setRemoteDescription(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.processAnswer=function(e,t){a.processAnswerInner(e,t).then((function(){console.log("Remote description is set")})).finally((function(){return a.setState({signaling:!1})}))},a.startInner=Object(p.a)(f.a.mark((function e(){var t,n,r,i,c,o,s,l,d,p,v,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props.args.mode,P(n)){e.next=3;break}throw new Error("Invalid mode ".concat(n));case 3:if(a.setState({signaling:!0,stream:null,error:null}),r=(null===(t=a.props.args.settings)||void 0===t?void 0:t.rtc_configuration)||{},console.log("RTCConfiguration:",r),i=new RTCPeerConnection(r),"SENDRECV"!==n&&"RECVONLY"!==n||i.addEventListener("track",(function(e){var t=e.streams[0];a.setState({stream:t})})),"SENDRECV"!==n&&"SENDONLY"!==n){e.next=28;break}if(o=null===(c=a.props.args.settings)||void 0===c?void 0:c.media_stream_constraints,s=!o||o.audio,l=!o||o.video,d={},s&&(d.audio=!a.state.audioInput||{deviceId:a.state.audioInput.deviceId}),l&&(d.video=!a.state.videoInput||{deviceId:a.state.videoInput.deviceId}),console.log("MediaStreamConstraints:",d),!d.audio&&!d.video){e.next=25;break}if(null!=navigator.mediaDevices){e.next=19;break}throw new Error("navigator.mediaDevices is undefined. It seems the current document is not loaded securely.");case 19:if(null!=navigator.mediaDevices.getUserMedia){e.next=21;break}throw new Error("getUserMedia is not implemented in this browser");case 21:return e.next=23,navigator.mediaDevices.getUserMedia(d);case 23:(p=e.sent).getTracks().forEach((function(e){i.addTrack(e,p)}));case 25:if("SENDONLY"===n){v=Object(u.a)(i.getTransceivers());try{for(v.s();!(b=v.n()).done;)b.value.direction="sendonly"}catch(f){v.e(f)}finally{v.f()}}e.next=29;break;case 28:"RECVONLY"===n&&(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}));case 29:a.setState({playing:!0}),console.log("transceivers",i.getTransceivers()),Y(i).then((function(e){null!=e?(console.log("Send sdpOffer",e.toJSON()),g.a.setComponentValue({sdpOffer:e.toJSON(),playing:!0})):console.warn("Failed to create an offer SDP")})),a.pc=i;case 33:case"end":return e.stop()}}),e)}))),a.start=function(){a.startInner().catch((function(e){return a.setState({signaling:!1,error:e})}))},a.stopInner=Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.pc,a.pc=void 0,a.setState({playing:!1},(function(){return g.a.setComponentValue({playing:!1})})),null!=t){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 8:case"end":return e.stop()}}),e)}))),a.stop=function(){a.setState({stopping:!0}),a.stopInner().finally((function(){a.setState({stopping:!1,stream:null})}))},a.handleDeviceSelect=function(e,t){a.setState({videoInput:e,audioInput:t})},a.render=function(){var e=a.props.disabled||a.state.signaling||a.state.stopping,t=a.props.args.mode,n=P(t)&&function(e){return"SENDRECV"===e||"RECVONLY"===e}(t),r=P(t)&&function(e){return"SENDRECV"===e||"SENDONLY"===e}(t);return Object(E.jsx)(I,{theme:a.props.theme,children:Object(E.jsxs)(h.a,{children:[a.state.error&&Object(E.jsxs)(x.a,{severity:"error",children:[a.state.error.name,": ",a.state.error.message]}),Object(E.jsx)(h.a,{py:1,children:a.state.stream?Object(E.jsx)(N,{stream:a.state.stream}):n&&Object(E.jsx)(F,{loading:a.state.signaling})}),Object(E.jsxs)(h.a,{display:"flex",justifyContent:"space-between",children:[a.state.playing?Object(E.jsx)(O.a,{variant:"contained",onClick:a.stop,disabled:e,children:"Stop"}):Object(E.jsx)(O.a,{variant:"contained",color:"primary",onClick:a.start,disabled:e,children:"Start"}),r&&Object(E.jsx)(y.a,{onSelect:a.handleDeviceSelect,value:{video:a.state.videoInput,audio:a.state.audioInput}})]})]})})},a.videoRef=r.a.createRef(),a.audioRef=r.a.createRef(),a.state={signaling:!1,playing:!1,stopping:!1,videoInput:null,audioInput:null,stream:null,error:null},a}return Object(b.a)(n,[{key:"componentDidUpdate",value:function(){if(null!=this.pc){var e=this.pc;if(null==e.remoteDescription){var t=this.props.args.sdp_answer_json;t&&this.processAnswer(e,t)}}}}]),n}(g.b),H=Object(g.c)(_),A=Object(o.a)({overrides:{MuiCssBaseline:{"@global":{body:{backgroundColor:"initial"}}}}});c.a.render(Object(E.jsx)(r.a.StrictMode,{children:Object(E.jsxs)(s.a,{theme:A,children:[Object(E.jsx)(l.a,{}),Object(E.jsx)(H,{})]})}),document.getElementById("root"))},73:function(e,t,n){"use strict";(function(e){var a=n(15),r=n(14),i=n(0),c=n.n(i),o=n(22),s=n(117),l=n(111),u=n(80),d=n(69),f=n(82),p=n(81),v=n(119),b=n(115),j=n(114),m=n(11),g=Object(l.a)((function(e){return{paper:{padding:e.spacing(2)},formControl:{maxWidth:"80vw",margin:e.spacing(1),minWidth:120,display:"flex"},formButtonControl:{margin:e.spacing(2),marginBottom:e.spacing(1),minWidth:120,display:"flex"},selectEmpty:{marginTop:e.spacing(2)}}})),h=function(t){var n=t.labelId,a=t.value,r=t.devices,c=t.onChange,o=g(),s=Object(i.useCallback)((function(e){var t=r.find((function(t){return t.deviceId===e.target.value}));c(t||null)}),[r,c]);return 0===r.length?Object(m.jsx)(p.a,{value:"",disabled:!0,children:Object(m.jsx)("option",{"aria-label":"None",value:""})}):null==a?(e((function(){return c(r[0])})),null):Object(m.jsx)(p.a,{labelId:n,value:a.deviceId,onChange:s,className:o.selectEmpty,children:r.map((function(e){return Object(m.jsx)(v.a,{value:e.deviceId,children:e.label},e.deviceId)}))})},O=function(e){var t=e.open,n=e.anchorEl,a=e.value,c=e.devicesMap,s=e.onSubmit,l=Object(i.useState)(null),p=Object(r.a)(l,2),v=p[0],O=p[1],x=Object(i.useState)(null),y=Object(r.a)(x,2),C=y[0],S=y[1];Object(i.useEffect)((function(){O(c.video.find((function(e){var t;return e.deviceId===(null===(t=a.video)||void 0===t?void 0:t.deviceId)}))||null),S(c.audio.find((function(e){var t;return e.deviceId===(null===(t=a.audio)||void 0===t?void 0:t.deviceId)}))||null)}),[c,a]);var E=Object(i.useCallback)((function(e){e.preventDefault(),s(v,C)}),[s,v,C]),I=g(),k=Object(i.useRef)(),w=Object(i.useCallback)((function(e){if(e)setTimeout((function(){var t=document.getElementsByTagName("body")[0];k.current=t.style.height;var n=window.getComputedStyle(e),a=new WebKitCSSMatrix(n.transform).m42+e.getBoundingClientRect().height;a>document.body.scrollHeight&&(t.style.height="".concat(a,"px"),o.a.setFrameHeight())}),0);else{var t=document.getElementsByTagName("body")[0];null!=k.current&&(t.style.height=k.current),o.a.setFrameHeight()}}),[]);return Object(m.jsx)(b.a,{ref:w,open:t,anchorEl:n,placement:"left-end",children:Object(m.jsx)(j.a,{className:I.paper,children:Object(m.jsxs)("form",{onSubmit:E,children:[Object(m.jsxs)(d.a,{className:I.formControl,children:[Object(m.jsx)(f.a,{id:"video-input-select",children:"Video input"}),Object(m.jsx)(h,{labelId:"video-input-select",devices:c.video,value:v,onChange:O})]}),Object(m.jsxs)(d.a,{className:I.formControl,children:[Object(m.jsx)(f.a,{id:"audio-input-select",children:"Audio input"}),Object(m.jsx)(h,{labelId:"audio-input-select",devices:c.audio,value:C,onChange:S})]}),Object(m.jsx)(d.a,{className:I.formButtonControl,children:Object(m.jsx)(u.a,{type:"submit",variant:"contained",color:"primary",children:"OK"})})]})})})},x=function(e){var t=e.value,n=e.onSelect,o=Object(i.useState)(!1),l=Object(r.a)(o,2),d=l[0],f=l[1],p=c.a.useState(null),v=Object(r.a)(p,2),b=v[0],j=v[1],g=Object(i.useState)(),h=Object(r.a)(g,2),x=h[0],y=h[1],C=Object(i.useState)(!1),S=Object(r.a)(C,2),E=S[0],I=S[1],k=Object(i.useCallback)((function(e){var t,n;if(j(e.currentTarget),"function"!==typeof(null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.enumerateDevices))return y(void 0),void I(!0);navigator.mediaDevices.enumerateDevices().then((function(e){var t,n=[],r=[],i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value;"videoinput"===c.kind?n.push(c):"audioinput"===c.kind&&r.push(c)}}catch(o){i.e(o)}finally{i.f()}y({video:n,audio:r}),f(!0)}))}),[]),w=Object(i.useCallback)((function(){return f(!1)}),[]),N=Object(i.useCallback)((function(e,t){y(void 0),f(!1),n(e,t)}),[n]);return Object(m.jsxs)(s.a,{children:[E&&Object(m.jsx)("p",{children:"Unavailable"}),x&&Object(m.jsx)(O,{open:d,anchorEl:b,value:t,devicesMap:x,onSubmit:N}),Object(m.jsx)(u.a,{onClick:d?w:k,children:"Select device"})]})};t.a=c.a.memo(x)}).call(this,n(99).setImmediate)}},[[110,1,2]]]);
//# sourceMappingURL=main.98ef58a6.chunk.js.map