(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{74:function(e,t,n){"use strict";(function(e){var a=n(16),i=n(5),r=n.n(i),o=n(8),c=n(1),s=n(4),l=n(2),u=n(3),d=n(28),v=n(0),f=n.n(v),p=n(54),b=n(64),h=n(116),j=n(75),m=n(76),g=n(78),O=n(11),x=function(e){return"RECVONLY"===e||"SENDONLY"===e||"SENDRECV"===e},y=function(e){return e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))},C=function(t){Object(l.a)(i,t);var n=Object(u.a)(i);function i(t){var s;return Object(c.a)(this,i),(s=n.call(this,t)).pc=void 0,s.videoRef=void 0,s.audioRef=void 0,s.processAnswerInner=function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),console.log("Receive answer sdpOffer",a),e.next=4,t.setRemoteDescription(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.processAnswer=function(e,t){s.processAnswerInner(e,t).then((function(){console.log("Remote description is set")})).finally((function(){return s.setState({signaling:!1})}))},s.startInner=Object(o.a)(r.a.mark((function e(){var t,n,i,o,c,l,u,v,f,p,b,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.props.args.mode,x(n)){e.next=3;break}throw new Error("Invalid mode ".concat(n));case 3:if(s.setState({signaling:!0,hasVideo:!1,hasAudio:!1,error:null}),i=(null===(t=s.props.args.settings)||void 0===t?void 0:t.rtc_configuration)||{},console.log("RTCConfiguration:",i),o=new RTCPeerConnection(i),"SENDRECV"!==n&&"RECVONLY"!==n||o.addEventListener("track",(function(e){if("video"===e.track.kind){var t=s.videoRef.current;if(null==t)return void console.error("video element is not mounted");t.srcObject=e.streams[0],s.setState({hasVideo:!0})}else{var n=s.audioRef.current;if(null==n)return void console.error("audio element is not mounted");n.srcObject=e.streams[0],s.setState({hasAudio:!0})}})),"SENDRECV"!==n&&"SENDONLY"!==n){e.next=28;break}if(l=null===(c=s.props.args.settings)||void 0===c?void 0:c.media_stream_constraints,u=!l||l.audio,v=!l||l.video,f={},u&&(f.audio=!s.state.audioInput||{deviceId:s.state.audioInput.deviceId}),v&&(f.video=!s.state.videoInput||{deviceId:s.state.videoInput.deviceId}),console.log("MediaStreamConstraints:",f),!f.audio&&!f.video){e.next=25;break}if(null!=navigator.mediaDevices){e.next=19;break}throw new Error("navigator.mediaDevices is undefined. It seems the current document is not loaded securely.");case 19:if(null!=navigator.mediaDevices.getUserMedia){e.next=21;break}throw new Error("getUserMedia is not implemented in this browser");case 21:return e.next=23,navigator.mediaDevices.getUserMedia(f);case 23:(p=e.sent).getTracks().forEach((function(e){o.addTrack(e,p)}));case 25:if("SENDONLY"===n){b=Object(a.a)(o.getTransceivers());try{for(b.s();!(h=b.n()).done;)h.value.direction="sendonly"}catch(r){b.e(r)}finally{b.f()}}e.next=29;break;case 28:"RECVONLY"===n&&(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}));case 29:s.setState({playing:!0}),console.log("transceivers",o.getTransceivers()),y(o).then((function(e){null!=e?(console.log("Send sdpOffer",e.toJSON()),d.a.setComponentValue({sdpOffer:e.toJSON(),playing:!0})):console.warn("Failed to create an offer SDP")})),s.pc=o;case 33:case"end":return e.stop()}}),e)}))),s.start=function(){s.startInner().catch((function(e){return s.setState({signaling:!1,error:e})}))},s.stopInner=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.pc,s.pc=void 0,s.setState({playing:!1},(function(){return d.a.setComponentValue({playing:!1})})),null!=t){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 8:case"end":return e.stop()}}),e)}))),s.stop=function(){s.setState({stopping:!0}),s.stopInner().finally((function(){s.setState({stopping:!1,hasVideo:!1,hasAudio:!1})}))},s.handleDeviceSelect=function(e,t){s.setState({videoInput:e,audioInput:t})},s.render=function(){var t=s.props.disabled||s.state.signaling||s.state.stopping,n=s.props.args.mode,a=x(n)&&function(e){return"SENDRECV"===e||"RECVONLY"===e}(n);return Object(O.jsx)(g.a,{theme:s.props.theme,children:Object(O.jsxs)(p.a,{children:[s.state.error&&Object(O.jsxs)(h.a,{severity:"error",children:[s.state.error.name,": ",s.state.error.message]}),Object(O.jsxs)(j.a,{visible:a,onVisibilityChange:function(){return e(d.a.setFrameHeight)},children:[Object(O.jsx)(p.a,{children:Object(O.jsx)("video",{style:{width:"100%"},ref:s.videoRef,autoPlay:!0,controls:!0,onCanPlay:function(){return d.a.setFrameHeight()}})}),Object(O.jsx)(p.a,{children:Object(O.jsx)("audio",{ref:s.audioRef,autoPlay:!0,controls:!0})})]}),Object(O.jsxs)(p.a,{display:"flex",justifyContent:"space-between",children:[s.state.playing?Object(O.jsx)(b.a,{variant:"contained",onClick:s.stop,disabled:t,children:"Stop"}):Object(O.jsx)(b.a,{variant:"contained",color:"primary",onClick:s.start,disabled:t,children:"Start"}),Object(O.jsx)(m.a,{onSelect:s.handleDeviceSelect,value:{video:s.state.videoInput,audio:s.state.audioInput}})]})]})})},s.videoRef=f.a.createRef(),s.audioRef=f.a.createRef(),s.state={signaling:!1,playing:!1,stopping:!1,videoInput:null,audioInput:null,hasVideo:!1,hasAudio:!1,error:null},s}return Object(s.a)(i,[{key:"componentDidUpdate",value:function(){if(null!=this.pc){var e=this.pc;if(null==e.remoteDescription){var t=this.props.args.sdp_answer_json;t&&this.processAnswer(e,t)}}}}]),i}(d.b);t.a=Object(d.c)(C)}).call(this,n(73).setImmediate)},75:function(e,t,n){"use strict";var a=n(15),i=n(45),r=n(0),o=n.n(r),c=n(11),s=function(e){var t,n=e.visible,o=void 0===n||n,s=e.onVisibilityChange,l=Object(i.a)(e,["visible","onVisibilityChange"]);return Object(r.useEffect)((function(){s(o)}),[o,s]),Object(c.jsx)("div",Object(a.a)({style:Object(a.a)(Object(a.a)({},l.style),{},{display:o?null===(t=l.style)||void 0===t?void 0:t.display:"none"})},l))};t.a=o.a.memo(s)},76:function(e,t,n){"use strict";(function(e){var a=n(16),i=n(14),r=n(0),o=n.n(r),c=n(28),s=n(54),l=n(109),u=n(64),d=n(68),v=n(85),f=n(84),p=n(118),b=n(113),h=n(112),j=n(11),m=Object(l.a)((function(e){return{paper:{padding:e.spacing(2)},formControl:{maxWidth:"80vw",margin:e.spacing(1),minWidth:120,display:"flex"},formButtonControl:{margin:e.spacing(2),marginBottom:e.spacing(1),minWidth:120,display:"flex"},selectEmpty:{marginTop:e.spacing(2)}}})),g=function(t){var n=t.labelId,a=t.value,i=t.devices,o=t.onChange,c=m(),s=Object(r.useCallback)((function(e){var t=i.find((function(t){return t.deviceId===e.target.value}));o(t||null)}),[i,o]);return 0===i.length?Object(j.jsx)(f.a,{value:"",disabled:!0,children:Object(j.jsx)("option",{"aria-label":"None",value:""})}):null==a?(e((function(){return o(i[0])})),null):Object(j.jsx)(f.a,{labelId:n,value:a.deviceId,onChange:s,className:c.selectEmpty,children:i.map((function(e){return Object(j.jsx)(p.a,{value:e.deviceId,children:e.label},e.deviceId)}))})},O=function(e){var t=e.open,n=e.anchorEl,a=e.value,o=e.devicesMap,s=e.onSubmit,l=Object(r.useState)(null),f=Object(i.a)(l,2),p=f[0],O=f[1],x=Object(r.useState)(null),y=Object(i.a)(x,2),C=y[0],S=y[1];Object(r.useEffect)((function(){O(o.video.find((function(e){var t;return e.deviceId===(null===(t=a.video)||void 0===t?void 0:t.deviceId)}))||null),S(o.audio.find((function(e){var t;return e.deviceId===(null===(t=a.audio)||void 0===t?void 0:t.deviceId)}))||null)}),[o,a]);var I=Object(r.useCallback)((function(e){e.preventDefault(),s(p,C)}),[s,p,C]),k=m(),E=Object(r.useRef)(),w=Object(r.useCallback)((function(e){if(e)setTimeout((function(){var t=document.getElementsByTagName("body")[0];E.current=t.style.height;var n=window.getComputedStyle(e),a=new WebKitCSSMatrix(n.transform).m42+e.getBoundingClientRect().height;a>document.body.scrollHeight&&(t.style.height="".concat(a,"px"),c.a.setFrameHeight())}),0);else{var t=document.getElementsByTagName("body")[0];null!=E.current&&(t.style.height=E.current),c.a.setFrameHeight()}}),[]);return Object(j.jsx)(b.a,{ref:w,open:t,anchorEl:n,placement:"left-end",children:Object(j.jsx)(h.a,{className:k.paper,children:Object(j.jsxs)("form",{onSubmit:I,children:[Object(j.jsxs)(d.a,{className:k.formControl,children:[Object(j.jsx)(v.a,{id:"video-input-select",children:"Video input"}),Object(j.jsx)(g,{labelId:"video-input-select",devices:o.video,value:p,onChange:O})]}),Object(j.jsxs)(d.a,{className:k.formControl,children:[Object(j.jsx)(v.a,{id:"audio-input-select",children:"Audio input"}),Object(j.jsx)(g,{labelId:"audio-input-select",devices:o.audio,value:C,onChange:S})]}),Object(j.jsx)(d.a,{className:k.formButtonControl,children:Object(j.jsx)(u.a,{type:"submit",variant:"contained",color:"primary",children:"OK"})})]})})})},x=function(e){var t=e.value,n=e.onSelect,c=Object(r.useState)(!1),l=Object(i.a)(c,2),d=l[0],v=l[1],f=o.a.useState(null),p=Object(i.a)(f,2),b=p[0],h=p[1],m=Object(r.useState)(),g=Object(i.a)(m,2),x=g[0],y=g[1],C=Object(r.useState)(!1),S=Object(i.a)(C,2),I=S[0],k=S[1],E=Object(r.useCallback)((function(e){var t,n;if(h(e.currentTarget),"function"!==typeof(null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.enumerateDevices))return y(void 0),void k(!0);navigator.mediaDevices.enumerateDevices().then((function(e){var t,n=[],i=[],r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;"videoinput"===o.kind?n.push(o):"audioinput"===o.kind&&i.push(o)}}catch(c){r.e(c)}finally{r.f()}y({video:n,audio:i}),v(!0)}))}),[]),w=Object(r.useCallback)((function(){return v(!1)}),[]),N=Object(r.useCallback)((function(e,t){y(void 0),v(!1),n(e,t)}),[n]);return Object(j.jsxs)(s.a,{children:[I&&Object(j.jsx)("p",{children:"Unavailable"}),x&&Object(j.jsx)(O,{open:d,anchorEl:b,value:t,devicesMap:x,onSubmit:N}),Object(j.jsx)(u.a,{onClick:d?w:E,children:"Select device"})]})};t.a=o.a.memo(x)}).call(this,n(73).setImmediate)},78:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(63),o=n(83),c=n(79),s=n.n(c),l=n(11);t.a=function(e){var t=e.theme,n=i.a.useMemo((function(){if(null!=t){var e=s.a.scale([t.textColor,t.backgroundColor]).mode("lab");return Object(r.a)({palette:{primary:{main:t.primaryColor},background:{default:t.backgroundColor,paper:t.secondaryBackgroundColor},text:{primary:t.textColor,secondary:e(.1).hex(),disabled:e(.5).hex()}},typography:{fontFamily:t.font}})}}),[t]);return null==n?Object(l.jsx)(l.Fragment,{children:e.children}):Object(l.jsx)(o.a,{theme:n,children:e.children})}},86:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(19),o=n.n(r),c=n(63),s=n(83),l=n(114),u=n(74),d=n(11),v=Object(c.a)({overrides:{MuiCssBaseline:{"@global":{body:{backgroundColor:"initial"}}}}});o.a.render(Object(d.jsx)(i.a.StrictMode,{children:Object(d.jsxs)(s.a,{theme:v,children:[Object(d.jsx)(l.a,{}),Object(d.jsx)(u.a,{})]})}),document.getElementById("root"))}},[[86,1,2]]]);
//# sourceMappingURL=main.a26191df.chunk.js.map