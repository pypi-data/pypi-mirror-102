(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[356],{45792:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var l=n(60352),a=n.n(l)()((function(e){return e[1]}));a.push([e.id,".NiceTable .MuiTableCell-root {\n    padding-top: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n    padding-right: 5px;\n}\n\n.NiceTable .MuiIconButton-root {\n    padding: 1px;\n}",""]);const r=a},20864:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var l=n(69297),a=n.n(l);const r=({color:e,onClick:t,children:n})=>{let l={color:e||"gray",cursor:"pointer",textDecoration:"underline"};return a().createElement("span",{style:l,onClick:t},n)}},67539:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var l=n(22682),a=n(37450),r=n(2197),s=n(92378),o=n(62198),i=n(12930),c=n(39110),u=n(23801),d=n(816),m=n(69297),p=n.n(m),g=n(93379),b=n.n(g),E=n(45792);b()(E.Z,{insert:"head",singleton:!1}),E.Z.locals;const k=({title:e,rowKey:t,onDeleteRow:n})=>{const l=(0,m.useCallback)((()=>{n&&n(t)}),[n,t]);return p().createElement(c.Z,{title:e,onClick:l},p().createElement(u.Z,null))},w=({title:e,rowKey:t,onConfirmDeleteRow:n})=>{const l=(0,m.useCallback)((()=>{n&&n(t,!0)}),[n,t]),a=(0,m.useCallback)((()=>{n&&n(t,!1)}),[n,t]);return p().createElement("span",null,"Confirm delete?",p().createElement(c.Z,{title:e,onClick:l},p().createElement(u.Z,null)),p().createElement(c.Z,{title:"Cancel",onClick:a},"✖"))},f=({title:e,rowKey:t,onEditRow:n})=>p().createElement(c.Z,{title:e,onClick:()=>n&&n(t)},p().createElement(d.Z,null)),h=({rows:e,columns:t,onDeleteRow:n,deleteRowLabel:c,onEditRow:u,editRowLabel:d,selectionMode:g="none",selectedRowKeys:b={},onSelectedRowKeysChanged:E})=>{const h=(0,m.useMemo)((()=>{const e={};return Object.keys(b).forEach((t=>{e[t]=b[t]})),e}),[b]),[y,v]=(0,m.useState)(null),C=(0,m.useCallback)((e=>{E&&("single"===g?e in h&&h[e]?E([]):E([e+""]):"multiple"===g&&E(Object.keys(h).filter((t=>t!=e&&h[t])).concat(h[e]?[]:[e.toString()])))}),[E,g,h]),Z=(0,m.useCallback)((e=>{v(e)}),[]),S=(0,m.useCallback)(((e,t)=>{t&&n&&n(e),v(null)}),[n]),I=(0,m.useCallback)((e=>{u&&u(e)}),[u]);return p().createElement(l.Z,{className:"NiceTable"},p().createElement(a.Z,null,p().createElement(r.Z,null,p().createElement(s.Z,{key:"_first",style:{width:0}}),t.map((e=>p().createElement(s.Z,{key:e.key},p().createElement("span",null,e.label)))))),p().createElement(o.Z,null,e.map((e=>p().createElement(r.Z,{key:e.key},p().createElement(s.Z,null,n&&(y===e.key?p().createElement(w,{title:c||"",onConfirmDeleteRow:S,rowKey:e.key}):p().createElement(k,{title:c||"",onDeleteRow:Z,rowKey:e.key})),u&&p().createElement(f,{title:d||"",onEditRow:I,rowKey:e.key}),"none"!==g&&p().createElement(i.Z,{checked:h[e.key]||!1,onClick:()=>C(e.key)})),t.map((t=>{return p().createElement(s.Z,{key:t.key},p().createElement("span",null,0==(n=e.columnValues[t.key])?n:n?"object"==typeof n?n.element?n.element:n.text||"":n:""));var n})))))))}},78356:(e,t,n)=>{"use strict";n.d(t,{Z:()=>B});var l=n(10841),a=n(69297),r=n.n(a),s=n(95849),o=n(94234),i=n(7424),c=n(5443),u=n(20864);const d=()=>{const[e,t]=(0,a.useState)([]),n=(0,a.useContext)(c.Zo);return(0,a.useEffect)((()=>{const e=setInterval((()=>{const e=n.getHitherJobs();t(e)}),1e3);return()=>{clearInterval(e)}}),[n]),{pendingJobs:e.filter((e=>"pending"===e.status)),runningJobs:e.filter((e=>"running"===e.status)),finishedJobs:e.filter((e=>"finished"===e.status)),erroredJobs:e.filter((e=>"error"===e.status)),allJobs:e}},m=({onClick:e})=>{const{pendingJobs:t,runningJobs:n,finishedJobs:l,erroredJobs:a}=d(),s=t.length,o=n.length,i=l.length,c=a.length,m=`Jobs: ${s} pending | ${o} running | ${i} finished | ${c} errored`,p=c>0?r().createElement("span",null,":",r().createElement("span",{style:{color:"pink"}},c)):r().createElement("span",null);return r().createElement(u.Z,{onClick:e,color:"white"},r().createElement("span",{title:m,style:{fontFamily:"courier"}},s,":",o,":",i,p))};var p=n(39110),g=n(62275),b=n(39518),E=n(54193);const k=({color:e})=>{const{websocketStatus:t,onReconnectWebsocket:n}=(0,a.useContext)(c.AL),{icon:l,title:s}=(0,a.useMemo)((()=>{switch(t){case"waiting":return{icon:r().createElement(g.Z,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:r().createElement(b.Z,{style:{color:e}}),title:"Connected"};case"disconnected":return{icon:r().createElement(E.Z,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[t,e]),o=(0,a.useCallback)((()=>{"disconnected"===t&&n()}),[t,n]);return r().createElement(p.Z,{title:s,onClick:o},l)};var w=n(55205);const f=({onOpenSettings:e,color:t})=>{const{icon:n,title:l}=(0,a.useMemo)((()=>({icon:r().createElement(w.Z,null),title:"Open settings"})),[]),s=(0,a.useCallback)((()=>{e()}),[e]);return r().createElement(p.Z,{style:{color:t},title:l,onClick:s},n)},h={paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold",cursor:"pointer"},y=({onOpenSettings:e,onOpenJobMonitor:t,workspaceRouteDispatch:n,logo:l})=>{const s=(0,a.useCallback)((()=>{n({type:"gotoRecordingsPage"})}),[n]);return r().createElement(o.Z,{position:"static",style:{height:50,color:"white"}},r().createElement(i.Z,null,l&&r().createElement("img",{src:l,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:s}),"   ",r().createElement("div",{style:h,onClick:s},"Labbox Ephys"),r().createElement("span",{style:{marginLeft:"auto"}}),r().createElement("span",{style:{paddingBottom:0,color:"white"}},r().createElement(f,{onOpenSettings:e,color:"white"}),r().createElement(k,{color:"white"}),r().createElement(m,{onClick:t}))))};var v=n(32772),C=n(95898),Z=n(22682),S=n(37450),I=n(62198),j=n(2197),O=n(92378);const x=({job:e})=>{const t=e.kwargs&&R(e.kwargs).length>50,n=e.kwargs&&R(e.kwargs).length>1e3,[l,s]=(0,a.useState)(!t),o=e.result&&R(e.result).length>50,i=e.result&&R(e.result).length>1e3,[c,u]=(0,a.useState)(!o),d=l?r().createElement("div",null,t&&r().createElement(C.Z,{onClick:()=>s(!1)},"Collapse"),r().createElement("pre",null,e.kwargs?R(e.kwargs):"")):n?r().createElement(C.Z,{onClick:()=>{console.info(e.kwargs)},title:"Write input argumetns to the browser developer tools console"},"Write input arguments to console"):r().createElement(C.Z,{onClick:()=>{console.info(e.kwargs),s(!0)}},"Expand"),m=c?r().createElement("div",null,o&&r().createElement(C.Z,{onClick:()=>u(!1)},"Collapse"),r().createElement("pre",null,e.result?R(e.result):"")):i?r().createElement(C.Z,{onClick:()=>{console.info(e.result)},title:"Write result to the browser developer tools console"},"Write result to console"):r().createElement(C.Z,{onClick:()=>{console.info(e.result),u(!0)}},"Expand"),p=[{label:"Job ID",value:e.jobId},{label:"Function name",value:e.functionName},{label:"Input arguments",value:d},{label:"Status",value:e.status},{label:"Started",value:e.timestampStarted?U(new Date(e.timestampStarted)):""},{label:"Finished",value:e.timestampFinished?U(new Date(e.timestampFinished)):""},{label:"Result",value:m},{label:"Error message",value:e.error_message}];return r().createElement("div",null,r().createElement(Z.Z,{className:"NiceTable"},r().createElement(S.Z,null),r().createElement(I.Z,null,p.map((e=>r().createElement(j.Z,{key:e.label},r().createElement(O.Z,null,e.label),r().createElement(O.Z,null,e.value)))))))};function R(e){return JSON.stringify(e,null,4)}function U(e){let t="";var n,l;return n=e,l=new Date,(n.getFullYear()!==l.getFullYear()||n.getMonth()!==l.getMonth()||n.getDate()!==l.getDate())&&(t+=`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}} `),t+=`${e.toLocaleTimeString()}`,t}const M=({job:e,onBack:t})=>r().createElement("div",null,r().createElement("p",null,r().createElement(u.Z,{onClick:t},"Back to jobs")),r().createElement(x,{job:e}));var D=n(67539),F=n(23801);function J(e){let t="";var n,l;return n=e,l=new Date,(n.getFullYear()!==l.getFullYear()||n.getMonth()!==l.getMonth()||n.getDate()!==l.getDate())&&(t+=`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}} `),t+=`${e.toLocaleTimeString()}`,t}const N=({onClick:e})=>r().createElement(p.Z,{title:"Cancel job",onClick:e},r().createElement(F.Z,null)),T=({jobs:e,onViewJob:t,onCancelJob:n})=>{const l=(0,a.useMemo)((()=>[{key:"jobId",label:"Job"},{key:"functionName",label:"Function"},{key:"status",label:"Status"},{key:"started",label:"Started"},{key:"finished",label:"Finished"},{key:"message",label:"Message"}]),[]),s=(0,a.useMemo)((()=>[...e].sort(((e,t)=>"running"===e.status&&"running"!==t.status?-1:"running"===t.status&&"running"!==e.status?1:e.timestampStarted&&t.timestampStarted?e.timestampStarted<t.timestampStarted?1:t.timestampStarted<e.timestampStarted?-1:0:0))),[e]),o=(0,a.useMemo)((()=>s.map((e=>({key:e.jobId||"null",columnValues:{jobId:{text:e.jobId,element:r().createElement(u.Z,{onClick:()=>{t&&t(e)}},e.jobId)},functionName:{text:e.functionName},status:{text:e.status,element:"running"===e.status?r().createElement("span",null,r().createElement("span",null,e.status," "),r().createElement(N,{onClick:()=>{n&&n(e)}})):r().createElement("span",null,e.status)},started:{text:e.timestampStarted?J(new Date(e.timestampStarted)):""},finished:{text:e.timestampFinished?J(new Date(e.timestampFinished)):""},message:{text:e.error_message||""}}})))),[s]);return r().createElement(D.Z,{rows:o,columns:l})},V=(0,v.Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),W=()=>{const e=V(),{allJobs:t}=d(),[n,l]=(0,a.useState)(null),s=(0,a.useCallback)((e=>{l(e)}),[]),o=(0,a.useCallback)((()=>{}),[]),i=(0,a.useCallback)((()=>{l(null)}),[]);return r().createElement("div",{className:e.paper,style:{zIndex:9999}},r().createElement("h2",null,"Job Monitor"),n?r().createElement(M,{job:n,onBack:i}):r().createElement(T,{jobs:t,onViewJob:s,onCancelJob:o}))};var $=n(46470);const L=(0,v.Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),_=({workspaceUri:e,version:t})=>{const n=L(),{serverInfo:l}=(0,a.useContext)(c.AL),{workspaceName:s}=(0,$.x)(e);return r().createElement("div",{className:n.paper,style:{zIndex:9999}},r().createElement("h2",null,"Labbox Ephys ",t),r().createElement(Z.Z,null,r().createElement(j.Z,null,r().createElement(O.Z,null,"Workspace URI"),r().createElement(O.Z,null,e||"")),r().createElement(j.Z,null,r().createElement(O.Z,null,"Workspace name"),r().createElement(O.Z,null,s)),r().createElement(j.Z,null,r().createElement(O.Z,null,"Kachery node ID"),r().createElement(O.Z,null,l?l.nodeId:"")),r().createElement(j.Z,null,r().createElement(O.Z,null,"Default feed ID"),r().createElement(O.Z,null,l?l.defaultFeedId:""))))};function K(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}const B=({workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:o,version:i,width:c,height:u})=>{const{width:d,height:m}=function(){const[e,t]=(0,a.useState)(K());return(0,a.useEffect)((()=>{function e(){t(K())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),p=(u||m)-52-2,g=(c||d)-0-2,b=(0,s.FO)().filter((e=>"WorkspaceView"===e.name))[0];if(!b)throw Error("Unable to find workspace view plugin");const[E,k]=(0,a.useState)(!1),[w,f]=(0,a.useState)(!1),h=(0,a.useCallback)((()=>{k(!0)}),[]),v=(0,a.useCallback)((()=>{f(!0)}),[]),C=(0,a.useCallback)((()=>{k(!1)}),[]),Z=(0,a.useCallback)((()=>{f(!1)}),[]);return r().createElement("div",{style:{margin:0}},r().createElement(y,{onOpenSettings:h,onOpenJobMonitor:v,workspaceRouteDispatch:o}),r().createElement("div",{style:{position:"absolute",top:52}},r().createElement(b.component,{width:g,height:p,workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:o})),r().createElement(l.Z,{open:E,onClose:C,style:{zIndex:9999}},r().createElement("span",null,r().createElement(_,{workspace:e,workspaceUri:n.workspaceUri,version:i}))),r().createElement(l.Z,{open:w,onClose:Z,style:{zIndex:9999}},r().createElement("span",null,r().createElement(W,null))))}},95849:(e,t,n)=>{"use strict";n.d(t,{kN:()=>c,GI:()=>u,CC:()=>i,Zl:()=>s,_S:()=>b,SF:()=>d,fG:()=>k,fB:()=>E,Sd:()=>g,FO:()=>w});var l=n(5443),a=n(69297);const r=(e,t)=>{if(e.min<=t&&t<e.max)return e;const n=e.max-e.min,l=Math.max(0,Math.floor(t-n/2));return{min:l,max:l+n}},s=(e,t)=>{var n,l,a,s;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?r(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const a=9e6,r=e.currentTimepoint,s=e.timeRange;if(!s)return e;const i=null!==(n=t.direction)&&void 0!==n?n:"in",c=null!==(l=t.factor)&&void 0!==l?l:1.4,u="out"===i?1/c:c;if((s.max-s.min)/u>a)return e;let d;d=void 0===r||r<s.min?s.min:r>s.max?s.max:r;const m=o(s,u,d);return Object.assign(Object.assign({},e),{timeRange:m})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const n=null!==(a=t.direction)&&void 0!==a?a:"up",l=null!==(s=t.multiplier)&&void 0!==s?s:1.4,r="down"===n?1/l:l;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*r})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},o=(e,t,n)=>{const l=n+(e.min-n)/t,a=n+(e.max-n)/t;return{min:Math.floor(l),max:Math.floor(a)}},i=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,c=(e,t,n)=>n&&i(e,t)||e,u=(e,t)=>{const n=i(e,t);return!n||Math.min(...n)===e},d=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==n))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],n]}):Object.assign(Object.assign({},e),{selectedUnitIds:[n]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?m(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):s(e,t),m=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>u(e,t))):void 0}):e,p=e=>e.filter((e=>!e.disabled&&!e.development)),g=e=>p(e).filter((e=>"SortingView"===e.type)).map((e=>e)),b=e=>p(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),E=e=>p(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),k=e=>p(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),w=()=>{const e=(0,l._m)();return(0,a.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}},46470:(e,t,n)=>{"use strict";n.d(t,{x:()=>l});const l=e=>{if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};const t=e.split("/"),n=t[2]||void 0,l=t[3]||void 0;return n&&l?{feedUri:`feed://${n}`,workspaceName:l}:{feedUri:void 0,workspaceName:void 0}}}}]);